ржПржЯрж╛ ржЦрзБржм production-critical ржкрзНрж░рж╢рзНржитАФCSV upload ржнрзБрж▓ржнрж╛ржмрзЗ ржХрж░рж▓рзЗ
ЁЯСЙ server crash, memory overflow, slow MySQL, partial data insertтАФрж╕ржмржЗ рж╣рждрзЗ ржкрж╛рж░рзЗред

ржЖржорж┐ ржирж┐ржЪрзЗ ржмрж╛рж╕рзНрждржм production best practice ржжрж┐ржЪрзНржЫрж┐, рж╕рж╛ржерзЗ тАЬржПржХржмрж╛рж░рзЗ ржХржд row safe?тАЭ
тАФржПржЗ ржкрзНрж░рж╢рзНржиржЯрж╛рж░ ржмрж╛рж╕рзНрждржм ржЙрждрзНрждрж░ржУред

###################################################################
                  STUDY
###################################################################


# ЁЯОп ржкрзНрж░рж╢рзНржирзЗрж░ рж╕ржВржХрзНрж╖рж┐ржкрзНржд ржЙрждрзНрждрж░ (ржЖржЧрзЗ ржмрж▓рзЗ ржжрзЗржЗ)

> ржПржХржмрж╛рж░рзЗ ржХржд row CSV upload ржХрж░рж╛ ржпрж╛ржмрзЗтАФржПрж░ ржХрзЛржирзЛ fixed рж╕ржВржЦрзНржпрж╛ ржирзЗржЗред
> ржПржЯрж╛ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ ржХрзАржнрж╛ржмрзЗ upload + insert ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ рждрж╛рж░ ржУржкрж░ред

ржХрж┐ржирзНрждрзБ safe guideline ржирж┐ржЪрзЗ ржжрж┐рж▓рж╛ржо ЁЯСЗ

# ЁЯУК Safe Row Count Guideline (Production Reality)

| Upload Strategy               | Safe Rows (ржПржХржмрж╛рж░рзЗ) |
|-------------------------------|------------------------|
| тЭМ Naive loop + SaveChanges  | 1k тАУ 5k            |
| тЪая╕П EF Core batch insert      | 10k тАУ 30k          |
| тЬЕ Chunk + Bulk Insert       | 50k тАУ 200k         |
| ЁЯЪА MySQL `LOAD DATA INFILE`  | 1M+                |

ЁЯСЙ Best practice = Chunk + Bulk Insert

# ЁЯза CSV Upload Best Practice (High-Level Flow)

```
CSV Upload
   тЖУ
Validate file (type, size)
   тЖУ
Stream read (NOT load full file)
   тЖУ
Parse row by row
   тЖУ
Chunk (e.g. 1000 rows)
   тЖУ
Bulk insert to MySQL
```

# 1я╕ПтГг CSV Upload тАУ What NOT to do тЭМ

тЭМ ржкрзБрж░рзЛ CSV file memory рждрзЗ load ржХрж░рж╛
тЭМ `ReadAllLines()` ржмрзНржпржмрж╣рж╛рж░
тЭМ ржкрзНрж░рждрж┐ row ржП `SaveChanges()`
тЭМ Transaction ржЫрж╛рзЬрж╛ insert
тЭМ Validation ржЫрж╛рзЬрж╛ data ржврзЛржХрж╛ржирзЛ

ржПржЗржЧрзБрж▓рзЛ ржХрж░рж▓рзЗ 5тАУ10 рж╣рж╛ржЬрж╛рж░ row ржПржЗ app ржорж╛рж░рж╛ ржпрж╛ржмрзЗред


###################################################################
                      CODE START
###################################################################

# 2я╕ПтГг Production-Ready CSV Upload Best Practice (.NET)

## тЬЕ Step-1: File Validation
if (file == null || file.Length == 0)
    throw new Exception("File required");

if (!file.FileName.EndsWith(".csv"))
    throw new Exception("Invalid file type");

if (file.Length > 10  1024  1024) // 10 MB
    throw new Exception("File too large");
```

ЁЯУМ CSV upload ржПрж░ ржЬржирзНржп рж╕рж╛ржзрж╛рж░ржгржд:

 5тАУ20 MB safe

## тЬЕ Step-2: Stream CSV (Memory Safe)
using var reader = new StreamReader(file.OpenReadStream());
```

ЁЯСЙ StreamReader ржорж╛ржирзЗ:

 рж▓рж╛ржЗржи ржзрж░рзЗ ржкрзЬрзЗ
 RAM explode ржХрж░рзЗ ржирж╛

## 3я╕ПтГг CSV Parsing (Recommended Library)

### ЁЯУж NuGet

```bash
dotnet add package CsvHelper
```
using CsvHelper;
using System.Globalization;

using var csv = new CsvReader(reader, CultureInfo.InvariantCulture);
var records = csv.GetRecords<MyCsvDto>();
```

# 4я╕ПтГг Chunking (рж╕ржмржЪрзЗрзЯрзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг)
const int batchSize = 1000;
var batch = new List<Employee>();

foreach (var record in records)
{
    batch.Add(new Employee
    {
        Name = record.Name,
        Email = record.Email
    });

    if (batch.Count == batchSize)
    {
        await BulkInsertAsync(batch);
        batch.Clear();
    }
}

if (batch.Any())
{
    await BulkInsertAsync(batch);
}
```

ЁЯСЙ 1000 rows = sweet spot
ЁЯСЙ 500тАУ2000 range safe

# 5я╕ПтГг Bulk Insert into MySQL (Best Option)

### Option-A: `MySqlBulkCopy` (Fast)
using MySqlConnector;
```
using var bulk = new MySqlBulkCopy(connection)
{
    DestinationTableName = "employees",
    BulkCopyTimeout = 600
};

await bulk.WriteToServerAsync(dataTable);
```

ЁЯЪА 50kтАУ200k rows easy

### Option-B: MySQL Native (Fastest)

```sql
LOAD DATA INFILE 'employees.csv'
INTO TABLE employees
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;
```

ЁЯСЙ 1 million+ rows
ЁЯСЙ Requires server permission

# 6я╕ПтГг Transaction + Error Handling (Mandatory)
using var transaction = await connection.BeginTransactionAsync();

try
{
    await BulkInsertAsync(batch);
    await transaction.CommitAsync();
}
catch
{
    await transaction.RollbackAsync();
    throw;
}
```

# ЁЯФР Security Best Practices

### тЬЕ DO

тЬФ CSV size limit
тЬФ Column mapping validation
тЬФ Chunk insert
тЬФ Transaction
тЬФ Background processing (large files)

### тЭМ NEVER

тЭМ Blind insert
тЭМ Full file in memory
тЭМ Row-by-row DB hit
тЭМ UI thread block

# ЁЯзк Real-World Recommendation (Answer to your core question)

> Production-grade ASP.NET application ржП ржПржХржмрж╛рж░рзЗ 50,000 row CSV upload ржХрж░рж╛ safe,
> ржпржжрж┐ chunk + bulk insert ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред
>
> ржЖрж░ LOAD DATA INFILE ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ 1 million+ row рж╕ржорзНржнржмред

# ЁЯОУ Interview / Viva One-Liner

> CSV upload ржХрж░рж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ .NET web application-ржП stream-based reading, chunk processing ржПржмржВ bulk insert ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯ, ржпрж╛рж░ ржорж╛ржзрзНржпржорзЗ рж╣рж╛ржЬрж╛рж░ ржерзЗржХрзЗ рж▓ржХрзНрж╖ row ржирж┐рж░рж╛ржкржжрзЗ MySQL database-ржП insert ржХрж░рж╛ ржпрж╛рзЯред

# ЁЯза Mental Model (ржоржирзЗ рж░рж╛ржЦрж╛рж░ ржорждрзЛ)

> Small bites, not big swallow
> (Chunk ржХрж░рзЛ, DB-ржХрзЗ рж╢рзНржмрж╛рж╕ ржирж┐рждрзЗ ржжрж╛ржУ)

рждрзБржорж┐ ржЪрж╛ржЗрж▓рзЗ ржЖржорж┐ ржкрж░рзЗрж░ ржзрж╛ржкрзЗ:

 Repository + Service based CSV upload
 Background job (Hangfire)
 CSV validation rules
 Progress bar (UI)
 Partial failure recovery

рж╕ржм production-ready ржХрж░рзЗ ржжрж┐рждрзЗ ржкрж╛рж░рж┐ред
