বর্তমানে ASP.NET Core MVC-এর v9 সংস্করণটি এখনো স্থিতিশীল (Stable) অবস্থায় মুক্তি পায়নি। 
তবে, ASP.NET Core 8.0/9.0 এর জন্য আধুনিক এবং প্রস্তাবিত পদ্ধতি ব্যবহার করে MySQL ডাটাবেসের সাথে Login, Registration, এবং Role-ভিত্তিক অ্যাক্সেস নিয়ন্ত্রণের জন্য সম্পূর্ণ ধাপগুলি নিচে দেওয়া হলো। এই প্রক্রিয়াটি ASP.NET Core Identity ব্যবহার করে সবচেয়ে নিরাপদে করা যায়।

-----

## ASP.NET Core MVC (Identity) দিয়ে Login, Registration ও Role-ভিত্তিক অ্যাক্সেস তৈরি (MySQL সহ)

### পূর্বশর্ত (Prerequisites):

1.  Visual Studio (বা .NET CLI)
2.  .NET 8 SDK (যা পরবর্তী সংস্করণ 9 এর জন্যও ভিত্তি হিসেবে কাজ করবে)
3.  MySQL সার্ভার ইনস্টল করা আছে।

### ধাপ ১: প্রজেক্ট তৈরি ও প্যাকেজ ইনস্টলেশন

#### ১.১. নতুন প্রজেক্ট তৈরি:
Visual Studio বা CLI ব্যবহার করে একটি নতুন ASP.NET Core Web App (Model-View-Controller) প্রজেক্ট তৈরি করুন।

#### ১.২. প্রয়োজনীয় NuGet প্যাকেজ ইনস্টল:

Package Manager Console বা CLI ব্যবহার করে MySQL সংযোগ ও Identity-এর জন্য এই প্যাকেজগুলো ইনস্টল করুন:

```bash
# Package Manager Console (Visual Studio)
Install-Package Pomelo.EntityFrameworkCore.MySql
Install-Package Microsoft.AspNetCore.Identity.EntityFrameworkCore
Install-Package Microsoft.EntityFrameworkCore.Tools
Install-Package Microsoft.AspNetCore.Identity.UI
```

### ধাপ ২: ডাটাবেস কনটেক্সট এবং সংযোগ স্থাপন

#### ২.১. `ApplicationDbContext.cs` ফাইল তৈরি:

প্রজেক্টের `Data` ফোল্ডারে `ApplicationDbContext.cs` নামে একটি ফাইল তৈরি করুন। এটি Identity-এর জন্য প্রয়োজনীয় সমস্ত টেবিল (Users, Roles ইত্যাদি) তৈরি করতে সাহায্য করবে।

```csharp
using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
using Microsoft.AspNetCore.Identity;
using Microsoft.EntityFrameworkCore;

namespace YourProjectName.Data // আপনার প্রজেক্টের Namespace দিন
{
    // IdentityUser ব্যবহার করে IdentityDbContext থেকে Inherit করুন
    public class ApplicationDbContext : IdentityDbContext<IdentityUser>
    {
        public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
            : base(options)
        {
        }
        
        // এখানে DbSet বা অন্যান্য কাস্টমাইজেশন যোগ করতে পারেন
    }
}
```

#### ২.২. MySQL সংযোগ সেটআপ (`appsettings.json`):

আপনার `appsettings.json` ফাইলে MySQL সংযোগের স্ট্রিং যোগ করুন:

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Port=3306;Database=YourAppDb;Uid=your_mysql_user;Pwd=your_mysql_password;"
  },
  // ... অন্যান্য সেটিংস
}
```

#### ২.৩. Identity সার্ভিস যোগ (`Program.cs`):

`Program.cs` ফাইলে Identity এবং MySQL সংযোগটি কনফিগার করুন:

```csharp
using YourProjectName.Data; // আপনার DbContext এর Namespace
using Microsoft.AspNetCore.Identity;
using Microsoft.EntityFrameworkCore;
using Pomelo.EntityFrameworkCore.MySql.Infrastructure;

var builder = WebApplication.CreateBuilder(args);

// 1. Connection String ও MySQL কনফিগারেশন
var connectionString = builder.Configuration.GetConnectionString("DefaultConnection") ?? 
    throw new InvalidOperationException("Connection string 'DefaultConnection' not found.");

builder.Services.AddDbContext<ApplicationDbContext>(options =>
    options.UseMySql(connectionString, 
        ServerVersion.AutoDetect(connectionString), 
        mySqlOptions => mySqlOptions.SchemaBehavior(MySqlSchemaBehavior.Ignore))); 
        
// 2. Identity সার্ভিস যোগ করা
builder.Services.AddDefaultIdentity<IdentityUser>(options => options.SignIn.RequireConfirmedAccount = true)
    .AddRoles<IdentityRole>() // Role ম্যানেজমেন্ট সক্ষম করা
    .AddEntityFrameworkStores<ApplicationDbContext>();

builder.Services.AddControllersWithViews();

var app = builder.Build();
// ...
```

#### ২.৪. মাইগ্রেশন ও ডাটাবেস তৈরি:

Package Manager Console-এ নিচের কমান্ডগুলো চালিয়ে MySQL ডাটাবেসে Identity টেবিলগুলো তৈরি করুন:

```bash
Add-Migration InitialIdentitySetup
Update-Database
```

### ধাপ ৩: রেজিস্ট্রেশন ও লগইন পেজ তৈরি

ASP.NET Core Identity-এর জন্য স্বয়ংক্রিয়ভাবে তৈরি পেজ (Razor Pages) ব্যবহার করাই সবচেয়ে সহজ:

#### ৩.১. Identity Scaffolding:

1.  প্রজেক্টে রাইট ক্লিক → Add → New Scaffolded Item... নির্বাচন করুন।
2.  বাম দিক থেকে Identity নির্বাচন করুন।
3.  প্রয়োজনীয় পেজগুলো (যেমন Register, Login, Logout ইত্যাদি) নির্বাচন করুন।
4.  Data Context Class হিসেবে `ApplicationDbContext` নির্বাচন করুন এবং Add চাপুন।

এখন আপনার প্রজেক্টে `Areas/Identity/Pages/Account` ফোল্ডারে সমস্ত রেজিস্ট্রেশন এবং লগইনের UI ও লজিক চলে আসবে। এখন আপনি অ্যাপ্লিকেশন রান করলে `/_Account/Register` বাটন খুঁজে পাবেন।

### ধাপ ৪: Role তৈরি এবং Assign করা

Role-ভিত্তিক অ্যাক্সেসের জন্য, প্রথমে ডাটাবেসে Role তৈরি এবং ব্যবহারকারীকে তা Assign করতে হবে।

#### ৪.১. Role Seeding (Role তৈরি):

অ্যাপ্লিকেশন শুরু হওয়ার সময় `Admin` এবং `User` Role তৈরি করার জন্য একটি সার্ভিস তৈরি করুন (যেমন `DbInitializer.cs`):

```csharp
// DbInitializer.cs
using Microsoft.AspNetCore.Identity;

public static class DbInitializer
{
    public static async Task SeedRoles(IServiceProvider serviceProvider)
    {
        var roleManager = serviceProvider.GetRequiredService<RoleManager<IdentityRole>>();

        string[] roleNames = { "Admin", "User" };
        
        foreach (var roleName in roleNames)
        {
            if (!await roleManager.RoleExistsAsync(roleName))
            {
                await roleManager.CreateAsync(new IdentityRole(roleName));
            }
        }
    }
}
```

`Program.cs`-এ অ্যাপ্লিকেশন রান করার আগে এটি নিশ্চিত করুন:

```csharp
// Program.cs
// ...
var app = builder.Build();

// Role Seeding যুক্ত করা
using (var scope = app.Services.CreateScope())
{
    var services = scope.ServiceProvider;
    await DbInitializer.SeedRoles(services);
}
// ...
```

#### ৪.২. ব্যবহারকারীকে Role Assign করা:

প্রথমে একটি ব্যবহারকারী (`user`) তৈরি করুন (রেজিস্ট্রেশন পেজ ব্যবহার করে), তারপর `UserManager` ব্যবহার করে তাকে Admin Role দিন। এটি আপনি কোডের মাধ্যমে একবার করতে পারেন, অথবা কাস্টম Admin প্যানেলের মাধ্যমে করতে পারেন:

```csharp
// উদাহরণ: প্রথম রেজিস্টার্ড ইউজারকে এডমিন রোল দেওয়া (বাটন বা কোডের মাধ্যমে)

var userManager = services.GetRequiredService<UserManager<IdentityUser>>();
var user = await userManager.FindByEmailAsync("admin@example.com");

if (user != null)
{
    await userManager.AddToRoleAsync(user, "Admin"); 
}
```

### ধাপ ৫: Role-ভিত্তিক অ্যাক্সেস নিয়ন্ত্রণ (Authorization)

আপনার MVC Controller বা Action Method-এ `[Authorize(Roles = "...")]` অ্যাট্রিবিউট ব্যবহার করে অ্যাক্সেস নিয়ন্ত্রণ করুন।

#### ৫.১. নির্দিষ্ট Role-এর জন্য অ্যাক্সেস:

যদি শুধুমাত্র Admin-দের জন্য একটি পেজ তৈরি করতে চান (উদাহরণস্বরূপ `AdminController`):

```csharp
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

[Authorize(Roles = "Admin")] // শুধুমাত্র Admin Role-এর ইউজাররা অ্যাক্সেস করতে পারবে
public class AdminController : Controller
{
    public IActionResult Dashboard()
    {
        return View();
    }
}
```

#### ৫.২. লগইন আবশ্যক:

শুধুমাত্র লগইন করা ব্যবহারকারী অ্যাক্সেস করতে পারবে:

```csharp
[Authorize] // যেকোনো লগইন করা ইউজার অ্যাক্সেস করতে পারবে
public IActionResult SecretPage()
{
    return View();
}
```

এই ধাপগুলি সঠিকভাবে অনুসরণ করলে আপনি ASP.NET Core MVC-এ একটি সম্পূর্ণ সুরক্ষিত এবং Role-ভিত্তিক ইউজার ম্যানেজমেন্ট সিস্টেম তৈরি করতে পারবেন।










.
