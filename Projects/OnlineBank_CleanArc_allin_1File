Date: 19 December 2025
Yesterday-Died: Sharif Usman Hadi



This project is a secure online banking web application built with ASP.NET Core MVC following Clean Architecture, supporting 
-customer registration, 
-secure login, 
-deposit, withdrawal, fund transfer with banking rules,
-PDF statements, 
-admin management, and 
-full audit logging using MySQL.â€


### âœ… Clean Architecture
    * Domain (Entities only)
    * Application (Interfaces + Rules)
    * Infrastructure (DB, PDF, Security)
    * Web (MVC + UI)

### âœ… Separation of Concerns
    * Business logic Web-à¦ à¦¨à¦¾
    * DB logic Domain-à¦ à¦¨à¦¾
    * UI Infrastructure-à¦ à¦¨à¦¾

âœ… Admin Functionalities:
    * All customers list view
    * Make / Remove Admin
    * Lock customer account (manual)
    * Unlock customer account
    * Reset customer password
    * View full Audit Logs

âœ… à¦†à¦°à¦“ real-worldâ€ à¦¯à§‹à¦— à¦•à¦°à§‡à¦›à¦¿:
    * PDF-à¦ Customer à¦¨à¦¾à¦® DB à¦¥à§‡à¦•à§‡ à¦†à¦¸à¦¬à§‡
    * Statement-à¦ Asia/Dhaka time à¦¦à§‡à¦–à¦¾à¦¬à§‡
    * Currency configurable (BDT)
    * Minimum balance rule (Withdraw/Transfer à¦à¦° à¦ªà¦°à§‡ à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à¦•à¦®à§‡ à¦¯à¦¾à¦¬à§‡ à¦¨à¦¾)
    * Daily transfer limit (à¦¦à¦¿à¦¨à§‡ à¦¸à¦°à§à¦¬à§‹à¦šà§à¦š X à¦Ÿà¦¾à¦•à¦¾ transfer)
    * Admin panel: Customers list, user lock/unlock, reset password, set admin, audit logs
    * Audit log: Deposit/Withdraw/Transfer/Login/Failed login à¦¸à¦¬ record à¦¹à¦¬à§‡
    * UI: Bootstrap layout

> âš ï¸ à¦¨à§‹à¦Ÿ: à¦à¦Ÿà¦¾ production-ready starterà¥¤ 
à¦¬à§à¦¯à¦¾à¦‚à¦• à¦²à§‡à¦­à§‡à¦²à§‡ à¦¯à¦¾à¦“à§Ÿà¦¾à¦° à¦œà¦¨à§à¦¯ MFA/OTP, KYC/AML, device fingerprinting, fraud scoring, WAF, HSM, key rotation à¦¯à§‹à¦— à¦²à¦¾à¦—à§‡â€”à¦•à¦¿à¦¨à§à¦¤à§ starter à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦à¦Ÿà¦¾ à¦¶à¦•à§à¦¤ baseà¥¤

---



=================================================================================================
âœ… Feature List + Table Mapping + Class/Service Mapping,   category-wise
=================================================================================================


## ğŸ” 1) Authentication & User Management

### âœ… Customer Registration

à¦•à¦¾à¦œ: 
Name, Email, City, Password à¦¦à¦¿à§Ÿà§‡ register â†’ à§« à¦¡à¦¿à¦œà¦¿à¦Ÿ Auto-generated 5-digit Account Number
* Email unique (duplicate à¦¹à¦²à§‡ register à¦¹à¦¬à§‡ à¦¨à¦¾)
* Password BCrypt hash à¦¹à§Ÿà§‡ DB-à¦¤à§‡ store à¦¹à§Ÿ

Tables (DB):
    -Customers (insert)
    -Accounts (insert, Balance=0)
    -AuditLogs (insert: REGISTER)

Classes/Services:
    - Controller: AccountController â†’ Register()
    - ViewModel: RegisterVm
    - Interface: IAuthService
    - Implementation: AuthService.RegisterAsync()
    - Domain Entities: Customer, Account, AuditLog
    - Helper: PasswordHasher.Hash()
    - Audit Helper: AuditWriter.WriteAsync("REGISTER",...)



### âœ… 2) Customer Login + Lockout (à¦²à¦—à¦‡à¦¨ + à¦­à§à¦² à¦ªà¦¾à¦¸à¦“à§Ÿà¦¾à¦°à§à¦¡à§‡ à¦²à¦•)

à¦•à¦¾à¦œ: 
* Login à¦¹à§Ÿ Account Number + Password à¦¦à¦¿à§Ÿà§‡  à§« à¦¬à¦¾à¦° à¦­à§à¦² à¦¹à¦²à§‡ à§§à§« à¦®à¦¿à¦¨à¦¿à¦Ÿ lock
    * 5 à¦¬à¦¾à¦° à¦­à§à¦² password à¦¦à¦¿à¦²à§‡:
    * Account 15 à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡à¦° à¦œà¦¨à§à¦¯ lock
    * Lock à¦¥à¦¾à¦•à¦¾ à¦…à¦¬à¦¸à§à¦¥à¦¾à§Ÿ login block à¦¹à§Ÿ
    * Successful login à¦¹à¦²à§‡:
     * Failed login counter reset
* Cookie-based authentication
* Secure cookies:

  * HttpOnly
  * SameSite = Strict
  * Secure (HTTPS friendly)


Tables (DB):
    - Customers (read/update: FailedLoginCount, LockedUntilUtc)
    - AuditLogs (LOGIN_SUCCESS / LOGIN_FAIL / LOGIN_LOCKED / LOGIN_BLOCKED)

Classes/Services:
    - Controller: AccountController â†’ Login()
    - ViewModel: LoginVm
    - Interface: IAuthService
    - Implementation: AuthService.ValidateLoginAsync()
    - Domain Entity: Customer, AuditLog
    - Cookie Auth: Claims (CustomerId, AccountNumber, IsAdmin)

---

## ğŸ’° 2) Core Banking Features

### âœ… Deposit Money

* Positive amount check
* Balance à¦¬à¦¾à§œà§‡
* Transaction table-à¦ record à¦¹à§Ÿ
* Audit log à¦¤à§ˆà¦°à¦¿ à¦¹à§Ÿ

Tables (DB):
    - Accounts (Balance update +)
    - Transactions (insert: Deposit)
    - AuditLogs (insert: DEPOSIT)

Classes/Services:
    - Controller: BankingController â†’ Deposit()
    - ViewModel: AmountVm
    - Interface: IBankingService
    - Implementation: BankingService.DepositAsync()
    - Domain Entity: Account, Transaction, AuditLog
    - Audit: AuditWriter.WriteAsync("DEPOSIT",...)




### âœ… Withdraw Money

* Balance sufficient à¦¨à¦¾ à¦¹à¦²à§‡ withdraw à¦¹à¦¬à§‡ à¦¨à¦¾
* Minimum Balance Rule enforced
* Transaction record à¦¹à§Ÿ
* Audit log à¦¹à§Ÿ


Tables (DB):
    - Accounts (Balance update -)
    - Transactions (insert: Withdraw)
    - AuditLogs (insert: WITHDRAW)

Classes/Services:
    - Controller: BankingController â†’ Withdraw()
    - ViewModel: AmountVm
    - Interface: IBankingService
    - Implementation: BankingService.WithdrawAsync()
    - Rule used: BankingRulesOptions.MinimumBalance
    - Domain Entity: Account, Transaction, AuditLog
    - Audit: AuditWriter.WriteAsync("WITHDRAW",...)




### âœ… Transfer Money

* à¦à¦• account à¦¥à§‡à¦•à§‡ à¦…à¦¨à§à¦¯ account-à¦ transfer
* Same account-à¦ transfer block
* Receiver account exist à¦¨à¦¾ à¦•à¦°à¦²à§‡ fail
* Daily Transfer Limit enforced
* Minimum balance after transfer enforce
* Sender â†’ TransferOut
* Receiver â†’ TransferIn
* Double transaction entry (ledger style)
* Audit log à¦¹à§Ÿ (actor + target)


Tables (DB):
    -Customers (receiver account lookup)
    -Accounts (sender balance -, receiver balance +)
    -Transactions (insert 2 rows):
      - sender: TransferOut
      - receiver: TransferIn
    - AuditLogs (insert: TRANSFER)

Classes/Services:
    - Controller: BankingController â†’ Transfer()
    - ViewModel: TransferVm
    - Interface: IBankingService
    - Implementation: BankingService.TransferAsync()

Rules used:
    > BankingRulesOptions.DailyTransferLimit
    > BankingRulesOptions.MinimumBalance
    > Domain Entity: Customer, Account, Transaction, AuditLog
    > Audit: AuditWriter.WriteAsync("TRANSFER",...)



---

## ğŸ“„ 3) Transaction History & Statement

### âœ… Last 10 Transactions

* Dashboard-à¦ last 10 transaction à¦¦à§‡à¦–à¦¾ à¦¯à¦¾à§Ÿ
* UTC time store à¦¹à§Ÿ (DB)

Tables (DB):
    - Customers + Accounts (profile + balance read)
    - Transactions (last 10 read)
Classes/Services:
    - Controller: BankingController â†’ Dashboard()
    - Interface: IBankingService
    - Implementation: BankingService.GetProfileAsync(), GetLastTransactionsAsync()
    - Domain Entity: Transaction
    - View: Views/Banking/Dashboard.cshtml
    - Options/Rules: BankingRulesOptions (Currency, TimeZone, MinBalance, DailyLimit)


### âœ… PDF Mini Statement

* Downloadable PDF
* Last 10 transactions
* Customer name, account number
* Current balance
* Asia/Dhaka time conversion
* Currency symbol configurable (à§³ / â‚¬ / $)

à¦•à¦¾à¦œ: last 10 transaction PDF download
Special: DB-à¦¤à§‡ time UTC, PDF-à¦ Dhaka time convert + currency symbol

Tables (DB):
    - Customers + Accounts (customer name + account + balance read)
    - Transactions (last 10 read)

Classes/Services:
    - Controller: BankingController â†’ MiniStatementPdf()

Services:
    - IBankingService.GetProfileAsync()
    - IBankingService.GetLastTransactionsAsync()
    - IStatementPdfService.BuildMiniStatementPdf()
Implementation: StatementPdfService
Library: QuestPDF
Rules used:
BankingRulesOptions.TimeZoneId
BankingRulesOptions.CurrencySymbol
Domain Entity: Transaction




---

## ğŸ›¡ï¸ 4) Security Features

* Password hashing (BCrypt)
* CSRF protection (Auto Anti-Forgery)
* Brute-force protection (lockout)
* Cookie hardening
* Secure headers:

  * X-Frame-Options
  * X-Content-Type-Options
  * CSP
* HTTPS ready (IIS friendly)

à¦•à¦¾à¦œ: à¦¨à¦¿à¦°à§à¦¦à¦¿à¦·à§à¦Ÿ customer lock/unlock
Tables (DB):
    - Customers (update: LockedUntilUtc, FailedLoginCount)
    - AuditLogs (ADMIN_LOCK / ADMIN_UNLOCK)
Classes/Services:
    - Controller: AdminController â†’ Lock(), Unlock()
    - Interface: IAdminService
    - Implementation: AdminService.LockAsync(), UnlockAsync()
    - Domain Entity: Customer, AuditLog
    - Audit: AuditWriter

---

## ğŸ‘¨â€ğŸ’¼ 5) Admin Panel (Role Based)

### âœ… Admin Account (Auto-seeded)

* First run à¦ admin auto create à¦¹à§Ÿ
* Console-à¦ admin account number à¦¦à§‡à¦–à¦¾à§Ÿ

Tables (DB):
    -Customers (read all)
Classes/Services:
    - Controller: AdminController â†’ Customers()
    - Authorization: [Authorize(Policy="AdminOnly")]
    - Interface: IAdminService
    - Implementation: AdminService.GetCustomersAsync()
    - View: Views/Admin/Customers.cshtml
    - Domain Entity: Customer

### âœ… Admin Functionalities

* All customers list view
* Make / Remove Admin
* Lock customer account (manual)
* Unlock customer account
* Reset customer password
* View full Audit Logs



à¦•à¦¾à¦œ: customer à¦•à§‡ admin à¦¬à¦¾à¦¨à¦¾à¦¨à§‹/à¦¸à¦°à¦¾à¦¨à§‹
Tables (DB):
    - Customers (update: IsAdmin)
    - AuditLogs (ADMIN_SET_ROLE)
Classes/Services:
    - Controller: AdminController â†’ SetAdmin()
    - Interface: IAdminService
    - Implementation: AdminService.SetAdminAsync()
    - Domain Entity: Customer, AuditLog
    - Audit: AuditWriter

à¦•à¦¾à¦œ: admin user-à¦à¦° password reset à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‡
Tables (DB):
    - Customers (update: PasswordHash + unlock fields reset)
    - AuditLogs (ADMIN_RESET_PASSWORD)

Classes/Services:
    - Controller: AdminController â†’ ResetPassword(GET/POST)
    - ViewModel: AdminResetPasswordVm
    - Interface: IAdminService
    - Implementation: AdminService.ResetPasswordAsync()
    - Helper: PasswordHasher.Hash()
    - Domain Entity: Customer, AuditLog




---

## ğŸ§¾ 6) Audit & Monitoring

### âœ… Audit Logs (Real Banking Feature)

Every sensitive action record à¦¹à§Ÿ:

* Register
* Login success / fail
* Account locked
* Deposit / Withdraw / Transfer
* Admin actions


à¦•à¦¾à¦œ: system à¦•à§‡ à¦•à¦–à¦¨ à¦•à§€ à¦•à¦°à§‡à¦›à§‡ à¦¦à§‡à¦–à¦¤à§‡ à¦ªà¦¾à¦°à¦¾
Tables (DB):
    - AuditLogs (read latest)

Classes/Services:
    - Controller: AdminController â†’ Audit()
    - Interface: IAdminService
    - Implementation: AdminService.GetLatestAuditAsync()
    - View: Views/Admin/Audit.cshtml
    - Domain Entity: AuditLog




Audit-à¦ à¦¥à¦¾à¦•à§‡:

* Action name
* Actor account number
* Target account number
* IP address
* User agent
* Timestamp




---

## ğŸ§± 7)  Configuration Based Rules

à¦¸à¦¬ rule `appsettings.json` à¦¥à§‡à¦•à§‡ control à¦•à¦°à¦¾ à¦¯à¦¾à§Ÿ:

* Currency symbol
* TimeZone
* Minimum balance
* Daily transfer limit
* Admin seed credentials

---

## ğŸ–¥ï¸ 9) Deployment Ready (Windows Server)

* IIS compatible
* MySQL compatible
* HTTPS ready
* Production config friendly







====================================================================
# ğŸ“ OnlineBanking â€“ Folder Structure (Clean Architecture)
====================================================================

```
OnlineBanking
â”‚
â”œâ”€â”€ OnlineBanking.sln
â”‚
â””â”€â”€ src
    â”‚
    â”œâ”€â”€ OnlineBanking.Domain
    â”‚   â”‚
    â”‚   â”œâ”€â”€ OnlineBanking.Domain.csproj
    â”‚   â”‚
    â”‚   â””â”€â”€ Entities
    â”‚       â”œâ”€â”€ Account.cs
    â”‚       â”œâ”€â”€ AuditLog.cs
    â”‚       â”œâ”€â”€ Customer.cs
    â”‚       â””â”€â”€ Transaction.cs
    â”‚
    â”œâ”€â”€ OnlineBanking.Application
    â”‚   â”‚
    â”‚   â”œâ”€â”€ OnlineBanking.Application.csproj
    â”‚   â”‚
    â”‚   â”œâ”€â”€ Common
    â”‚   â”‚   â””â”€â”€ Result.cs
    â”‚   â”‚
    â”‚   â”œâ”€â”€ Contracts
    â”‚   â”‚   â”œâ”€â”€ IAdminService.cs
    â”‚   â”‚   â”œâ”€â”€ IAuthService.cs
    â”‚   â”‚   â”œâ”€â”€ IBankingService.cs
    â”‚   â”‚   â””â”€â”€ IStatementPdfService.cs
    â”‚   â”‚
    â”‚   â””â”€â”€ Options
    â”‚       â””â”€â”€ BankingRulesOptions.cs
    â”‚
    â”œâ”€â”€ OnlineBanking.Infrastructure
    â”‚   â”‚
    â”‚   â”œâ”€â”€ OnlineBanking.Infrastructure.csproj
    â”‚   â”‚
    â”‚   â”œâ”€â”€ Persistence
    â”‚   â”‚   â””â”€â”€ AppDbContext.cs
    â”‚   â”‚
    â”‚   â”œâ”€â”€ Security
    â”‚   â”‚   â””â”€â”€ PasswordHasher.cs
    â”‚   â”‚
    â”‚   â””â”€â”€ Services
    â”‚       â”œâ”€â”€ AdminService.cs
    â”‚       â”œâ”€â”€ AuditWriter.cs
    â”‚       â”œâ”€â”€ AuthService.cs
    â”‚       â”œâ”€â”€ BankingService.cs
    â”‚       â””â”€â”€ StatementPdfService.cs
    â”‚
    â””â”€â”€ OnlineBanking.Web
        â”‚
        â”œâ”€â”€ OnlineBanking.Web.csproj
        â”œâ”€â”€ Program.cs
        â”œâ”€â”€ appsettings.json
        â”‚
        â”œâ”€â”€ Controllers
        â”‚   â”œâ”€â”€ AccountController.cs
        â”‚   â”œâ”€â”€ AdminController.cs
        â”‚   â””â”€â”€ BankingController.cs
        â”‚
        â”œâ”€â”€ Models
        â”‚   â”œâ”€â”€ AdminResetPasswordVm.cs
        â”‚   â”œâ”€â”€ AmountVm.cs
        â”‚   â”œâ”€â”€ LoginVm.cs
        â”‚   â”œâ”€â”€ RegisterVm.cs
        â”‚   â””â”€â”€ TransferVm.cs
        â”‚
        â”œâ”€â”€ Views
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Account
        â”‚   â”‚   â”œâ”€â”€ Login.cshtml
        â”‚   â”‚   â”œâ”€â”€ Register.cshtml
        â”‚   â”‚   â””â”€â”€ RegisterSuccess.cshtml
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Admin
        â”‚   â”‚   â”œâ”€â”€ Audit.cshtml
        â”‚   â”‚   â”œâ”€â”€ Customers.cshtml
        â”‚   â”‚   â””â”€â”€ ResetPassword.cshtml
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Banking
        â”‚   â”‚   â””â”€â”€ Dashboard.cshtml
        â”‚   â”‚
        â”‚   â””â”€â”€ Shared
        â”‚       â””â”€â”€ _Layout.cshtml
        â”‚
        â””â”€â”€ wwwroot
            â””â”€â”€ (empty â€“ future css/js/images)
```

---

# ğŸ§  à¦®à¦¨à§‡ à¦°à¦¾à¦–à¦¾à¦° à¦¸à¦¹à¦œ Rule (Exam + Interview friendly)

### âœ… Domain
â¡ Business rules + entities only
âŒ No EF Core, No HTTP, No UI

### âœ… Application
â¡ Interfaces + use-case logic + rules config
âŒ No database, No MVC

### âœ… Infrastructure
â¡ Database, EF Core, PDF, hashing, services implementation

### âœ… Web
â¡ Controllers, Views, ViewModels, Auth, UI




########################################################### CODE =====================================================



# 1) Project Create (Step-by-step)

## 1.1 Solution + Projects

```bash
mkdir OnlineBanking
cd OnlineBanking

dotnet new sln -n OnlineBanking
mkdir src
cd src

dotnet new classlib -n OnlineBanking.Domain
dotnet new classlib -n OnlineBanking.Application
dotnet new classlib -n OnlineBanking.Infrastructure
dotnet new mvc -n OnlineBanking.Web

cd ..
dotnet sln add src/OnlineBanking.Domain/OnlineBanking.Domain.csproj
dotnet sln add src/OnlineBanking.Application/OnlineBanking.Application.csproj
dotnet sln add src/OnlineBanking.Infrastructure/OnlineBanking.Infrastructure.csproj
dotnet sln add src/OnlineBanking.Web/OnlineBanking.Web.csproj

dotnet add src/OnlineBanking.Application reference src/OnlineBanking.Domain
dotnet add src/OnlineBanking.Infrastructure reference src/OnlineBanking.Domain
dotnet add src/OnlineBanking.Infrastructure reference src/OnlineBanking.Application
dotnet add src/OnlineBanking.Web reference src/OnlineBanking.Domain
dotnet add src/OnlineBanking.Web reference src/OnlineBanking.Application
dotnet add src/OnlineBanking.Web reference src/OnlineBanking.Infrastructure
```

## 1.2 NuGet Packages

```bash
dotnet add src/OnlineBanking.Infrastructure package Pomelo.EntityFrameworkCore.MySql
dotnet add src/OnlineBanking.Infrastructure package Microsoft.EntityFrameworkCore.Design
dotnet add src/OnlineBanking.Infrastructure package BCrypt.Net-Next
dotnet add src/OnlineBanking.Infrastructure package QuestPDF

dotnet add src/OnlineBanking.Web package Microsoft.EntityFrameworkCore.Design
```

---

# 2) Configuration (appsettings.json)

âœ… à¦à¦–à¦¾à¦¨à§‡ Currency, TimeZone, MinBalance, DailyTransferLimit à¦¸à§‡à¦Ÿ à¦•à¦°à¦¬à§‡à¦¨

`src/OnlineBanking.Web/appsettings.json`

```json
{
  "ConnectionStrings": {
    "MySql": "server=localhost;port=3306;database=onlinebanking_db;user=root;password=YOUR_PASSWORD;TreatTinyAsBoolean=true;"
  },
  "BankingRules": {
    "CurrencySymbol": "à§³",
    "TimeZoneId": "Asia/Dhaka",
    "MinimumBalance": 100.00,
    "DailyTransferLimit": 50000.00
  },
  "AdminSeed": {
    "Email": "admin@bank.local",
    "Password": "Admin@12345",
    "Name": "System Admin",
    "City": "Dhaka"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}
```

---

# 3) DOMAIN Layer (Entities + Business meaning)

## 3.1 Customer (User) entity

à¦•à§‡à¦¨ à¦¦à¦°à¦•à¦¾à¦°: Customer info + login credential + role + lock state (security)

`src/OnlineBanking.Domain/Entities/Customer.cs`

```csharp
namespace OnlineBanking.Domain.Entities;

public sealed class Customer
{
    public Guid Id { get; set; } = Guid.NewGuid();

    public string Name { get; set; } = "";
    public string Email { get; set; } = "";
    public string City { get; set; } = "";

    // 5-digit account number used for login
    public string AccountNumber { get; set; } = "";

    public string PasswordHash { get; set; } = "";

    // admin panel support
    public bool IsAdmin { get; set; } = false;

    // security: lock account after too many failed logins
    public int FailedLoginCount { get; set; } = 0;
    public DateTimeOffset? LockedUntilUtc { get; set; }

    public Account Account { get; set; } = new();
}
```

## 3.2 Account

`RowVersion` à¦¦à¦¿à§Ÿà§‡ concurrency control (à¦à¦•à¦‡ à¦¸à¦®à§Ÿà§‡ à§¨à¦Ÿà¦¾ transfer à¦¹à¦²à§‡ issue à¦•à¦®à¦¬à§‡)

`src/OnlineBanking.Domain/Entities/Account.cs`

```csharp
namespace OnlineBanking.Domain.Entities;

public sealed class Account
{
    public Guid Id { get; set; } = Guid.NewGuid();

    public Guid CustomerId { get; set; }
    public Customer Customer { get; set; } = default!;

    public decimal Balance { get; set; } = 0m;

    public byte[] RowVersion { get; set; } = Array.Empty<byte>();

    public List<Transaction> Transactions { get; set; } = new();
}
```

## 3.3 Transaction

Transfer-à¦ à¦¦à§à¦‡à¦Ÿà¦¾ entry à¦¹à¦¬à§‡: out + in
`Reference` à¦ â€œto 12345â€ à¦²à§‡à¦–à¦¾ à¦¥à¦¾à¦•à¦¬à§‡à¥¤

`src/OnlineBanking.Domain/Entities/Transaction.cs`

```csharp
namespace OnlineBanking.Domain.Entities;

public enum TransactionType
{
    Deposit = 1,
    Withdraw = 2,
    TransferOut = 3,
    TransferIn = 4
}

public sealed class Transaction
{
    public Guid Id { get; set; } = Guid.NewGuid();

    public Guid AccountId { get; set; }
    public Account Account { get; set; } = default!;

    public DateTimeOffset CreatedAtUtc { get; set; } = DateTimeOffset.UtcNow;

    public TransactionType Type { get; set; }

    public decimal Amount { get; set; }
    public decimal BalanceAfter { get; set; }

    public string? Reference { get; set; }
}
```

## 3.4 AuditLog (Real-world trace)

à¦à¦Ÿà¦¾ real banking à¦ à¦–à§à¦¬ à¦¦à¦°à¦•à¦¾à¦°: à¦•à§‡ à¦•à¦–à¦¨ à¦•à§€ à¦•à¦°à§‡à¦›à§‡à¥¤

`src/OnlineBanking.Domain/Entities/AuditLog.cs`

```csharp
namespace OnlineBanking.Domain.Entities;

public sealed class AuditLog
{
    public Guid Id { get; set; } = Guid.NewGuid();

    public DateTimeOffset CreatedAtUtc { get; set; } = DateTimeOffset.UtcNow;

    public string Action { get; set; } = "";          // e.g. LOGIN_SUCCESS, TRANSFER, ADMIN_RESET_PASSWORD
    public string ActorAccountNumber { get; set; } = ""; // who did it (accountNumber) or "SYSTEM"
    public string? TargetAccountNumber { get; set; }     // optional
    public string? Ip { get; set; }
    public string? UserAgent { get; set; }

    public string Message { get; set; } = "";
}
```

---

# 4) APPLICATION Layer (Contracts + Rules DTO)

## 4.1 Rules config model

`src/OnlineBanking.Application/Options/BankingRulesOptions.cs`

```csharp
namespace OnlineBanking.Application.Options;

public sealed class BankingRulesOptions
{
    public string CurrencySymbol { get; set; } = "à§³";
    public string TimeZoneId { get; set; } = "Asia/Dhaka";
    public decimal MinimumBalance { get; set; } = 0m;
    public decimal DailyTransferLimit { get; set; } = 0m;
}
```

## 4.2 Result wrapper (success/fail)

`src/OnlineBanking.Application/Common/Result.cs`

```csharp
namespace OnlineBanking.Application.Common;

public sealed record Result(bool Success, string Message)
{
    public static Result Ok(string msg = "OK") => new(true, msg);
    public static Result Fail(string msg) => new(false, msg);
}

public sealed record Result<T>(bool Success, string Message, T? Data)
{
    public static Result<T> Ok(T data, string msg = "OK") => new(true, msg, data);
    public static Result<T> Fail(string msg) => new(false, msg, default);
}
```

## 4.3 Contracts

`src/OnlineBanking.Application/Contracts/IAuthService.cs`

```csharp
using OnlineBanking.Application.Common;

namespace OnlineBanking.Application.Contracts;

public interface IAuthService
{
    Task<Result<string>> RegisterAsync(string name, string email, string password, string city, string ip, string userAgent);
    Task<Result<(Guid CustomerId, bool IsAdmin)>> ValidateLoginAsync(string accountNumber, string password, string ip, string userAgent);
}
```

`src/OnlineBanking.Application/Contracts/IBankingService.cs`

```csharp
using OnlineBanking.Application.Common;
using OnlineBanking.Domain.Entities;

namespace OnlineBanking.Application.Contracts;

public interface IBankingService
{
    Task<decimal> GetBalanceAsync(Guid customerId);
    Task<Result> DepositAsync(Guid customerId, decimal amount, string ip, string userAgent);
    Task<Result> WithdrawAsync(Guid customerId, decimal amount, string ip, string userAgent);
    Task<Result> TransferAsync(Guid customerId, string toAccountNumber, decimal amount, string ip, string userAgent);

    Task<(string CustomerName, string AccountNumber, decimal Balance)> GetProfileAsync(Guid customerId);

    Task<IReadOnlyList<Transaction>> GetLastTransactionsAsync(Guid customerId, int take = 10);
}
```

`src/OnlineBanking.Application/Contracts/IStatementPdfService.cs`

```csharp
using OnlineBanking.Domain.Entities;

namespace OnlineBanking.Application.Contracts;

public interface IStatementPdfService
{
    byte[] BuildMiniStatementPdf(string currency, string tzId, string accountNumber, string customerName, decimal currentBalance, IReadOnlyList<Transaction> last10);
}
```

`src/OnlineBanking.Application/Contracts/IAdminService.cs`

```csharp
using OnlineBanking.Application.Common;
using OnlineBanking.Domain.Entities;

namespace OnlineBanking.Application.Contracts;

public interface IAdminService
{
    Task<IReadOnlyList<Customer>> GetCustomersAsync();
    Task<Customer?> GetCustomerByAccountAsync(string accountNumber);

    Task<Result> SetAdminAsync(string accountNumber, bool isAdmin, string actorAcc, string ip, string ua);
    Task<Result> LockAsync(string accountNumber, int minutes, string actorAcc, string ip, string ua);
    Task<Result> UnlockAsync(string accountNumber, string actorAcc, string ip, string ua);
    Task<Result> ResetPasswordAsync(string accountNumber, string newPassword, string actorAcc, string ip, string ua);

    Task<IReadOnlyList<AuditLog>> GetLatestAuditAsync(int take = 100);
}
```

---

# 5) INFRASTRUCTURE Layer (EF Core + Services)

## 5.1 DbContext

`src/OnlineBanking.Infrastructure/Persistence/AppDbContext.cs`

```csharp
using Microsoft.EntityFrameworkCore;
using OnlineBanking.Domain.Entities;

namespace OnlineBanking.Infrastructure.Persistence;

public sealed class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) {}

    public DbSet<Customer> Customers => Set<Customer>();
    public DbSet<Account> Accounts => Set<Account>();
    public DbSet<Transaction> Transactions => Set<Transaction>();
    public DbSet<AuditLog> AuditLogs => Set<AuditLog>();

    protected override void OnModelCreating(ModelBuilder b)
    {
        b.Entity<Customer>(e =>
        {
            e.HasKey(x => x.Id);
            e.Property(x => x.Name).HasMaxLength(100).IsRequired();
            e.Property(x => x.Email).HasMaxLength(200).IsRequired();
            e.Property(x => x.City).HasMaxLength(100).IsRequired();

            e.Property(x => x.AccountNumber).HasMaxLength(5).IsRequired();
            e.Property(x => x.PasswordHash).IsRequired();

            e.HasIndex(x => x.Email).IsUnique();
            e.HasIndex(x => x.AccountNumber).IsUnique();

            e.HasOne(x => x.Account)
                .WithOne(a => a.Customer)
                .HasForeignKey<Account>(a => a.CustomerId)
                .OnDelete(DeleteBehavior.Cascade);
        });

        b.Entity<Account>(e =>
        {
            e.HasKey(x => x.Id);
            e.Property(x => x.Balance).HasPrecision(18,2);
            e.Property(x => x.RowVersion).IsRowVersion();
        });

        b.Entity<Transaction>(e =>
        {
            e.HasKey(x => x.Id);
            e.Property(x => x.Amount).HasPrecision(18,2);
            e.Property(x => x.BalanceAfter).HasPrecision(18,2);
            e.Property(x => x.Reference).HasMaxLength(200);
            e.HasIndex(x => x.CreatedAtUtc);
        });

        b.Entity<AuditLog>(e =>
        {
            e.HasKey(x => x.Id);
            e.Property(x => x.Action).HasMaxLength(80).IsRequired();
            e.Property(x => x.ActorAccountNumber).HasMaxLength(20).IsRequired();
            e.Property(x => x.TargetAccountNumber).HasMaxLength(20);
            e.Property(x => x.Ip).HasMaxLength(64);
            e.Property(x => x.UserAgent).HasMaxLength(300);
            e.Property(x => x.Message).HasMaxLength(500).IsRequired();
            e.HasIndex(x => x.CreatedAtUtc);
            e.HasIndex(x => x.Action);
        });
    }
}
```

## 5.2 Password hashing

`src/OnlineBanking.Infrastructure/Security/PasswordHasher.cs`

```csharp
namespace OnlineBanking.Infrastructure.Security;

public static class PasswordHasher
{
    public static string Hash(string password) => BCrypt.Net.BCrypt.HashPassword(password);
    public static bool Verify(string password, string hash) => BCrypt.Net.BCrypt.Verify(password, hash);
}
```

## 5.3 Audit writer helper

`src/OnlineBanking.Infrastructure/Services/AuditWriter.cs`

```csharp
using OnlineBanking.Domain.Entities;
using OnlineBanking.Infrastructure.Persistence;

namespace OnlineBanking.Infrastructure.Services;

public sealed class AuditWriter
{
    private readonly AppDbContext _db;
    public AuditWriter(AppDbContext db) => _db = db;

    public async Task WriteAsync(string action, string actorAcc, string? targetAcc, string ip, string ua, string message)
    {
        _db.AuditLogs.Add(new AuditLog
        {
            Action = action,
            ActorAccountNumber = actorAcc,
            TargetAccountNumber = targetAcc,
            Ip = ip,
            UserAgent = ua,
            Message = message
        });
        await _db.SaveChangesAsync();
    }
}
```

## 5.4 AuthService (Register/Login + lockout + audit)

Logic:

* Register â†’ unique 5-digit account number generate
* Login â†’ lock check, password verify, fail count increase, 5 fail à¦¹à¦²à§‡ 15 min lock
* Audit logs write

`src/OnlineBanking.Infrastructure/Services/AuthService.cs`

```csharp
using Microsoft.EntityFrameworkCore;
using OnlineBanking.Application.Common;
using OnlineBanking.Application.Contracts;
using OnlineBanking.Domain.Entities;
using OnlineBanking.Infrastructure.Persistence;
using OnlineBanking.Infrastructure.Security;

namespace OnlineBanking.Infrastructure.Services;

public sealed class AuthService : IAuthService
{
    private readonly AppDbContext _db;
    private readonly AuditWriter _audit;

    public AuthService(AppDbContext db, AuditWriter audit)
    {
        _db = db;
        _audit = audit;
    }

    public async Task<Result<string>> RegisterAsync(string name, string email, string password, string city, string ip, string userAgent)
    {
        email = email.Trim().ToLowerInvariant();

        if (await _db.Customers.AnyAsync(x => x.Email == email))
            return Result<string>.Fail("Email already exists.");

        // generate unique 5-digit account number
        string acc;
        int guard = 0;
        do
        {
            acc = Random.Shared.Next(10000, 100000).ToString();
            guard++;
            if (guard > 50) return Result<string>.Fail("Could not generate account number. Try again.");
        }
        while (await _db.Customers.AnyAsync(x => x.AccountNumber == acc));

        var customer = new Customer
        {
            Name = name.Trim(),
            Email = email,
            City = city.Trim(),
            AccountNumber = acc,
            PasswordHash = PasswordHasher.Hash(password),
            IsAdmin = false,
            Account = new Account { Balance = 0m }
        };

        _db.Customers.Add(customer);
        await _db.SaveChangesAsync();

        await _audit.WriteAsync("REGISTER", acc, acc, ip, userAgent, $"New customer registered: {customer.Email}");

        return Result<string>.Ok(acc, "Registered successfully.");
    }

    public async Task<Result<(Guid CustomerId, bool IsAdmin)>> ValidateLoginAsync(string accountNumber, string password, string ip, string userAgent)
    {
        accountNumber = accountNumber.Trim();

        var customer = await _db.Customers.FirstOrDefaultAsync(x => x.AccountNumber == accountNumber);
        if (customer is null)
        {
            await _audit.WriteAsync("LOGIN_FAIL", "UNKNOWN", accountNumber, ip, userAgent, "Account not found.");
            return Result<(Guid, bool)>.Fail("Invalid account number or password.");
        }

        if (customer.LockedUntilUtc.HasValue && customer.LockedUntilUtc.Value > DateTimeOffset.UtcNow)
        {
            await _audit.WriteAsync("LOGIN_BLOCKED", customer.AccountNumber, customer.AccountNumber, ip, userAgent, "Account locked.");
            return Result<(Guid, bool)>.Fail("Account is locked. Try later.");
        }

        if (!PasswordHasher.Verify(password, customer.PasswordHash))
        {
            customer.FailedLoginCount += 1;

            // lock after 5 failed attempts for 15 minutes
            if (customer.FailedLoginCount >= 5)
            {
                customer.LockedUntilUtc = DateTimeOffset.UtcNow.AddMinutes(15);
                customer.FailedLoginCount = 0;
                await _db.SaveChangesAsync();

                await _audit.WriteAsync("LOGIN_LOCKED", customer.AccountNumber, customer.AccountNumber, ip, userAgent, "Locked due to failed attempts.");
                return Result<(Guid, bool)>.Fail("Too many failed attempts. Account locked for 15 minutes.");
            }

            await _db.SaveChangesAsync();
            await _audit.WriteAsync("LOGIN_FAIL", customer.AccountNumber, customer.AccountNumber, ip, userAgent, "Wrong password.");
            return Result<(Guid, bool)>.Fail("Invalid account number or password.");
        }

        // success: reset fail count
        customer.FailedLoginCount = 0;
        customer.LockedUntilUtc = null;
        await _db.SaveChangesAsync();

        await _audit.WriteAsync("LOGIN_SUCCESS", customer.AccountNumber, customer.AccountNumber, ip, userAgent, "Login ok.");

        return Result<(Guid, bool)>.Ok((customer.Id, customer.IsAdmin), "Login ok.");
    }
}
```

## 5.5 BankingService (min balance + daily limit + audit)

Rules:

* Withdraw/Transfer à¦¶à§‡à¦·à§‡ balance >= MinimumBalance
* Transfer: à¦†à¦œà¦•à§‡à¦° total transferout <= DailyTransferLimit
* Audit: deposit/withdraw/transfer write

`src/OnlineBanking.Infrastructure/Services/BankingService.cs`

```csharp
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Options;
using OnlineBanking.Application.Common;
using OnlineBanking.Application.Contracts;
using OnlineBanking.Application.Options;
using OnlineBanking.Domain.Entities;
using OnlineBanking.Infrastructure.Persistence;

namespace OnlineBanking.Infrastructure.Services;

public sealed class BankingService : IBankingService
{
    private readonly AppDbContext _db;
    private readonly AuditWriter _audit;
    private readonly BankingRulesOptions _rules;

    public BankingService(AppDbContext db, AuditWriter audit, IOptions<BankingRulesOptions> rules)
    {
        _db = db;
        _audit = audit;
        _rules = rules.Value;
    }

    public async Task<(string CustomerName, string AccountNumber, decimal Balance)> GetProfileAsync(Guid customerId)
    {
        var row = await _db.Customers.AsNoTracking()
            .Where(c => c.Id == customerId)
            .Select(c => new { c.Name, c.AccountNumber, Balance = c.Account.Balance })
            .FirstAsync();

        return (row.Name, row.AccountNumber, row.Balance);
    }

    public async Task<decimal> GetBalanceAsync(Guid customerId)
    {
        return await _db.Accounts.AsNoTracking()
            .Where(a => a.CustomerId == customerId)
            .Select(a => a.Balance)
            .FirstAsync();
    }

    public async Task<Result> DepositAsync(Guid customerId, decimal amount, string ip, string userAgent)
    {
        if (amount <= 0) return Result.Fail("Amount must be greater than 0.");

        await using var tx = await _db.Database.BeginTransactionAsync();

        var customer = await _db.Customers.Include(c => c.Account).FirstAsync(c => c.Id == customerId);
        customer.Account.Balance += amount;

        _db.Transactions.Add(new Transaction
        {
            AccountId = customer.Account.Id,
            Type = TransactionType.Deposit,
            Amount = amount,
            BalanceAfter = customer.Account.Balance,
            Reference = "Cash deposit"
        });

        await _db.SaveChangesAsync();
        await tx.CommitAsync();

        await _audit.WriteAsync("DEPOSIT", customer.AccountNumber, customer.AccountNumber, ip, userAgent, $"Deposit {amount:0.00}");

        return Result.Ok("Deposit successful.");
    }

    public async Task<Result> WithdrawAsync(Guid customerId, decimal amount, string ip, string userAgent)
    {
        if (amount <= 0) return Result.Fail("Amount must be greater than 0.");

        await using var tx = await _db.Database.BeginTransactionAsync();

        var customer = await _db.Customers.Include(c => c.Account).FirstAsync(c => c.Id == customerId);

        if (customer.Account.Balance < amount) return Result.Fail("Insufficient balance.");

        var newBalance = customer.Account.Balance - amount;
        if (newBalance < _rules.MinimumBalance)
            return Result.Fail($"Minimum balance rule: balance cannot go below {_rules.MinimumBalance:0.00}");

        customer.Account.Balance = newBalance;

        _db.Transactions.Add(new Transaction
        {
            AccountId = customer.Account.Id,
            Type = TransactionType.Withdraw,
            Amount = amount,
            BalanceAfter = customer.Account.Balance,
            Reference = "Cash withdraw"
        });

        await _db.SaveChangesAsync();
        await tx.CommitAsync();

        await _audit.WriteAsync("WITHDRAW", customer.AccountNumber, customer.AccountNumber, ip, userAgent, $"Withdraw {amount:0.00}");

        return Result.Ok("Withdraw successful.");
    }

    public async Task<Result> TransferAsync(Guid customerId, string toAccountNumber, decimal amount, string ip, string userAgent)
    {
        if (amount <= 0) return Result.Fail("Amount must be greater than 0.");
        toAccountNumber = toAccountNumber.Trim();

        await using var tx = await _db.Database.BeginTransactionAsync();

        var fromCustomer = await _db.Customers.Include(c => c.Account)
            .FirstAsync(c => c.Id == customerId);

        var toCustomer = await _db.Customers.Include(c => c.Account)
            .FirstOrDefaultAsync(c => c.AccountNumber == toAccountNumber);

        if (toCustomer is null) return Result.Fail("Receiver account not found.");
        if (toCustomer.Id == fromCustomer.Id) return Result.Fail("Cannot transfer to same account.");

        // daily transfer limit check (sum of TransferOut today UTC date)
        var todayUtc = DateTimeOffset.UtcNow.Date;
        var fromAccountId = fromCustomer.Account.Id;

        var todayTransferOut = await _db.Transactions.AsNoTracking()
            .Where(t => t.AccountId == fromAccountId
                        && t.Type == TransactionType.TransferOut
                        && t.CreatedAtUtc >= todayUtc
                        && t.CreatedAtUtc < todayUtc.AddDays(1))
            .SumAsync(t => (decimal?)t.Amount) ?? 0m;

        if (todayTransferOut + amount > _rules.DailyTransferLimit)
            return Result.Fail($"Daily transfer limit exceeded. Limit: {_rules.DailyTransferLimit:0.00}");

        if (fromCustomer.Account.Balance < amount) return Result.Fail("Insufficient balance.");

        var newBalance = fromCustomer.Account.Balance - amount;
        if (newBalance < _rules.MinimumBalance)
            return Result.Fail($"Minimum balance rule: balance cannot go below {_rules.MinimumBalance:0.00}");

        // apply
        fromCustomer.Account.Balance = newBalance;
        toCustomer.Account.Balance += amount;

        _db.Transactions.Add(new Transaction
        {
            AccountId = fromCustomer.Account.Id,
            Type = TransactionType.TransferOut,
            Amount = amount,
            BalanceAfter = fromCustomer.Account.Balance,
            Reference = $"Transfer to {toCustomer.AccountNumber}"
        });

        _db.Transactions.Add(new Transaction
        {
            AccountId = toCustomer.Account.Id,
            Type = TransactionType.TransferIn,
            Amount = amount,
            BalanceAfter = toCustomer.Account.Balance,
            Reference = $"Transfer from {fromCustomer.AccountNumber}"
        });

        await _db.SaveChangesAsync();
        await tx.CommitAsync();

        await _audit.WriteAsync("TRANSFER", fromCustomer.AccountNumber, toCustomer.AccountNumber, ip, userAgent, $"Transfer {amount:0.00} to {toCustomer.AccountNumber}");

        return Result.Ok("Transfer successful.");
    }

    public async Task<IReadOnlyList<Transaction>> GetLastTransactionsAsync(Guid customerId, int take = 10)
    {
        var accountId = await _db.Accounts
            .Where(a => a.CustomerId == customerId)
            .Select(a => a.Id)
            .FirstAsync();

        return await _db.Transactions.AsNoTracking()
            .Where(t => t.AccountId == accountId)
            .OrderByDescending(t => t.CreatedAtUtc)
            .Take(take)
            .ToListAsync();
    }
}
```

## 5.6 PDF Statement Service (DB name + Dhaka time + currency)

à¦•à¦¾à¦œ: last 10 tx table + Dhaka time conversion

`src/OnlineBanking.Infrastructure/Services/StatementPdfService.cs`

```csharp
using OnlineBanking.Application.Contracts;
using OnlineBanking.Domain.Entities;
using QuestPDF.Fluent;
using QuestPDF.Helpers;
using QuestPDF.Infrastructure;

namespace OnlineBanking.Infrastructure.Services;

public sealed class StatementPdfService : IStatementPdfService
{
    public byte[] BuildMiniStatementPdf(string currency, string tzId, string accountNumber, string customerName, decimal currentBalance, IReadOnlyList<Transaction> last10)
    {
        QuestPDF.Settings.License = LicenseType.Community;

        var tz = TimeZoneInfo.FindSystemTimeZoneById(tzId);

        string ToLocal(DateTimeOffset utc)
        {
            var local = TimeZoneInfo.ConvertTime(utc, tz);
            return local.ToString("yyyy-MM-dd HH:mm:ss");
        }

        var doc = Document.Create(container =>
        {
            container.Page(page =>
            {
                page.Margin(30);
                page.Size(PageSizes.A4);

                page.Header().Column(col =>
                {
                    col.Item().Text("Mini Statement (Last 10 Transactions)").FontSize(18).SemiBold();
                    col.Item().Text($"Account: {accountNumber}").FontSize(12);
                    col.Item().Text($"Customer: {customerName}").FontSize(12);
                    col.Item().Text($"Current Balance: {currency}{currentBalance:0.00}").FontSize(12);
                    col.Item().Text($"Time Zone: {tzId}").FontSize(10).FontColor(Colors.Grey.Darken2);
                    col.Item().LineHorizontal(1);
                });

                page.Content().Table(table =>
                {
                    table.ColumnsDefinition(columns =>
                    {
                        columns.RelativeColumn(3);
                        columns.RelativeColumn(2);
                        columns.RelativeColumn(2);
                    });

                    table.Header(header =>
                    {
                        header.Cell().Element(CellStyle).Text($"Date & Time ({tzId})").SemiBold();
                        header.Cell().Element(CellStyle).Text("Type").SemiBold();
                        header.Cell().Element(CellStyle).Text("Amount").SemiBold();
                    });

                    foreach (var t in last10.OrderByDescending(x => x.CreatedAtUtc))
                    {
                        table.Cell().Element(CellStyle).Text(ToLocal(t.CreatedAtUtc));
                        table.Cell().Element(CellStyle).Text(t.Type.ToString());
                        table.Cell().Element(CellStyle).Text($"{currency}{t.Amount:0.00}");
                    }

                    static IContainer CellStyle(IContainer container) =>
                        container.Border(1).BorderColor(Colors.Grey.Lighten2).Padding(6);
                });

                page.Footer().AlignRight().Text($"Generated (UTC): {DateTimeOffset.UtcNow:yyyy-MM-dd HH:mm:ss}");
            });
        });

        return doc.GeneratePdf();
    }
}
```

## 5.7 AdminService (User management + audit read)

`src/OnlineBanking.Infrastructure/Services/AdminService.cs`

```csharp
using Microsoft.EntityFrameworkCore;
using OnlineBanking.Application.Common;
using OnlineBanking.Application.Contracts;
using OnlineBanking.Domain.Entities;
using OnlineBanking.Infrastructure.Persistence;
using OnlineBanking.Infrastructure.Security;

namespace OnlineBanking.Infrastructure.Services;

public sealed class AdminService : IAdminService
{
    private readonly AppDbContext _db;
    private readonly AuditWriter _audit;

    public AdminService(AppDbContext db, AuditWriter audit)
    {
        _db = db;
        _audit = audit;
    }

    public async Task<IReadOnlyList<Customer>> GetCustomersAsync()
    {
        return await _db.Customers.AsNoTracking()
            .OrderBy(c => c.AccountNumber)
            .ToListAsync();
    }

    public async Task<Customer?> GetCustomerByAccountAsync(string accountNumber)
    {
        accountNumber = accountNumber.Trim();
        return await _db.Customers.FirstOrDefaultAsync(c => c.AccountNumber == accountNumber);
    }

    public async Task<Result> SetAdminAsync(string accountNumber, bool isAdmin, string actorAcc, string ip, string ua)
    {
        var c = await GetCustomerByAccountAsync(accountNumber);
        if (c is null) return Result.Fail("Customer not found.");
        c.IsAdmin = isAdmin;
        await _db.SaveChangesAsync();

        await _audit.WriteAsync("ADMIN_SET_ROLE", actorAcc, c.AccountNumber, ip, ua, $"Set IsAdmin={isAdmin}");
        return Result.Ok("Role updated.");
    }

    public async Task<Result> LockAsync(string accountNumber, int minutes, string actorAcc, string ip, string ua)
    {
        var c = await GetCustomerByAccountAsync(accountNumber);
        if (c is null) return Result.Fail("Customer not found.");
        c.LockedUntilUtc = DateTimeOffset.UtcNow.AddMinutes(minutes);
        c.FailedLoginCount = 0;
        await _db.SaveChangesAsync();

        await _audit.WriteAsync("ADMIN_LOCK", actorAcc, c.AccountNumber, ip, ua, $"Locked for {minutes} minutes");
        return Result.Ok("Locked.");
    }

    public async Task<Result> UnlockAsync(string accountNumber, string actorAcc, string ip, string ua)
    {
        var c = await GetCustomerByAccountAsync(accountNumber);
        if (c is null) return Result.Fail("Customer not found.");
        c.LockedUntilUtc = null;
        c.FailedLoginCount = 0;
        await _db.SaveChangesAsync();

        await _audit.WriteAsync("ADMIN_UNLOCK", actorAcc, c.AccountNumber, ip, ua, "Unlocked");
        return Result.Ok("Unlocked.");
    }

    public async Task<Result> ResetPasswordAsync(string accountNumber, string newPassword, string actorAcc, string ip, string ua)
    {
        var c = await GetCustomerByAccountAsync(accountNumber);
        if (c is null) return Result.Fail("Customer not found.");

        c.PasswordHash = PasswordHasher.Hash(newPassword);
        c.FailedLoginCount = 0;
        c.LockedUntilUtc = null;

        await _db.SaveChangesAsync();
        await _audit.WriteAsync("ADMIN_RESET_PASSWORD", actorAcc, c.AccountNumber, ip, ua, "Password reset");
        return Result.Ok("Password reset done.");
    }

    public async Task<IReadOnlyList<AuditLog>> GetLatestAuditAsync(int take = 100)
    {
        return await _db.AuditLogs.AsNoTracking()
            .OrderByDescending(a => a.CreatedAtUtc)
            .Take(take)
            .ToListAsync();
    }
}
```

---

# 6) WEB Layer (MVC + Bootstrap UI + Cookie auth + Admin policy)

## 6.1 Program.cs

âœ… à¦à¦–à¦¾à¦¨à§‡:

* DB connect
* Rules options bind
* Cookie auth + secure cookie
* Admin authorization policy
* Seed admin user (startup à¦ admin create à¦•à¦°à¦¬à§‡)

`src/OnlineBanking.Web/Program.cs`

```csharp
using System.Security.Claims;
using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Options;
using OnlineBanking.Application.Contracts;
using OnlineBanking.Application.Options;
using OnlineBanking.Infrastructure.Persistence;
using OnlineBanking.Infrastructure.Services;
using OnlineBanking.Infrastructure.Security;
using OnlineBanking.Domain.Entities;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllersWithViews(options =>
{
    options.Filters.Add(new Microsoft.AspNetCore.Mvc.AutoValidateAntiforgeryTokenAttribute());
});

builder.Services.Configure<BankingRulesOptions>(builder.Configuration.GetSection("BankingRules"));

builder.Services.AddDbContext<AppDbContext>(opt =>
{
    var cs = builder.Configuration.GetConnectionString("MySql");
    opt.UseMySql(cs, ServerVersion.AutoDetect(cs));
});

// Auth cookie
builder.Services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
    .AddCookie(opt =>
    {
        opt.LoginPath = "/Account/Login";
        opt.LogoutPath = "/Account/Logout";
        opt.AccessDeniedPath = "/Account/Login";
        opt.Cookie.HttpOnly = true;
        opt.Cookie.SameSite = SameSiteMode.Strict;
        opt.Cookie.SecurePolicy = CookieSecurePolicy.Always; // HTTPS required
        opt.SlidingExpiration = true;
        opt.ExpireTimeSpan = TimeSpan.FromMinutes(30);
    });

builder.Services.AddAuthorization(opt =>
{
    opt.AddPolicy("AdminOnly", policy =>
        policy.RequireClaim("IsAdmin", "true"));
});

builder.Services.AddScoped<AuditWriter>();
builder.Services.AddScoped<IAuthService, AuthService>();
builder.Services.AddScoped<IBankingService, BankingService>();
builder.Services.AddScoped<IStatementPdfService, StatementPdfService>();
builder.Services.AddScoped<IAdminService, AdminService>();

var app = builder.Build();

// Seed Admin on startup
using (var scope = app.Services.CreateScope())
{
    var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();
    await db.Database.MigrateAsync();

    var adminCfg = app.Configuration.GetSection("AdminSeed");
    var email = adminCfg["Email"]!;
    var pass = adminCfg["Password"]!;
    var name = adminCfg["Name"] ?? "Admin";
    var city = adminCfg["City"] ?? "Dhaka";

    if (!await db.Customers.AnyAsync(c => c.Email == email.ToLower()))
    {
        // create admin with random 5-digit account
        string acc;
        int guard = 0;
        do
        {
            acc = Random.Shared.Next(10000, 100000).ToString();
            guard++;
            if (guard > 50) throw new Exception("Could not seed admin account number.");
        } while (await db.Customers.AnyAsync(x => x.AccountNumber == acc));

        var admin = new Customer
        {
            Name = name,
            Email = email.ToLower(),
            City = city,
            AccountNumber = acc,
            PasswordHash = PasswordHasher.Hash(pass),
            IsAdmin = true,
            Account = new Account { Balance = 0m }
        };

        db.Customers.Add(admin);
        await db.SaveChangesAsync();

        db.AuditLogs.Add(new AuditLog
        {
            Action = "SYSTEM_SEED_ADMIN",
            ActorAccountNumber = "SYSTEM",
            TargetAccountNumber = acc,
            Message = $"Admin seeded: {email}"
        });
        await db.SaveChangesAsync();

        Console.WriteLine($"Seeded Admin AccountNumber: {acc}");
    }
}

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Home/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

// basic security headers
app.Use(async (ctx, next) =>
{
    ctx.Response.Headers["X-Content-Type-Options"] = "nosniff";
    ctx.Response.Headers["X-Frame-Options"] = "DENY";
    ctx.Response.Headers["Referrer-Policy"] = "no-referrer";
    ctx.Response.Headers["Content-Security-Policy"] =
        "default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'";
    await next();
});

app.UseRouting();
app.UseAuthentication();
app.UseAuthorization();

app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Banking}/{action=Dashboard}/{id?}");

app.Run();
```

---

# 7) Controllers + ViewModels + Views (Bootstrap UI)

## 7.1 ViewModels

`src/OnlineBanking.Web/Models/RegisterVm.cs`

```csharp
using System.ComponentModel.DataAnnotations;

namespace OnlineBanking.Web.Models;

public sealed class RegisterVm
{
    [Required, StringLength(100)]
    public string Name { get; set; } = "";

    [Required, EmailAddress, StringLength(200)]
    public string Email { get; set; } = "";

    [Required, StringLength(100)]
    public string City { get; set; } = "";

    [Required, MinLength(6), MaxLength(100)]
    public string Password { get; set; } = "";
}
```

`src/OnlineBanking.Web/Models/LoginVm.cs`

```csharp
using System.ComponentModel.DataAnnotations;

namespace OnlineBanking.Web.Models;

public sealed class LoginVm
{
    [Required, StringLength(5, MinimumLength = 5)]
    public string AccountNumber { get; set; } = "";

    [Required]
    public string Password { get; set; } = "";
}
```

`src/OnlineBanking.Web/Models/AmountVm.cs`

```csharp
using System.ComponentModel.DataAnnotations;

namespace OnlineBanking.Web.Models;

public sealed class AmountVm
{
    [Required]
    [Range(0.01, 100000000)]
    public decimal Amount { get; set; }
}
```

`src/OnlineBanking.Web/Models/TransferVm.cs`

```csharp
using System.ComponentModel.DataAnnotations;

namespace OnlineBanking.Web.Models;

public sealed class TransferVm
{
    [Required, StringLength(5, MinimumLength = 5)]
    public string ToAccountNumber { get; set; } = "";

    [Required]
    [Range(0.01, 100000000)]
    public decimal Amount { get; set; }
}
```

`src/OnlineBanking.Web/Models/AdminResetPasswordVm.cs`

```csharp
using System.ComponentModel.DataAnnotations;

namespace OnlineBanking.Web.Models;

public sealed class AdminResetPasswordVm
{
    [Required, StringLength(5, MinimumLength = 5)]
    public string AccountNumber { get; set; } = "";

    [Required, MinLength(6), MaxLength(100)]
    public string NewPassword { get; set; } = "";
}
```

---

## 7.2 AccountController (Register/Login/Logout)

à¦¬à§à¦¯à¦¾à¦–à§à¦¯à¦¾ (Bangla):

* `Register` POST â†’ IAuthService.RegisterAsync à¦•à¦² à¦•à¦°à§‡
* Success à¦¹à¦²à§‡ account number à¦¦à§‡à¦–à¦¾à§Ÿ
* `Login` POST â†’ ValidateLoginAsync â†’ Cookie sign-in with claims
* Admin à¦¹à¦²à§‡ claim `IsAdmin=true` à¦¬à¦¸à¦¾à§Ÿ â†’ Admin policy à¦•à¦¾à¦œ à¦•à¦°à¦¬à§‡

`src/OnlineBanking.Web/Controllers/AccountController.cs`

```csharp
using System.Security.Claims;
using Microsoft.AspNetCore.Authentication;
using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.AspNetCore.Mvc;
using OnlineBanking.Application.Contracts;
using OnlineBanking.Web.Models;

namespace OnlineBanking.Web.Controllers;

public sealed class AccountController : Controller
{
    private readonly IAuthService _auth;
    public AccountController(IAuthService auth) => _auth = auth;

    private (string ip, string ua) ClientInfo()
    {
        var ip = HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";
        var ua = Request.Headers.UserAgent.ToString();
        return (ip, ua);
    }

    [HttpGet]
    public IActionResult Register() => View(new RegisterVm());

    [HttpPost]
    public async Task<IActionResult> Register(RegisterVm vm)
    {
        if (!ModelState.IsValid) return View(vm);

        var (ip, ua) = ClientInfo();
        var res = await _auth.RegisterAsync(vm.Name, vm.Email, vm.Password, vm.City, ip, ua);

        if (!res.Success)
        {
            ModelState.AddModelError("", res.Message);
            return View(vm);
        }

        TempData["AccountNumber"] = res.Data;
        return RedirectToAction(nameof(RegisterSuccess));
    }

    [HttpGet]
    public IActionResult RegisterSuccess()
    {
        ViewBag.AccountNumber = TempData["AccountNumber"]?.ToString();
        return View();
    }

    [HttpGet]
    public IActionResult Login() => View(new LoginVm());

    [HttpPost]
    public async Task<IActionResult> Login(LoginVm vm)
    {
        if (!ModelState.IsValid) return View(vm);

        var (ip, ua) = ClientInfo();
        var res = await _auth.ValidateLoginAsync(vm.AccountNumber, vm.Password, ip, ua);

        if (!res.Success)
        {
            ModelState.AddModelError("", res.Message);
            return View(vm);
        }

        var (customerId, isAdmin) = res.Data!.Value;

        var claims = new List<Claim>
        {
            new Claim("CustomerId", customerId.ToString()),
            new Claim("AccountNumber", vm.AccountNumber),
            new Claim(ClaimTypes.Name, vm.AccountNumber),
            new Claim("IsAdmin", isAdmin ? "true" : "false")
        };

        var identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
        var principal = new ClaimsPrincipal(identity);

        await HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme, principal);
        return RedirectToAction("Dashboard", "Banking");
    }

    [HttpPost]
    public async Task<IActionResult> Logout()
    {
        await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);
        return RedirectToAction(nameof(Login));
    }
}
```

---

## 7.3 BankingController (Dashboard + actions + PDF)

à¦¬à§à¦¯à¦¾à¦–à§à¦¯à¦¾:

* `Dashboard` â†’ balance + last10 à¦¦à§‡à¦–à¦¾à§Ÿ
* Deposit/Withdraw/Transfer â†’ IBankingService à¦•à¦² à¦•à¦°à§‡
* PDF â†’ profile (name+acc+balance) + last10 â†’ pdf bytes generate

`src/OnlineBanking.Web/Controllers/BankingController.cs`

```csharp
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Options;
using OnlineBanking.Application.Contracts;
using OnlineBanking.Application.Options;
using OnlineBanking.Web.Models;

namespace OnlineBanking.Web.Controllers;

[Authorize]
public sealed class BankingController : Controller
{
    private readonly IBankingService _banking;
    private readonly IStatementPdfService _pdf;
    private readonly BankingRulesOptions _rules;

    public BankingController(IBankingService banking, IStatementPdfService pdf, IOptions<BankingRulesOptions> rules)
    {
        _banking = banking;
        _pdf = pdf;
        _rules = rules.Value;
    }

    private Guid CustomerId => Guid.Parse(User.Claims.First(x => x.Type == "CustomerId").Value);

    private (string ip, string ua) ClientInfo()
    {
        var ip = HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";
        var ua = Request.Headers.UserAgent.ToString();
        return (ip, ua);
    }

    [HttpGet]
    public async Task<IActionResult> Dashboard()
    {
        ViewBag.Rules = _rules;
        ViewBag.Profile = await _banking.GetProfileAsync(CustomerId);
        ViewBag.Last10 = await _banking.GetLastTransactionsAsync(CustomerId, 10);
        return View();
    }

    [HttpPost]
    public async Task<IActionResult> Deposit(AmountVm vm)
    {
        var (ip, ua) = ClientInfo();
        if (!ModelState.IsValid) { TempData["Msg"] = "Invalid amount."; return RedirectToAction(nameof(Dashboard)); }
        var res = await _banking.DepositAsync(CustomerId, vm.Amount, ip, ua);
        TempData["Msg"] = res.Message;
        return RedirectToAction(nameof(Dashboard));
    }

    [HttpPost]
    public async Task<IActionResult> Withdraw(AmountVm vm)
    {
        var (ip, ua) = ClientInfo();
        if (!ModelState.IsValid) { TempData["Msg"] = "Invalid amount."; return RedirectToAction(nameof(Dashboard)); }
        var res = await _banking.WithdrawAsync(CustomerId, vm.Amount, ip, ua);
        TempData["Msg"] = res.Message;
        return RedirectToAction(nameof(Dashboard));
    }

    [HttpPost]
    public async Task<IActionResult> Transfer(TransferVm vm)
    {
        var (ip, ua) = ClientInfo();
        if (!ModelState.IsValid) { TempData["Msg"] = "Invalid transfer input."; return RedirectToAction(nameof(Dashboard)); }
        var res = await _banking.TransferAsync(CustomerId, vm.ToAccountNumber, vm.Amount, ip, ua);
        TempData["Msg"] = res.Message;
        return RedirectToAction(nameof(Dashboard));
    }

    [HttpGet]
    public async Task<IActionResult> MiniStatementPdf()
    {
        var profile = await _banking.GetProfileAsync(CustomerId);
        var last10 = await _banking.GetLastTransactionsAsync(CustomerId, 10);

        var pdfBytes = _pdf.BuildMiniStatementPdf(
            currency: _rules.CurrencySymbol,
            tzId: _rules.TimeZoneId,
            accountNumber: profile.AccountNumber,
            customerName: profile.CustomerName,
            currentBalance: profile.Balance,
            last10: last10);

        return File(pdfBytes, "application/pdf", $"mini-statement-{profile.AccountNumber}.pdf");
    }
}
```

---

## 7.4 AdminController (Admin panel)

à¦¬à§à¦¯à¦¾à¦–à§à¦¯à¦¾:

* `[Authorize(Policy="AdminOnly")]` â†’ à¦¶à§à¦§à§ admin à¦¢à§à¦•à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡
* Customers list
* lock/unlock/set admin/reset password
* audit logs view

`src/OnlineBanking.Web/Controllers/AdminController.cs`

```csharp
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using OnlineBanking.Application.Contracts;
using OnlineBanking.Web.Models;

namespace OnlineBanking.Web.Controllers;

[Authorize(Policy = "AdminOnly")]
public sealed class AdminController : Controller
{
    private readonly IAdminService _admin;

    public AdminController(IAdminService admin) => _admin = admin;

    private string ActorAcc => User.Claims.First(x => x.Type == "AccountNumber").Value;

    private (string ip, string ua) ClientInfo()
    {
        var ip = HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";
        var ua = Request.Headers.UserAgent.ToString();
        return (ip, ua);
    }

    [HttpGet]
    public async Task<IActionResult> Customers()
    {
        var list = await _admin.GetCustomersAsync();
        return View(list);
    }

    [HttpPost]
    public async Task<IActionResult> SetAdmin(string accountNumber, bool isAdmin)
    {
        var (ip, ua) = ClientInfo();
        var res = await _admin.SetAdminAsync(accountNumber, isAdmin, ActorAcc, ip, ua);
        TempData["Msg"] = res.Message;
        return RedirectToAction(nameof(Customers));
    }

    [HttpPost]
    public async Task<IActionResult> Lock(string accountNumber, int minutes = 30)
    {
        var (ip, ua) = ClientInfo();
        var res = await _admin.LockAsync(accountNumber, minutes, ActorAcc, ip, ua);
        TempData["Msg"] = res.Message;
        return RedirectToAction(nameof(Customers));
    }

    [HttpPost]
    public async Task<IActionResult> Unlock(string accountNumber)
    {
        var (ip, ua) = ClientInfo();
        var res = await _admin.UnlockAsync(accountNumber, ActorAcc, ip, ua);
        TempData["Msg"] = res.Message;
        return RedirectToAction(nameof(Customers));
    }

    [HttpGet]
    public IActionResult ResetPassword() => View(new AdminResetPasswordVm());

    [HttpPost]
    public async Task<IActionResult> ResetPassword(AdminResetPasswordVm vm)
    {
        var (ip, ua) = ClientInfo();
        if (!ModelState.IsValid) return View(vm);
        var res = await _admin.ResetPasswordAsync(vm.AccountNumber, vm.NewPassword, ActorAcc, ip, ua);
        TempData["Msg"] = res.Message;
        return RedirectToAction(nameof(Customers));
    }

    [HttpGet]
    public async Task<IActionResult> Audit()
    {
        var logs = await _admin.GetLatestAuditAsync(150);
        return View(logs);
    }
}
```

---

# 8) Bootstrap UI (Layout + Views)

## 8.1 Shared Layout

`src/OnlineBanking.Web/Views/Shared/_Layout.cshtml`

```html
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>@ViewData["Title"] - OnlineBanking</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">OnlineBanking</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        @if (User.Identity?.IsAuthenticated ?? false)
        {
          <li class="nav-item"><a class="nav-link" href="/Banking/Dashboard">Dashboard</a></li>
          @if (User.Claims.FirstOrDefault(c => c.Type == "IsAdmin")?.Value == "true")
          {
            <li class="nav-item"><a class="nav-link" href="/Admin/Customers">Admin</a></li>
            <li class="nav-item"><a class="nav-link" href="/Admin/Audit">Audit</a></li>
          }
        }
      </ul>

      <ul class="navbar-nav">
        @if (User.Identity?.IsAuthenticated ?? false)
        {
          <li class="nav-item">
            <form method="post" action="/Account/Logout">
              <button class="btn btn-sm btn-outline-light" type="submit">Logout</button>
            </form>
          </li>
        }
        else
        {
          <li class="nav-item"><a class="nav-link" href="/Account/Login">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="/Account/Register">Register</a></li>
        }
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">
  @if (TempData["Msg"] != null)
  {
    <div class="alert alert-info">@TempData["Msg"]</div>
  }
  @RenderBody()
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
```

## 8.2 Account Views

`Views/Account/Register.cshtml`

```html
@model OnlineBanking.Web.Models.RegisterVm
@{ ViewData["Title"] = "Register"; }

<div class="row justify-content-center">
  <div class="col-md-6">
    <h3>Register</h3>
    <form method="post" class="card card-body">
      <div asp-validation-summary="All" class="text-danger"></div>

      <label class="form-label">Name</label>
      <input class="form-control" asp-for="Name" />

      <label class="form-label mt-2">Email</label>
      <input class="form-control" asp-for="Email" />

      <label class="form-label mt-2">City</label>
      <input class="form-control" asp-for="City" />

      <label class="form-label mt-2">Password</label>
      <input class="form-control" asp-for="Password" type="password" />

      <button class="btn btn-primary mt-3" type="submit">Register</button>
    </form>
  </div>
</div>
```

`Views/Account/RegisterSuccess.cshtml`

```html
@{ ViewData["Title"] = "Success"; }
<div class="alert alert-success">
  <h4>Registration Successful</h4>
  <p>Your 5-digit Account Number: <b>@ViewBag.AccountNumber</b></p>
  <p>Use this account number to login.</p>
</div>
<a class="btn btn-dark" href="/Account/Login">Go to Login</a>
```

`Views/Account/Login.cshtml`

```html
@model OnlineBanking.Web.Models.LoginVm
@{ ViewData["Title"] = "Login"; }

<div class="row justify-content-center">
  <div class="col-md-5">
    <h3>Login</h3>
    <form method="post" class="card card-body">
      <div asp-validation-summary="All" class="text-danger"></div>

      <label class="form-label">Account Number</label>
      <input class="form-control" asp-for="AccountNumber" />

      <label class="form-label mt-2">Password</label>
      <input class="form-control" asp-for="Password" type="password" />

      <button class="btn btn-primary mt-3" type="submit">Login</button>
      <a class="btn btn-link mt-2" href="/Account/Register">Create account</a>
    </form>
  </div>
</div>
```

## 8.3 Banking Dashboard view

`Views/Banking/Dashboard.cshtml`

```html
@{
  ViewData["Title"] = "Dashboard";
  var profile = ((string CustomerName, string AccountNumber, decimal Balance))ViewBag.Profile;
  var rules = ViewBag.Rules;
  var last10 = (IEnumerable<dynamic>)ViewBag.Last10;
}
<h3>Welcome, @profile.CustomerName</h3>

<div class="row">
  <div class="col-md-6">
    <div class="card card-body">
      <p><b>Account:</b> @profile.AccountNumber</p>
      <p><b>Balance:</b> @rules.CurrencySymbol@profile.Balance</p>
      <p class="text-muted mb-0">
        Min Balance: @rules.CurrencySymbol@rules.MinimumBalance |
        Daily Transfer Limit: @rules.CurrencySymbol@rules.DailyTransferLimit |
        TZ: @rules.TimeZoneId
      </p>
      <a class="btn btn-outline-dark mt-3" href="/Banking/MiniStatementPdf">Download Mini Statement (PDF)</a>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card card-body">
      <h5>Deposit</h5>
      <form method="post" action="/Banking/Deposit" class="d-flex gap-2">
        <input class="form-control" name="Amount" placeholder="Amount" />
        <button class="btn btn-success" type="submit">Deposit</button>
      </form>

      <h5 class="mt-4">Withdraw</h5>
      <form method="post" action="/Banking/Withdraw" class="d-flex gap-2">
        <input class="form-control" name="Amount" placeholder="Amount" />
        <button class="btn btn-warning" type="submit">Withdraw</button>
      </form>

      <h5 class="mt-4">Transfer</h5>
      <form method="post" action="/Banking/Transfer" class="row g-2">
        <div class="col-6"><input class="form-control" name="ToAccountNumber" placeholder="To (5-digit)" /></div>
        <div class="col-6"><input class="form-control" name="Amount" placeholder="Amount" /></div>
        <div class="col-12"><button class="btn btn-primary w-100" type="submit">Transfer</button></div>
      </form>
    </div>
  </div>
</div>

<div class="card card-body mt-4">
  <h5>Last 10 Transactions (UTC stored; PDF shows Dhaka time)</h5>
  <table class="table table-sm table-striped">
    <thead>
      <tr>
        <th>UTC Time</th><th>Type</th><th>Amount</th><th>Balance After</th><th>Reference</th>
      </tr>
    </thead>
    <tbody>
    @foreach (var t in last10)
    {
      <tr>
        <td>@t.CreatedAtUtc</td>
        <td>@t.Type</td>
        <td>@rules.CurrencySymbol@t.Amount</td>
        <td>@rules.CurrencySymbol@t.BalanceAfter</td>
        <td>@t.Reference</td>
      </tr>
    }
    </tbody>
  </table>
</div>
```

## 8.4 Admin views

`Views/Admin/Customers.cshtml`

```html
@model IEnumerable<OnlineBanking.Domain.Entities.Customer>
@{ ViewData["Title"] = "Admin - Customers"; }

<h3>Customers</h3>

<table class="table table-sm table-striped">
  <thead>
    <tr>
      <th>Acc</th><th>Name</th><th>Email</th><th>City</th><th>Admin</th><th>LockedUntil(UTC)</th><th>Actions</th>
    </tr>
  </thead>
  <tbody>
  @foreach (var c in Model)
  {
    <tr>
      <td>@c.AccountNumber</td>
      <td>@c.Name</td>
      <td>@c.Email</td>
      <td>@c.City</td>
      <td>@c.IsAdmin</td>
      <td>@c.LockedUntilUtc</td>
      <td>
        <form method="post" action="/Admin/SetAdmin" class="d-inline">
          <input type="hidden" name="accountNumber" value="@c.AccountNumber" />
          <input type="hidden" name="isAdmin" value="@(c.IsAdmin ? "false" : "true")" />
          <button class="btn btn-sm btn-outline-primary" type="submit">
            @(c.IsAdmin ? "Remove Admin" : "Make Admin")
          </button>
        </form>

        <form method="post" action="/Admin/Lock" class="d-inline">
          <input type="hidden" name="accountNumber" value="@c.AccountNumber" />
          <input type="hidden" name="minutes" value="30" />
          <button class="btn btn-sm btn-outline-warning" type="submit">Lock 30m</button>
        </form>

        <form method="post" action="/Admin/Unlock" class="d-inline">
          <input type="hidden" name="accountNumber" value="@c.AccountNumber" />
          <button class="btn btn-sm btn-outline-success" type="submit">Unlock</button>
        </form>
      </td>
    </tr>
  }
  </tbody>
</table>

<a class="btn btn-dark" href="/Admin/ResetPassword">Reset User Password</a>
```

`Views/Admin/ResetPassword.cshtml`

```html
@model OnlineBanking.Web.Models.AdminResetPasswordVm
@{ ViewData["Title"] = "Admin - Reset Password"; }

<h3>Reset Password</h3>

<form method="post" class="card card-body col-md-6">
  <div asp-validation-summary="All" class="text-danger"></div>

  <label class="form-label">Account Number</label>
  <input class="form-control" asp-for="AccountNumber" />

  <label class="form-label mt-2">New Password</label>
  <input class="form-control" asp-for="NewPassword" />

  <button class="btn btn-primary mt-3" type="submit">Reset</button>
</form>
```

`Views/Admin/Audit.cshtml`

```html
@model IEnumerable<OnlineBanking.Domain.Entities.AuditLog>
@{ ViewData["Title"] = "Admin - Audit Logs"; }

<h3>Audit Logs (Latest)</h3>

<table class="table table-sm table-striped">
  <thead>
    <tr>
      <th>UTC</th><th>Action</th><th>Actor</th><th>Target</th><th>IP</th><th>Message</th>
    </tr>
  </thead>
  <tbody>
  @foreach (var a in Model)
  {
    <tr>
      <td>@a.CreatedAtUtc</td>
      <td>@a.Action</td>
      <td>@a.ActorAccountNumber</td>
      <td>@a.TargetAccountNumber</td>
      <td>@a.Ip</td>
      <td>@a.Message</td>
    </tr>
  }
  </tbody>
</table>
```

---

# 9) Database Migration (MySQL)

## 9.1 Create database

```sql
CREATE DATABASE onlinebanking_db;
```

## 9.2 EF migration + update

```bash
cd OnlineBanking
dotnet ef migrations add InitialCreate -p src/OnlineBanking.Infrastructure -s src/OnlineBanking.Web
dotnet ef database update -p src/OnlineBanking.Infrastructure -s src/OnlineBanking.Web
```

---

# 10) Run

```bash
dotnet run --project src/OnlineBanking.Web
```

âœ… à¦ªà§à¦°à¦¥à¦® à¦°à¦¾à¦¨à§‡à¦‡ DB migrate à¦¹à¦¬à§‡ à¦à¦¬à¦‚ AdminSeed à¦…à¦¨à§à¦¯à¦¾à§Ÿà§€ admin user create à¦¹à¦¬à§‡à¥¤
Console à¦ admin à¦à¦° AccountNumber print à¦¹à¦¬à§‡â€”à¦“à¦Ÿà¦¾ à¦¦à¦¿à§Ÿà§‡ login à¦•à¦°à§à¦¨à¥¤

---

# 11) Step-by-step â€œà¦•à§‹à¦¨ à¦«à¦¾à¦‚à¦¶à¦¨ à¦•à§€ à¦•à¦°à§‡â€ (Bangla explanation)

## RegisterAsync()

* Email duplicate check
* 5-digit unique AccountNumber generate
* Password bcrypt hash
* Customer + Account create
* Audit log: REGISTER

## ValidateLoginAsync()

* Account exists check
* LockedUntilUtc à¦šà§‡à¦• (locked à¦¹à¦²à§‡ block)
* Password wrong à¦¹à¦²à§‡ FailedLoginCount++
* 5 à¦¬à¦¾à¦° à¦­à§à¦² â†’ 15 à¦®à¦¿à¦¨à¦¿à¦Ÿ lock
* Success à¦¹à¦²à§‡ fail count reset + audit LOGIN_SUCCESS

## DepositAsync()

* Amount > 0 à¦šà§‡à¦•
* Transaction à¦¶à§à¦°à§ (DB tx)
* Balance += amount
* Transaction row add
* Commit
* Audit: DEPOSIT

## WithdrawAsync()

* Amount > 0
* Balance sufficient
* Withdraw à¦à¦° à¦ªà¦°à§‡ balance < MinimumBalance à¦¹à¦²à§‡ fail
* Transaction add
* Audit: WITHDRAW

## TransferAsync()

* Receiver exists
* Same account transfer block
* Todayâ€™s transferout sum à¦¬à§‡à¦° à¦•à¦°à§‡ DailyTransferLimit enforce
* Transfer à¦à¦° à¦ªà¦°à§‡ balance < MinimumBalance à¦¹à¦²à§‡ fail
* Sender: TransferOut + Receiver: TransferIn entry
* Audit: TRANSFER

## PDF

* DB à¦¥à§‡à¦•à§‡ name+balance à¦¨à¦¿à§Ÿà§‡ PDF
* Last10 tx list
* UTC â†’ Asia/Dhaka convert
* CurrencySymbol à¦¦à¦¿à§Ÿà§‡ amount format

## Admin

* Customers list
* SetAdmin: role change
* Lock/Unlock: account lock control
* Reset password: bcrypt hash reset
* Audit page: system trace

---

# 12) Windows Server IIS (short, practical)

1. Server à¦ ASP.NET Core Hosting Bundle install
2. Publish à¦•à¦°à§à¦¨:

   ```bash
   dotnet publish src/OnlineBanking.Web -c Release -o publish
   ```
3. IIS â†’ New Website â†’ Physical path = `publish`
4. HTTPS binding enable (Letâ€™s Encrypt à¦¬à¦¾ cert)
5. Production `appsettings.json` à¦ MySQL connection string à¦¦à¦¿à¦¨
6. DB server firewall allow

---

## à¦†à¦ªà¦¨à¦¿ à¦à¦–à¦¨à¦‡ à¦¯à¦¾ à¦•à¦°à¦¬à§‡à¦¨ (Quick checklist)

1. `appsettings.json` à¦ MySQL password à¦¬à¦¸à¦¾à¦¨
2. Database create
3. Migration à¦šà¦¾à¦²à¦¾à¦¨
4. Run à¦•à¦°à§à¦¨
5. Console à¦¥à§‡à¦•à§‡ admin accountNumber à¦¨à¦¿à¦¨ à¦à¦¬à¦‚ login à¦•à¦°à§à¦¨ â†’ Admin tab à¦¦à§‡à¦–à¦¬à§‡à¦¨

---

à¦¯à¦¦à¦¿ à¦†à¦ªà¦¨à¦¿ à¦šà¦¾à¦¨, à¦†à¦®à¦¿ à¦ªà¦°à§‡à¦° à¦®à§‡à¦¸à§‡à¦œà§‡ à¦à¦•à¦Ÿà¦¾ â€œproduction hardening checklistâ€ (rate limiting, antifraud patterns, secure headers à¦†à¦°à¦“ strict, password policy, CSRF/anti replay, backup/restore, IIS config) à¦à¦•à¦¦à¦® à¦¬à§à¦¯à¦¾à¦‚à¦•à¦¿à¦‚ style à¦ à¦¦à¦¿à§Ÿà§‡ à¦¦à§‡à¦¬â€”à¦•à¦¿à¦¨à§à¦¤à§ à¦†à¦ªà¦¨à¦¾à¦° à¦•à§‹à¦¡à¦Ÿà¦¾ à¦à¦–à¦¨à¦‡ à¦°à¦¾à¦¨ à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ à¦à¦Ÿà¦¾ à¦¯à¦¥à§‡à¦·à§à¦Ÿà¥¤




=======================================================================================================
à¦¨à¦¿à¦šà§‡ à¦†à¦®à¦¿ à¦†à¦ªà¦¨à¦¾à¦° à¦ªà§à¦°à¦œà§‡à¦•à§à¦Ÿà¦Ÿà¦¾à¦° à¦œà¦¨à§à¦¯ 
(1) Architecture + Request Flow diagram, 
2) Exam/Interview-style à¦¬à§à¦¯à¦¾à¦–à§à¦¯à¦¾, à¦†à¦° 
3) GitHub-ready README.md à¦à¦•à¦¸à¦¾à¦¥à§‡ à¦¦à¦¿à¦²à¦¾à¦®â€”à¦†à¦ªà¦¨à¦¿ à¦¸à¦°à¦¾à¦¸à¦°à¦¿ copy/paste à¦•à¦°à§‡ à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡à¦¨à¥¤
=======================================================================================================

---

## 1) Clean Architecture Diagram (Layered)

### 1.1 High-level architecture (ASCII)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        OnlineBanking.Web      â”‚
â”‚  MVC (Controllers/Views/Auth) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ calls interfaces
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OnlineBanking.Application   â”‚
â”‚ Contracts + Result + Options  â”‚
â”‚  (Use-case boundaries)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ implements interfaces
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OnlineBanking.Infrastructure  â”‚
â”‚ EF Core + MySQL + Services    â”‚
â”‚ Auth/Banking/Admin/PDF/Audit  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ persists
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MySQL Database       â”‚
â”‚ Customers / Accounts / Tx /   â”‚
â”‚ AuditLogs                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Domain layer sits in the middle as pure business entities:
OnlineBanking.Domain (Entities)  <-- referenced by Application & Infrastructure & Web
```

### 1.2 Dependency rule (à¦¸à¦¬à¦šà§‡à§Ÿà§‡ à¦—à§à¦°à§à¦¤à§à¦¬à¦ªà§‚à¦°à§à¦£)

* Web â†’ Application â†’ Domain
* Infrastructure â†’ Application + Domain
* Domain à¦•à¦¾à¦°à§‹ à¦‰à¦ªà¦° depend à¦•à¦°à§‡ à¦¨à¦¾ âœ…
  à¦à¦Ÿà¦¾à¦‡ Clean Architecture à¦à¦° à¦®à§‚à¦² à¦•à¦¥à¦¾à¥¤

---

## 2) Request Flow Diagrams (à¦†à¦ªà¦¨à¦¾à¦° à¦«à¦¿à¦šà¦¾à¦°à¦—à§à¦²à§‹ à¦•à§€à¦­à¦¾à¦¬à§‡ à¦•à¦¾à¦œ à¦•à¦°à§‡)

### 2.1 Register Flow

```
Browser
  â”‚ POST /Account/Register (Name, Email, City, Password)
  â–¼
AccountController.Register()
  â”‚ calls IAuthService.RegisterAsync(...)
  â–¼
AuthService.RegisterAsync()
  â”‚ - email unique check
  â”‚ - generate unique 5-digit account number
  â”‚ - hash password (BCrypt)
  â”‚ - create Customer + Account(Balance=0)
  â”‚ - SaveChanges()
  â”‚ - AuditWriter: REGISTER
  â–¼
DB (Customers, Accounts, AuditLogs)
  â–²
Controller redirects to RegisterSuccess with AccountNumber
```

### 2.2 Login Flow (with lockout)

```
Browser
  â”‚ POST /Account/Login (AccountNumber, Password)
  â–¼
AccountController.Login()
  â”‚ calls ValidateLoginAsync(account, pass, ip, ua)
  â–¼
AuthService.ValidateLoginAsync()
  â”‚ - customer exists?
  â”‚ - LockedUntilUtc check
  â”‚ - password verify (BCrypt.Verify)
  â”‚ - wrong => FailedLoginCount++ (>=5 => lock 15 min)
  â”‚ - success => reset counts, write LOGIN_SUCCESS
  â–¼
Controller sets Cookie Auth Claims:
  CustomerId, AccountNumber, IsAdmin
  â–¼
Redirect /Banking/Dashboard
```

### 2.3 Deposit / Withdraw / Transfer (transaction safe + rules)

Deposit

```
Dashboard -> POST /Banking/Deposit (Amount)
  -> BankingService.DepositAsync()
     - BeginTransaction()
     - Balance += amount
     - Insert Transaction(Deposit)
     - Commit
     - Audit: DEPOSIT
```

Withdraw

```
Dashboard -> POST /Banking/Withdraw (Amount)
  -> BankingService.WithdrawAsync()
     - Balance >= amount?
     - newBalance >= MinimumBalance?
     - record Transaction(Withdraw)
     - Audit: WITHDRAW
```

Transfer

```
Dashboard -> POST /Banking/Transfer (ToAccount, Amount)
  -> BankingService.TransferAsync()
     - receiver exists?
     - daily transfer limit check (sum TransferOut today)
     - newBalance >= MinimumBalance?
     - sender Balance -= amount, receiver Balance += amount
     - insert 2 transactions: TransferOut + TransferIn
     - Audit: TRANSFER (actor + target)
```

### 2.4 Mini Statement PDF

```
GET /Banking/MiniStatementPdf
  -> BankingService.GetProfileAsync()  (name, account, balance)
  -> BankingService.GetLastTransactionsAsync(10)
  -> StatementPdfService.BuildMiniStatementPdf(currency, tzId, ...)
     - UTC -> Asia/Dhaka conversion
  -> returns File(pdfBytes, "application/pdf")
```

### 2.5 Admin Panel (Policy based)

```
AdminController has [Authorize(Policy="AdminOnly")]

AdminOnly Policy checks claim:
  IsAdmin == "true"

Admin actions:
  Customers list, Lock/Unlock, SetAdmin, ResetPassword, View Audit logs
```

---

## 3) Exam/Interview-Friendly Explanation (Bangla)

### 3.1 à¦•à§‡à¦¨ Clean Architecture à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à§‡à¦›à¦¿?

à¦•à¦¾à¦°à¦£ à¦¬à§à¦¯à¦¾à¦‚à¦•à¦¿à¦‚ à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦®à§‡ rules change à¦¹à§Ÿ, à¦•à¦¿à¦¨à§à¦¤à§ UI à¦¬à¦¾ DB change à¦¹à¦²à§‡à¦“ business rules stable à¦°à¦¾à¦–à¦¾ à¦²à¦¾à¦—à§‡à¥¤

* Domain: â€œà¦¬à§à¦¯à¦¾à¦‚à¦•à¦¿à¦‚-à¦à¦° core dataâ€ (Customer, Account, Transaction, AuditLog)
* Application: â€œà¦•à§€ à¦•à§€ à¦•à¦¾à¦œ à¦¹à¦¬à§‡ à¦¤à¦¾à¦° contractâ€ (interfaces) + options/rules
* Infrastructure: â€œà¦•à¦¿à¦­à¦¾à¦¬à§‡ à¦•à¦¾à¦œ à¦¹à¦¬à§‡â€ (EF Core/MySQL, PDF generator, hashing)
* Web: â€œUI + Request handlingâ€ (MVC, Controllers, Views, Cookie Auth)

### 3.2 Security decisions (à¦†à¦ªà¦¨à¦¾à¦° à¦•à§‹à¦¡à§‡ à¦¯à¦¾ à¦†à¦›à§‡)

* Password plain text à¦¨à¦¾ â†’ BCrypt hash
* Cookie auth â†’ HttpOnly, SameSite=Strict, SecurePolicy=Always (HTTPS needed)
* Auto anti-forgery on all POST (CSRF protection)
* Lockout mechanism (brute-force protect)
* Audit logs (who did what + ip/ua)

### 3.3 Banking rules (real-world flavor)

* MinimumBalance: Withdraw/Transfer à¦¶à§‡à¦·à§‡ à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ minimum à¦à¦° à¦¨à¦¿à¦šà§‡ à¦¯à§‡à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡ à¦¨à¦¾
* DailyTransferLimit: à¦à¦•à¦¦à¦¿à¦¨à§‡ TransferOut à¦Ÿà§‹à¦Ÿà¦¾à¦² à¦¸à§€à¦®à¦¾ cross à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡ à¦¨à¦¾
* Ledger-like transactions: Balance change à¦à¦° à¦¸à¦¾à¦¥à§‡ Transaction record à¦°à¦¾à¦–à§‡

---

## 4) GitHub-Ready README.md (copy/paste)

```md
# OnlineBanking (.NET 9 MVC + MySQL) - Clean Architecture

A secure, scalable starter online banking web application built with:
- ASP.NET Core MVC (.NET 9)
- EF Core + MySQL (Pomelo provider)
- Clean Architecture (Domain/Application/Infrastructure/Web)
- Cookie Authentication
- PDF Mini Statement (QuestPDF)
- Admin Panel + Audit Logs
- Banking Rules: Minimum Balance + Daily Transfer Limit
- TimeZone conversion (Asia/Dhaka) for statements

## Features
### Customer
- Register (name, email, city, password) â†’ auto 5-digit account number
- Login with account number + password (lockout after repeated failures)
- Deposit / Withdraw / Transfer
- Download Mini Statement PDF (last 10 transactions)

### Admin
- View customers list
- Lock / Unlock accounts
- Set / Remove admin role
- Reset customer password
- View audit logs

## Tech Stack
- .NET 9, ASP.NET Core MVC
- MySQL
- EF Core (Pomelo.EntityFrameworkCore.MySql)
- BCrypt.Net-Next
- QuestPDF

## Project Structure
```

OnlineBanking/
src/
OnlineBanking.Domain/
OnlineBanking.Application/
OnlineBanking.Infrastructure/
OnlineBanking.Web/

````

## Prerequisites
- .NET SDK 9
- MySQL Server 8+
- Windows (for IIS deployment)

## Setup
1) Create database:
```sql
CREATE DATABASE onlinebanking_db;
````

2. Update `src/OnlineBanking.Web/appsettings.json` connection string:

```json
"server=localhost;port=3306;database=onlinebanking_db;user=root;password=YOUR_PASSWORD;"
```

3. Run migrations:

```bash
dotnet ef migrations add InitialCreate -p src/OnlineBanking.Infrastructure -s src/OnlineBanking.Web
dotnet ef database update -p src/OnlineBanking.Infrastructure -s src/OnlineBanking.Web
```

4. Run:

```bash
dotnet run --project src/OnlineBanking.Web
```

## Admin Seed

On first run, the app seeds an admin user from `AdminSeed` in appsettings.
The seeded admin account number is printed in console.

Default config:

* [admin@bank.local](mailto:admin@bank.local)
* Admin@12345

## Banking Rules

Configured in `BankingRules` section:

* CurrencySymbol (à§³)
* TimeZoneId (Asia/Dhaka)
* MinimumBalance (e.g., 100.00)
* DailyTransferLimit (e.g., 50000.00)

## IIS Deployment (Windows Server)

1. Install ASP.NET Core Hosting Bundle on server.
2. Publish:

```bash
dotnet publish src/OnlineBanking.Web -c Release -o publish
```

3. Create IIS site pointing to `publish` folder.
4. Enable HTTPS (required because cookie is SecurePolicy=Always).
5. Set production connection string and rules.

## Notes

This is a starter template. Production banking requires additional controls:
MFA/OTP, KYC/AML, fraud monitoring, rate limiting gateway, secure key management, etc.

````

---

## 5) Next practical step (à¦†à¦®à¦¿ à¦¯à§‡à¦Ÿà¦¾ à¦¸à¦¾à¦œà§‡à¦¸à§à¦Ÿ à¦•à¦°à¦›à¦¿)
à¦†à¦ªà¦¨à¦¿ à¦¯à§‡à¦¹à§‡à¦¤à§ â€œcopy/paste à¦•à¦°à§‡ à¦°à¦¾à¦¨â€ à¦•à¦°à¦›à§‡à¦¨â€”à¦¸à¦¬à¦šà§‡à§Ÿà§‡ common issue à¦¹à§Ÿ:

1) TimeZone ID Windows à¦ â€œAsia/Dhakaâ€ à¦•à¦¾à¦œ à¦¨à¦¾ à¦•à¦°à¦²à§‡  
Windows à¦•à¦–à¦¨à§‹ à¦•à¦–à¦¨à§‹ IANA timezone à¦¨à¦¾ à¦šà¦¿à¦¨à§‡ (depending on runtime).  
à¦¯à¦¦à¦¿ à¦†à¦ªà¦¨à¦¾à¦° à¦®à§‡à¦¶à¦¿à¦¨à§‡ error à¦¦à§‡à§Ÿ, à¦†à¦ªà¦¨à¦¿ `BankingRules:TimeZoneId` à¦ à¦à¦Ÿà¦¾ à¦¦à¦¿à¦¨:
- `"Bangladesh Standard Time"` (Windows ID)

2) Cookie secure policy Always â†’ HTTPS à¦›à¦¾à§œà¦¾ login cookie à¦•à¦¾à¦œ à¦•à¦°à¦¬à§‡ à¦¨à¦¾ (dev à¦ warning/issue à¦¹à¦¤à§‡ à¦ªà¦¾à¦°à§‡)  
Dev à¦ à¦¯à¦¦à¦¿ HTTPS à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¹à§Ÿ, temporarily:
```csharp
opt.Cookie.SecurePolicy = CookieSecurePolicy.SameAsRequest;
````

Production à¦ à¦†à¦¬à¦¾à¦° Always à¦•à¦°à¦¬à§‡à¦¨à¥¤

---

à¦†à¦ªà¦¨à¦¿ à¦šà¦¾à¦‡à¦²à§‡ à¦†à¦®à¦¿ à¦ªà¦°à§‡à¦° à¦§à¦¾à¦ªà§‡ à¦à¦•à¦¦à¦® à¦¹à¦¾à¦¤à§‡ à¦§à¦°à§‡ à¦¦à§‡à¦¬:

* TimeZone Windows/IANA compatible helper (auto-detect)
* Better transaction table UI (local time à¦¦à§‡à¦–à¦¾à¦¨à§‹)
* Unit tests (Minimum balance & daily limit rules)
* Database indexes + performance tweaks for real load

à¦¬à¦²à§à¦¨â€”à¦†à¦ªà¦¨à¦¿ à¦•à¦¿ Windows Server IIS à¦ à¦¡à¦¿à¦ªà§à¦²à§Ÿ à¦•à¦°à¦¬à§‡à¦¨ à¦¨à¦¾à¦•à¦¿ à¦†à¦—à§‡ Local run à¦•à¦°à§‡ verify à¦•à¦°à¦¬à§‡à¦¨?


========================================================================================================================
Local server settings
========================================================================================================================
à¦¦à¦¾à¦°à§à¦£â€”Local run à¦•à¦°à§‡ verify à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ à¦¨à¦¿à¦šà§‡ à¦à¦•à¦¦à¦® practical checklist + command sequence à¦¦à¦¿à¦²à¦¾à¦®à¥¤ à¦à¦—à§à¦²à§‹ follow à¦•à¦°à¦²à§‡ à§¯à§¦% common error à¦†à¦—à§‡à¦‡ avoid à¦¹à¦¬à§‡à¥¤

---

## 1) MySQL Setup (Local)

1. MySQL à¦šà¦¾à¦²à§ à¦†à¦›à§‡ à¦•à¦¿à¦¨à¦¾ à¦šà§‡à¦• à¦•à¦°à§à¦¨à¥¤
2. à¦à¦•à¦Ÿà¦¾ DB à¦¬à¦¾à¦¨à¦¾à¦¨:

```sql
CREATE DATABASE onlinebanking_db;
```

3. `src/OnlineBanking.Web/appsettings.json` à¦ à¦†à¦ªà¦¨à¦¾à¦° password à¦¬à¦¸à¦¾à¦¨:

```json
"server=localhost;port=3306;database=onlinebanking_db;user=root;password=YOUR_PASSWORD;TreatTinyAsBoolean=true;"
```

> à¦¯à¦¦à¦¿ à¦†à¦ªà¦¨à¦¾à¦° MySQL user/root à¦†à¦²à¦¾à¦¦à¦¾ à¦¹à§Ÿ, à¦¸à§‡à¦Ÿà¦¾ à¦²à¦¿à¦–à¦¬à§‡à¦¨à¥¤

---

## 2) Important Local Settings (à¦¦à§à¦Ÿà¦¿ à¦œà¦¿à¦¨à¦¿à¦¸)

### âœ… A) HTTPS issue (à¦¸à¦¬à¦šà§‡à§Ÿà§‡ common)

à¦†à¦®à¦¾à¦¦à§‡à¦° `Program.cs` à¦ cookie `SecurePolicy = Always` à¦†à¦›à§‡à¥¤
Local run à¦ HTTPS à¦¨à¦¾ à¦¥à¦¾à¦•à¦²à§‡ login cookie à¦•à¦¾à¦œ à¦¨à¦¾à¦“ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‡à¥¤

Solution (Local only): `Program.cs` à¦ à¦¨à¦¿à¦šà§‡à¦° lineà¦Ÿà¦¾ temporarily à¦¦à¦¿à¦¨:

```csharp
opt.Cookie.SecurePolicy = CookieSecurePolicy.SameAsRequest;
```

Production à¦ à¦†à¦¬à¦¾à¦° Always à¦•à¦°à¦¬à§‡à¦¨à¥¤

---

### âœ… B) TimeZone issue (Windows à¦)

à¦¯à¦¦à¦¿ `Asia/Dhaka` timezone error à¦¦à§‡à§Ÿ, `appsettings.json` à¦ à¦à¦Ÿà¦¾ à¦¦à¦¿à¦¨:

```json
"TimeZoneId": "Bangladesh Standard Time"
```

---

## 3) EF Migration + DB Update

Solution root folder à¦¥à§‡à¦•à§‡ à¦°à¦¾à¦¨ à¦•à¦°à¦¬à§‡à¦¨:

```bash
cd OnlineBanking
dotnet restore
dotnet ef migrations add InitialCreate -p src/OnlineBanking.Infrastructure -s src/OnlineBanking.Web
dotnet ef database update -p src/OnlineBanking.Infrastructure -s src/OnlineBanking.Web
```

âœ… à¦à¦¤à§‡ MySQL à¦ tables à¦¤à§ˆà¦°à¦¿ à¦¹à¦¬à§‡:

* Customers
* Accounts
* Transactions
* AuditLogs

---

## 4) Run (Local)

```bash
dotnet run --project src/OnlineBanking.Web
```

à¦ªà§à¦°à¦¥à¦® run à¦:

* DB migrate à¦¹à¦¬à§‡
* Admin seed à¦¹à¦¬à§‡
* Console à¦ Admin à¦à¦° AccountNumber print à¦¹à¦¬à§‡

âœ… Console output à¦ à¦à¦®à¦¨ à¦¦à§‡à¦–à¦¬à§‡à¦¨:
`Seeded Admin AccountNumber: 12345`

---

## 5) Browser Testing Steps (Verify Checklist)

### âœ… Step 1: Register customer

* `/Account/Register`
* Name, Email, City, Password à¦¦à¦¿à¦¨
  âœ… success page à¦ 5-digit account number à¦ªà¦¾à¦¬à§‡à¦¨

### âœ… Step 2: Customer login

* `/Account/Login`
* Account number + password
  âœ… Dashboard à¦¦à§‡à¦–à¦¾à¦¬à§‡

### âœ… Step 3: Deposit

* 1000 deposit à¦•à¦°à§à¦¨
  âœ… Balance à¦¬à¦¾à§œà¦¬à§‡ + transaction row add à¦¹à¦¬à§‡

### âœ… Step 4: Withdraw (minimum balance test)

* MinimumBalance à¦¯à¦¦à¦¿ 100 à¦¥à¦¾à¦•à§‡, à¦¤à¦¾à¦¹à¦²à§‡ à¦à¦®à¦¨ withdraw à¦¦à¦¿à¦¨ à¦¯à¦¾à¦¤à§‡ balance 100 à¦à¦° à¦¨à¦¿à¦šà§‡ à¦šà¦²à§‡ à¦¯à¦¾à§Ÿ
  âœ… Fail message à¦¦à§‡à¦–à¦¾à¦¬à§‡

### âœ… Step 5: Transfer (daily limit test)

* à¦…à¦¨à§à¦¯ account register à¦•à¦°à§‡ à¦¨à¦¿à¦¨
* Transfer à¦•à¦°à§à¦¨
  âœ… sender à¦ TransferOut, receiver à¦ TransferIn record à¦¹à¦¬à§‡
* à¦¬à¦¾à¦°à¦¬à¦¾à¦° transfer à¦•à¦°à§‡ limit cross à¦•à¦°à§à¦¨
  âœ… â€œDaily transfer limit exceededâ€ à¦¦à§‡à¦–à¦¾à¦¬à§‡

### âœ… Step 6: PDF mini statement

* Dashboard à¦ â€œDownload Mini Statementâ€
  âœ… PDF download à¦¹à¦¬à§‡, Dhaka time à¦¦à§‡à¦–à¦¾à¦¬à§‡

### âœ… Step 7: Admin verify

* Admin account à¦¦à¦¿à§Ÿà§‡ login (console à¦¥à§‡à¦•à§‡ à¦ªà¦¾à¦“à§Ÿà¦¾ account number)
* Navbar à¦ â€œAdminâ€ & â€œAuditâ€ à¦¦à§‡à¦–à¦¬à§‡à¦¨
* Customers list / lock/unlock / reset password try à¦•à¦°à§à¦¨
  âœ… Audit logs à¦ record à¦¹à¦¬à§‡

---

## 6) Common Errors & Fix (à¦¸à¦¬à¦šà§‡à§Ÿà§‡ à¦¦à¦°à¦•à¦¾à¦°à¦¿)

### âŒ â€œAccess denied for user rootâ€

âœ… connection string à¦ username/password à¦­à§à¦²

* MySQL user/pass à¦ à¦¿à¦• à¦•à¦°à§à¦¨

### âŒ â€œUnknown database onlinebanking_dbâ€

âœ… DB create à¦•à¦°à¦¾ à¦¹à§Ÿà¦¨à¦¿

* `CREATE DATABASE onlinebanking_db;`

### âŒ â€œTimeZoneInfo not foundâ€

âœ… `Asia/Dhaka` à¦•à¦¾à¦œ à¦¨à¦¾ à¦•à¦°à¦²à§‡

* `Bangladesh Standard Time` à¦¦à¦¿à¦¨

### âŒ Login à¦¹à¦šà§à¦›à§‡ à¦•à¦¿à¦¨à§à¦¤à§ Dashboard redirect à¦¹à¦šà§à¦›à§‡ à¦¨à¦¾

âœ… cookie secure policy / HTTPS issue

* Local à¦ `SameAsRequest` à¦•à¦°à§à¦¨



---
