

===================================== Real World Scenario ==============================================

একজন কাস্টমার যখন টেলারের (Checker) কাছে ১০,০০০ টাকা জমা দেন, 
তখন ডাটাবেস এবং অ্যাপ্লিকেশনের ভেতরে ও বাইরে যে ধাপগুলো ঘটে, তা নিচে বিস্তারিত ব্যাখ্যা করা হলো:

---

### ধাপ ১: ট্রানজ্যাকশন ইনিশিয়েশন (Checker/Teller Level)

বাইরের কাজ (External): কাস্টমার ১০,০০০ টাকা এবং তার অ্যাকাউন্ট নাম্বার চেকারকে দেন। চেকার সিস্টেমে অ্যাকাউন্ট নাম্বার ভ্যালিডেশন করেন।

ভেতরের কাজ (Internal Database/App):

 Validation: অ্যাপ চেক করে অ্যাকাউন্টটি `Active` কি না (`accounts` table)।
 Limit Check: চেকারের ডিপোজিট লিমিট এবং ওই ব্রাঞ্চের ক্যাশ লিমিট চেক করা হয়।
 Entry: চেকার ১০,০০০ টাকা জমার এন্ট্রি দিলে `transactions` টেবিলে একটি নতুন রো তৈরি হয়।
 `status` = 'Initiated'
 `batch_number` = একটি ইউনিক নাম্বার জেনারেট হয়।
 দ্রষ্টব্য: এই পর্যায়ে কাস্টমারের ব্যালেন্স বা GL-এ কোনো পরিবর্তন হয় না।



---

### ধাপ ২: অনুমোদন বা অথরাইজেশন (Maker Level)

বাইরের কাজ (External): মেকার তার ড্যাশবোর্ডে 'Pending' ট্রানজ্যাকশনটি দেখতে পান এবং ভাউচারের সাথে মিলিয়ে 'Approve' বাটনে ক্লিক করেন।

ভেতরের কাজ (Internal Database/App):
মেকার যখন অনুমোদন দেন, তখন অ্যাপ্লিকেশন একটি Database Transaction (Atomicity) শুরু করে। অর্থাৎ নিচের ৪টি কাজ একসাথে সফল হতে হবে, নাহলে একটিও হবে না:

1. Status Update: `transactions` টেবিলে ওই রেকর্ডের `status` আপডেট হয়ে 'Approved' হয় এবং `maker_id` সেভ হয়।
2. Sub-Ledger Balance Update: `accounts` টেবিলে ওই কাস্টমারের `balance` কলামে ১০,০০০ টাকা যোগ করা হয়।
3. Cash Drawer Update: `cash_drawers` টেবিলে ওই চেকারের `current_cash` ১০,০০০ টাকা বাড়িয়ে দেওয়া হয়।
4. Vault Update (Optional): যদি ব্রাঞ্চ লেভেলে হিসাব থাকে, তবে `branches` টেবিলের ব্যালেন্স আপডেট হয়।

---

### ধাপ ৩: ডাবল-এন্ট্রি অ্যাকাউন্টিং পোস্টিং (Automated Posting)

মেকার এপ্রুভ করার সাথে সাথেই ব্যাকএন্ডে ডাবল-এন্ট্রি রুল অনুযায়ী দুটি গুরুত্বপূর্ণ টেবিলে ডেটা ইনসার্ট হয়:

১. Sub-Ledger Entry: `sub_ledger_entries` টেবিলে একটি এন্ট্রি হয় যাতে কাস্টমারের স্টেটমেন্ট তৈরি করা যায়।

 `account_id` = কাস্টমার অ্যাকাউন্ট।
 `dr_cr_flag` = 'Cr' (ক্রেডিট)।
 `running_balance` = আগের ব্যালেন্স + ১০,০০০।

২. General Ledger (GL) Posting:
`gl_journal_lines` টেবিলে দুটি লাইন (Double Entry) তৈরি হয়:

 লাইন ১ (Cash): `gl_code` = 1001 (Cash), `debit_amount` = 10,000। (সম্পদ বৃদ্ধি পেয়েছে)
 লাইন ২ (Deposit): `gl_code` = 2001 (Customer Deposits), `credit_amount` = 10,000। (দায় বৃদ্ধি পেয়েছে)

---

### ধাপ ৪: রিকনসিলিয়েশন এবং কন্ট্রোল (Auditor/System Level)

ভেতরের কাজ (Internal):
দিনের শেষে বা যেকোনো সময় অডিটর যখন রিকনসিলিয়েশন রিপোর্ট রান করেন, তখন সিস্টেম নিচের ম্যাথমেটিক্যাল চেকগুলো করে:

 Check A: সকল কাস্টমারের অ্যাকাউন্টের যোগফল কি GL-2001 (Liability) এর সমান?
 Check B: সকল চেকারের ক্যাশ ড্রয়ারের যোগফল কি GL-1001 (Asset) এর সমান?
 Check C: ট্রায়াল ব্যালেন্সে মোট ডেবিট এবং মোট ক্রেডিট কি সমান ()?

যদি সবকিছু মিলে যায়, তবে `reconciliation_logs` টেবিলে 'Matched' স্ট্যাটাসে একটি এন্ট্রি পড়ে।

---

### ধাপ ৫: অডিট লগ এবং রিপোর্ট জেনারেশন

বাইরের কাজ (External): কাস্টমারকে একটি মানি রিসিপ্ট দেওয়া হয় এবং চেকার তার দিনের শেষ রিপোর্ট (EOD Report) জেনারেট করেন।

ভেতরের কাজ (Internal):

 `audit_logs` টেবিলে মেকার এবং চেকারের এই অ্যাকশনের বিস্তারিত (কে, কখন, কী করেছে) সেভ হয়ে থাকে।
 কাস্টমার চাইলে এখন তার স্টেটমেন্টে এই ১০,০০০ টাকা ক্রেডিট হিসেবে দেখতে পাবেন।

---







.
