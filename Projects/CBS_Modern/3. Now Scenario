

===================================== Real World Scenario ==============================================



ব্যাংকিং রিকোয়ারমেন্ট এবং ডাটাবেজ স্ট্রাকচার অনুযায়ী, 
অ্যাকাউন্ট ওপেনিং এবং ১০০০ টাকা ডিপোজিটের অভ্যন্তরীণ প্রক্রিয়া।

---

### ১. অ্যাকাউন্ট খোলার প্রক্রিয়া (How to open an account)

আপনার সিস্টেমে অ্যাকাউন্ট খোলার প্রক্রিয়াটি মূলত Maker-Checker নীতিতে কাজ করবে।

          ধাপ-১: চেকার (Checker) দ্বারা ইনিশিয়েশন
          - ইনপুট: চেকার কাস্টমারের নাম, এনআইডি (NID), এবং অ্যাকাউন্টের ধরন (Savings - 111 / Current - 222) ইনপুট দেবেন।
          - সিস্টেম অ্যাকশন: সিস্টেম অটোমেটিক একটি ইউনিক ৫-ডিজিটের অ্যাকাউন্ট নম্বর জেনারেট করবে।
          - ডাটাবেজ এন্ট্রি:  `customers` টেবিলে কাস্টমারের তথ্য জমা হবে (Status: `Pending`)।
          - `accounts` টেবিলে অ্যাকাউন্টটি তৈরি হবে (Is_Active: `FALSE` বা ব্যালেন্স ০.০০)।


          - আউটপুট: একটি সাকসেস মেসেজ আসবে এবং ফাইলটি মেকারের অনুমোদনের জন্য পেন্ডিং থাকবে।

          ধাপ-২: মেকার (Maker) দ্বারা অনুমোদন
          - অ্যাকশন: মেকার তার ড্যাশবোর্ডে পেন্ডিং কাস্টমারের লিস্ট দেখবেন এবং তথ্য যাচাই করে `Approved` বাটনে ক্লিক করবেন।
          - ডাটাবেজ এন্ট্রি:  `customers` টেবিলের স্ট্যাটাস আপডেট হয়ে `Active` হবে।
          - `accounts` টেবিলের `is_active` ফিল্ডটি `TRUE` হয়ে যাবে।


          - ফলাফল: অ্যাকাউন্টটি এখন লেনদেনের জন্য প্রস্তুত।

---

### ২. ১০০০ টাকা ডিপোজিট ফ্লো (Internal & GL Flow)

         যখন একজন গ্রাহক ১০০০ টাকা নিয়ে টেলারের (চেকার) কাছে আসবেন, তখন সিস্টেমের ভেতরে ডাবল-এন্ট্রি অ্যাকাউন্টিং অনুযায়ী নিচের ধাপগুলো সম্পন্ন হবে:

                #### ধাপ-১: লেনদেনের শুরু (Transaction Initiation - Checker)

                         - চেকার কাস্টমারের অ্যাকাউন্ট নম্বর এবং ১০০০ টাকা ইনপুট দিয়ে একটি `Deposit` ট্রানজ্যাকশন শুরু করবেন।
                         - ভ্যালিডেশন: সিস্টেম চেক করবে অ্যাকাউন্টটি `Active` কি না এবং অ্যামাউন্ট ০-এর বেশি কি না।
                         - ডাটাবেজ এন্ট্রি: `transactions` টেবিলে একটি রো তৈরি হবে (Status: `Initiated`) এবং একটি ইউনিক `Batch Number` জেনারেট হবে।

                #### ধাপ-২: অনুমোদন এবং পোস্টিং (Authorization - Maker)

                          মেকার যখন এই ট্রানজ্যাকশনটি `Approve` করবেন, তখন অ্যাপ্লিকেশনে একটি Database Transaction Scope শুরু হবে। এই স্কোপের ভেতর ৪টি প্রধান কাজ একসাথে (Atomic) সম্পন্ন হবে:
          
                          ক) ব্যালেন্স আপডেট (Sub-ledger Update):
                          - `accounts` টেবিলের সংশ্লিষ্ট অ্যাকাউন্টে ১০০০ টাকা যোগ হবে (`balance = balance + 1000`)।
                          - `cash_drawers` টেবিলে ওই চেকারের ড্রয়ারে ১০০০ টাকা যোগ হবে (`current_cash = current_cash + 1000`)।
          
                          খ) কাস্টমার লেজার এন্ট্রি (Sub-ledger Detail):
                          - `sub_ledger_entries` টেবিলে একটি এন্ট্রি হবে যেখানে `dr_cr_flag = 'Cr'` (Liability বাড়ছে) এবং বর্তমান `running_balance` আপডেট হবে।
          
                          গ) জার্নাল মাস্টার তৈরি (GL Journal Master):
                          - `gl_journals` টেবিলে একটি রেকর্ড তৈরি হবে যেখানে `total_debit = 1000` এবং `total_credit = 1000` থাকবে। এটি নিশ্চিত করে যে ডাবল-এন্ট্রি ব্যালেন্সড আছে।
          
                          ঘ) ডাবল-এন্ট্রি পোস্টিং (GL Posting):
                          `gl_journal_lines` টেবিলে দুটি এন্ট্রি হবে:
                          1. Debit এন্ট্রি: `gl_code_id` (Cash 1001) টেবিলে ১০০০ টাকা ডেবিট হবে (Asset বাড়ছে)।
                          2. Credit এন্ট্রি: `gl_code_id` (Customer Deposit 2001) টেবিলে ১০০০ টাকা ক্রেডিট হবে (Liability বাড়ছে)।
          
                          - একই সাথে `gl_heads` টেবিলের `current_balance` আপডেট হবে।

---

### ৩. রিকনসিলিয়েশন (Confirming accuracy)
        দিনের শেষে বা অডিট করার সময় সিস্টেম নিচের গাণিতিক সমীকরণগুলো চেক করবে:

        1. ক্যাশ রিকনসিলিয়েশন:
        অর্থাৎ, ১০০০ টাকা ক্যাশ জিএল-এ ডেবিট হওয়া মানে সব চেকারের ড্রয়ারের যোগফলও ১০০০ টাকা বাড়তে হবে।

        2. ডিপোজিট রিকনসিলিয়েশন:
        কাস্টমারের অ্যাকাউন্টে যোগ হওয়া ১০০০ টাকা যেন লাইয়াবিলিটি জিএল-এর সাথে হুবহু মিলে যায়।

        3. ট্রায়াল ব্যালেন্স:
        ### সারসংক্ষেপ টেবিল:
        ----------------------------------------------------------------------------------
        | পক্ষ            |       টেবিল        | অ্যাকশন  | প্রভাব                         |
        | -------------- | ------------------ | -------- | ----------------------------- |
        | Checker        | `transactions`     | Initiate | স্ট্যাটাস 'Initiated'            |
        | Maker          | `transactions`     | Approve  | স্ট্যাটাস 'Approved'             |
        | Account        | `accounts`         | Update   | ব্যালেন্স বৃদ্ধি                    |
        | Teller Cash    | `cash_drawers`     | Update   | ক্যাশ ইন হ্যান্ড বৃদ্ধি             |
        | GL - Asset     | `gl_journal_lines` | Debit    | Cash in Hand (1001) বৃদ্ধি      |
        | GL - Liability | `gl_journal_lines` | Credit   | Customer Deposits (2001) বৃদ্ধি |
        ----------------------------------------------------------------------------------


.
