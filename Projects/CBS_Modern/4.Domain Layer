



======================================================================== 
           Domain Layer (Heart of the Application) 
========================================================================

এই লেয়ারটি ডেটাবেস এবং ইউজার ইন্টারফেসের মাঝখানে থাকে এবং ব্যাংকের মূল নিয়মকানুন (Business Rules) পরিচালনা করে।

আপনার দেওয়া ১২টি টেবিলের ওপর ভিত্তি করে ডোমেইন লেয়ারের প্রধান Entities এবং Logic নিচে বিশ্লেষণ করা হলো:

---

### ১. ডোমেইন এনটিটি (Entities)

এনটিটি হলো আপনার সিস্টেমের মূল অবজেক্ট যা ব্যাংকের নিয়মগুলো ধারণ করে।

- Account Entity: এটি কেবল ব্যালেন্স ধারণ করে না, বরং এর নিজস্ব লজিক থাকে। যেমন: "এই অ্যাকাউন্ট থেকে কি এখন ৫০০ টাকা তোলা সম্ভব?" (Minimum Balance Check)।
- Transaction Entity: এটি একটি লেনদেনের পূর্ণাঙ্গ চিত্র। এর মধ্যে ভ্যালিডেশন লজিক থাকে (যেমন: জমা হলে অ্যামাউন্ট পজিটিভ হতে হবে)।
- Journal Entity: এটি ডাবল-এন্ট্রি বুক-কিপিং নিশ্চিত করে। এর কাজ হলো ডেবিট এবং ক্রেডিট সাইড সমান রাখা।

---

### ২. ডোমেইন লজিক (Core Business Rules)

আপনার সিস্টেমের জন্য নিচের লজিকগুলো ডোমেইন লেয়ারে থাকতে হবে:

#### ক. মেকার-চেকার লজিক (The Workflow Rule)

একজন ইউজার নিজেই ট্রানজ্যাকশন তৈরি (Checker) এবং অনুমোদন (Maker) করতে পারবেন না।

- Logic: `if (transaction.checker_id == current_user.id) throw Error("Maker and Checker cannot be the same person");`

#### খ. শ্যাডো পোস্টিং লজিক (The Shadow Posting Rule)

ট্রানজ্যাকশন এপ্রুভ হওয়ার পর কীভাবে ডাটা প্রবাহিত হবে তা এখানে ডিফাইন করা থাকে।

1. প্রথমে `Account.updateBalance()` কল হবে।
2. তারপর `SubLedger.createEntry()` কল হবে।
3. সবশেষে `Transaction.markAsApproved()` কল হবে।
-(নোট: GL Posting এখানে হবে না, কারণ সেটি EOD বা ব্যাচ প্রসেসের লজিক।)-

#### গ. ডাবল-এন্ট্রি ভ্যালিডেশন (The Balancing Rule)

GL জার্নাল তৈরি করার সময় সিস্টেম চেক করবে:

- Logic: `if (total_debit != total_credit) throw Error("Accounting Imbalance: Journal must be balanced");`

---

### ৩. সার্ভিস লেয়ার লজিক (Domain Services)

কিছু লজিক একটি এনটিটির মধ্যে রাখা যায় না, সেগুলো সার্ভিসের মাধ্যমে করা হয়:

- PostingService: এটি সেই "GL Now" বাটন বা অ্যাডমিন মেনুর লজিক পরিচালনা করে। এটি সকল `Approved` কিন্তু `Unposted` ট্রানজ্যাকশন সংগ্রহ করে এবং লুপ চালিয়ে জার্নাল তৈরি করে।
- ReconciliationService: এটি `Sub-Ledger` এবং `GL Head` এর ব্যালেন্স তুলনা করার লজিক ধারণ করে।

---

### ৪. একটি সূক্ষ্ম ইঞ্জিনিয়ারিং টিপস (Clean Architecture)

আপনার বন্ধু হয়তো লক্ষ্য করতেন— আপনি কি ডোমেইন লেয়ারের ভেতর সরাসরি SQL Query লিখছেন?

পরামর্শ:
ডোমেইন লেয়ারকে ডেটাবেস থেকে আলাদা রাখুন। ডোমেইন লেয়ার শুধু নিয়ম জানবে (যেমন: "ব্যালেন্স নেগেটিভ হওয়া যাবে না")। 
ডাটা কীভাবে সেভ হবে তা Infrastructure Layer বা Repository দেখবে। একেই বলা হয় Separation of Concerns।

---
