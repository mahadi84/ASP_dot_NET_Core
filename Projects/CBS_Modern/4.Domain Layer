

 Domain Layer হবে আপনার সিস্টেমের প্রাণ। 
 টি ডাটাবেস টেবিল থেকে আলাদাভাবে কাজ করবে এবং ব্যাংকিংয়ের সকল কঠোর নিয়ম (Business Rules) নিশ্চিত করবে।

নিচে আপনার সিস্টেমের জন্য প্রধান Entities এবং সেগুলোর Business Logic কোডিং আর্কিটেকচারের আদলে তুলে ধরা হলো:

---

### ১. Account Entity (হিসাব এনটিটি)

এটি গ্রাহকের আর্থিক অবস্থা এবং সেটির বৈধতা নিয়ন্ত্রণ করে।

- Logic (ব্যালেন্স চেক): টাকা তোলার আগে অবশ্যই চেক করতে হবে গ্রাহকের পর্যাপ্ত ব্যালেন্স আছে কি না।
- Logic (অ্যাকাউন্ট স্ট্যাটাস): যদি অ্যাকাউন্টটি 'Inactive' বা 'Blocked' থাকে, তবে কোনো লেনদেন করা যাবে না।
- Business Rule: `Debit Amount <= (Current Balance - Minimum Required Balance)` হতে হবে।

---

### ২. Transaction Entity (লেনদেন এনটিটি)

এটি প্রতিটি একক লেনদেনের তথ্য এবং তার পর্যায়ক্রমিক অবস্থা (State) ধারণ করে।

- Logic (মেকার-চেকার নিয়ম): একজন ব্যক্তি একই লেনদেনের চেকার (Initiator) এবং মেকার (Approver) হতে পারবেন না।
- Logic (অ্যামাউন্ট ভ্যালিডেশন): লেনদেনের পরিমাণ অবশ্যই ০ (শূন্য) এর চেয়ে বেশি হতে হবে।
- Business Rule: `if (Transaction.checker_id == current_user.id) return Error("Maker and Checker must be different users")`

---

### ৩. Journal Entity (জার্নাল এনটিটি)

এটি ডাবল-এন্ট্রি অ্যাকাউন্টিং নিশ্চিত করার মূল জায়গা।

- Logic (জিরো-ব্যালেন্স রুল): একটি জার্নালের মোট ডেবিট এবং মোট ক্রেডিট অবশ্যই সমান হতে হবে।
- Logic (পোস্টিং স্ট্যাটাস): একবার GL-এ পোস্ট হয়ে গেলে সেই জার্নাল আর এডিট বা ডিলিট করা যাবে না।
- Business Rule: `Total Debit - Total Credit == 0` (The Accounting Equation).

---

### ৪. Branch & Cash Drawer Entity (শাখা ও নগদ নিয়ন্ত্রণ)

এটি ব্যাংকের ভল্ট এবং ক্যাশ কাউন্টারের সিকিউরিটি নিশ্চিত করে।

- Logic (ক্যাশ লিমিট চেক): একজন চেকার তার নির্ধারিত ক্যাশ ড্রয়ারের লিমিটের বাইরে টাকা দিতে পারবেন না।
- Logic (শাখা ভিত্তিক অ্যাক্সেস): একজন ইউজার শুধুমাত্র তার নিজের শাখার ডাটা প্রসেস করতে পারবেন।
- Business Rule: `Transaction Amount <= Checker.CashDrawer.Limit`

---

### ৫. ডোমেইন লেয়ারের মূল বিজনেস রুলসমূহ (সংক্ষেপে)

-----------------------------------------------------------------------------------------------------------
| এনটিটি      | বিজনেস রুল (Business Rule)  | কেন জরুরি?                                                 |
| ----------- | --------------------------- | ----------------------------------------------------------- |
| Account     | ব্যালেন্স নেগেটিভ হওয়া যাবে না। | ওভারড্রাফট ঠেকাতে। |
| Transaction | মেকার-চেকার আলাদা হতে হবে। | ইন্টারনাল ফ্রড বা জালিয়াতি রোধে। |
| Journal     | ডেবিট এবং ক্রেডিট সমান হতে হবে। | ট্রায়াল ব্যালেন্সের ভারসাম্য বজায় রাখতে। |
| Customer    | কেওয়াইসি (KYC) পূর্ণ না হলে অ্যাকাউন্ট খোলা যাবে না। | আইনি বাধ্যবাধকতা বা কমপ্লায়েন্স নিশ্চিত করতে। |
-----------------------------------------------------------------------------------------------------------




=================================================
                    code
=================================================


আপনার ব্যাংকিং সিস্টেমের জন্য .NET 9 (Core) MVC প্যাটার্ন এবং Domain-Driven Design (DDD) অনুসরণ করে ডোমেইন লেয়ারের কোড নিচে দেওয়া হলো। 
আমি এই কোডটিকে `Models` এবং `Logic` সেকশনে ভাগ করেছি যাতে আপনি সরাসরি আপনার প্রজেক্টে ব্যবহার করতে পারেন।

### ১. Domain Entities (Models ফোল্ডারে রাখুন)

```csharp
namespace CBS.Domain.Entities
{
    // ১. অ্যাকাউন্ট এনটিটি: ব্যালেন্স এবং লিমিট চেক করার বিজনেস রুলস
    public class Account
    {
        public int Id { get; set; }
        public string AccountNumber { get; set; }
        public decimal Balance { get; private set; }
        public string Status { get; set; } // "Active", "Blocked", "Inactive"
        public decimal MinBalance { get; set; } = 500m;

        public Account(int id, string accNum, decimal balance, string status)
        {
            Id = id;
            AccountNumber = accNum;
            Balance = balance;
            Status = status;
        }

        // বিজনেস রুল: টাকা তোলার অনুমতি আছে কি না?
        public bool CanWithdraw(decimal amount)
        {
            if (Status != "Active")
                throw new Exception("অ্যাকাউন্টটি সক্রিয় (Active) নয়।");

            if (Balance - amount < MinBalance)
                throw new Exception("পর্যাপ্ত ব্যালেন্স নেই (মিনিমাম ব্যালেন্স বজায় রাখা বাধ্যতামূলক)।");

            return true;
        }

        // বিজনেস রুল: ব্যালেন্স আপডেট লজিক
        public void UpdateBalance(decimal amount, string txnType)
        {
            if (txnType == "Deposit")
            {
                Balance += amount;
            }
            else if (txnType == "Withdraw")
            {
                if (CanWithdraw(amount))
                    Balance -= amount;
            }
        }
    }

    // ২. ট্রানজ্যাকশন এনটিটি: মেকার-চেকার এবং ভ্যালিডেশন রুলস
    public class Transaction
    {
        public int Id { get; set; }
        public decimal Amount { get; set; }
        public int CheckerId { get; set; }
        public int? MakerId { get; private set; }
        public string Status { get; set; } = "Initiated";

        public void Validate()
        {
            if (Amount <= 0)
                throw new Exception("লেনদেনের পরিমাণ অবশ্যই পজিটিভ হতে হবে।");
        }

        // বিজনেস রুল: মেকার-চেকার সেপারেশন
        public void Approve(int makerId)
        {
            if (CheckerId == makerId)
                throw new Exception("যিনি লেনদেন শুরু করেছেন (Checker), তিনি নিজে এটি অনুমোদন (Maker) করতে পারবেন না।");

            MakerId = makerId;
            Status = "Approved";
        }
    }
}

```

---

### ২. Journal Entry Logic (Services ফোল্ডারে রাখুন)

```csharp
namespace CBS.Domain.Services
{
    public class JournalLine
    {
        public int GLCodeId { get; set; }
        public decimal Debit { get; set; }
        public decimal Credit { get; set; }
    }

    public class JournalEntry
    {
        public List<JournalLine> Lines { get; set; } = new List<JournalLine>();

        // বিজনেস রুল: ডাবল-এন্ট্রি ইকুয়ালিটি চেক
        public bool IsBalanced()
        {
            decimal totalDebit = Lines.Sum(x => x.Debit);
            decimal totalCredit = Lines.Sum(x => x.Credit);

            if (totalDebit != totalCredit)
                throw new Exception("Accounting Imbalance: ডেবিট এবং ক্রেডিট সমান হতে হবে।");

            return true;
        }
    }
}

```

---

### ৩. Posting Service (বিজনেস প্রসেস অটোমেশন)

এটি আপনার সেই Maker Approval বাটনের পেছনের মূল লজিক যা একাধিক রুল একসাথে চেক করে।

```csharp
namespace CBS.Domain.Services
{
    using CBS.Domain.Entities;

    public class PostingService
    {
        public void ProcessApproval(Transaction txn, Account acc, int currentUserId)
        {
            // ১. মেকার-চেকার নিয়ম প্রয়োগ
            txn.Approve(currentUserId);

            // ২. অ্যাকাউন্টের ব্যালেন্স আপডেট (এটি সাব-লেজার লেভেলে কাজ করবে)
            // নোট: এখানে GL এন্ট্রি হবে না কারণ এটি Shadow Posting
            acc.UpdateBalance(txn.Amount, "Deposit"); // বা "Withdraw" ট্রানজ্যাকশন অনুযায়ী
            
            // এরপর ডেটাবেসে সেভ করার জন্য রিপোজিটরি কল হবে
        }
    }
}




---

