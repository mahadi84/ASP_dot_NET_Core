
# 3) DOMAIN Layer (Entities + Business meaning)

## 3.1 Customer (User) entity

কেন দরকার: Customer info + login credential + role + lock state (security)

`src/OnlineBanking.Domain/Entities/Customer.cs`

```csharp
namespace OnlineBanking.Domain.Entities;

public sealed class Customer
{
    public Guid Id { get; set; } = Guid.NewGuid();

    public string Name { get; set; } = "";
    public string Email { get; set; } = "";
    public string City { get; set; } = "";

    // 5-digit account number used for login
    public string AccountNumber { get; set; } = "";

    public string PasswordHash { get; set; } = "";

    // admin panel support
    public bool IsAdmin { get; set; } = false;

    // security: lock account after too many failed logins
    public int FailedLoginCount { get; set; } = 0;
    public DateTimeOffset? LockedUntilUtc { get; set; }

    public Account Account { get; set; } = new();
}
```

## 3.2 Account

`RowVersion` দিয়ে concurrency control (একই সময়ে ২টা transfer হলে issue কমবে)

`src/OnlineBanking.Domain/Entities/Account.cs`

```csharp
namespace OnlineBanking.Domain.Entities;

public sealed class Account
{

//এটি অ্যাকাউন্টের Primary Key বা ইউনিক আইডি।
//এটি প্রেডিক্ট করা অসম্ভব এবং মাল্টিপল ডেটাবেস বা মাইক্রোসার্ভিসে ডেটা মার্জ করার সময় আইডির সংঘর্ষ (Collision) হয় না।
public Guid Id { get; set; } = Guid.NewGuid();

//এটি একটি Foreign Key।
//উদ্দেশ্য: এই অ্যাকাউন্টটি কোন গ্রাহকের(Customer) তা এই আইডির মাধ্যমে নিশ্চিত করা হয়। এটি ডেটাবেসে রিলেশনশিপ তৈরি করে।
public Guid CustomerId { get; set; }

//একে বলা হয় Navigation Property।
//উদ্দেশ্য: কোড করার সময় আপনি যেন account.Customer.Name লিখে সরাসরি গ্রাহকের নাম পেতে পারেন, সেজন্য এটি রাখা হয়। = default!;
//মানে হলো শুরুতে এটি নাল(null) থাকলেও পরে যখন ডেটাবেস থেকে ডেটা আসবে তখন এটি পূর্ণ হবে।
public Customer Customer { get; set; } = default!;

//কেন decimal: ব্যাংকিং এবং ফিন্যান্সিয়াল প্রজেক্টে সব সময় decimal ব্যবহার করতে হয়। float বা double ব্যবহার করলে রাউন্ডিং এরর(যেমন ০.০১ পয়সা হারিয়ে যাওয়া) হওয়ার ঝুঁকি থাকে।
//0m এর 'm' নির্দেশ করে এটি একটি ডেসিমেল ভ্যালু।
public decimal Balance { get; set; } = 0m;

//এটি ডাটাবেস লেভেলে Concurrency Conflict ঠেকায়। এটি ব্যাংকিং অ্যাপের জন্য সবচেয়ে গুরুত্বপূর্ণ ফিল্ড।
//RowVersion নিশ্চিত করে যে, একই সময়ে দুজন ব্যালেন্স আপডেট করতে পারবে না। যদি ডাটাবেসের ডাটা আপনার অগোচরে কেউ পরিবর্তন করে দেয়, তবে এটি এরর থ্রো করবে।
public byte[] RowVersion { get; set; } = Array.Empty<byte>(); 

//এটি একটি One-to-Many Relationship।
//উদ্দেশ্য: একটি অ্যাকাউন্টের অধীনে অনেকগুলো ট্রানজ্যাকশন(জমা, খরচ) থাকতে পারে।
//এটি সেই ট্রানজ্যাকশনগুলোর একটি লিস্ট ধরে রাখে। new ();
//দিয়ে একে শুরুতেই খালি লিস্ট হিসেবে ইনিশিয়ালাইজ করা হয়েছে যাতে কোডে null reference এরর না আসে।
public List<Transaction> Transactions { get; set; } = new();


}
```

## 3.3 Transaction

Transfer-এ দুইটা entry হবে: out + in
`Reference` এ “to 12345” লেখা থাকবে।

`src/OnlineBanking.Domain/Entities/Transaction.cs`

```csharp
namespace OnlineBanking.Domain.Entities;

public enum TransactionType
{
    Deposit = 1,
    Withdraw = 2,
    TransferOut = 3,
    TransferIn = 4
}

public sealed class Transaction
{
    public Guid Id { get; set; } = Guid.NewGuid();

    public Guid AccountId { get; set; }
    public Account Account { get; set; } = default!;

    public DateTimeOffset CreatedAtUtc { get; set; } = DateTimeOffset.UtcNow;

    public TransactionType Type { get; set; }

    public decimal Amount { get; set; }
    public decimal BalanceAfter { get; set; }

    public string? Reference { get; set; }
}
```

## 3.4 AuditLog (Real-world trace)

এটা real banking এ খুব দরকার: কে কখন কী করেছে।

`src/OnlineBanking.Domain/Entities/AuditLog.cs`

```csharp
namespace OnlineBanking.Domain.Entities;

public sealed class AuditLog
{
    public Guid Id { get; set; } = Guid.NewGuid();

    public DateTimeOffset CreatedAtUtc { get; set; } = DateTimeOffset.UtcNow;

    public string Action { get; set; } = "";          // e.g. LOGIN_SUCCESS, TRANSFER, ADMIN_RESET_PASSWORD
    public string ActorAccountNumber { get; set; } = ""; // who did it (accountNumber) or "SYSTEM"
    public string? TargetAccountNumber { get; set; }     // optional
    public string? Ip { get; set; }
    public string? UserAgent { get; set; }

    public string Message { get; set; } = "";
}
```

---
