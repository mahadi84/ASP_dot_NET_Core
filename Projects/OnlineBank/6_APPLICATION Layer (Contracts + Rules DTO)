# =====================================================
# 4) APPLICATION Layer (Contracts + Rules DTO)
# =====================================================

/*
‡¶è‡¶á ‡¶≤‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡ßÄ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá?
- Business rules (configuration)
- Result pattern (success / fail)
- Service contracts (interface)
üëâ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã database, EF Core ‡¶¨‡¶æ implementation ‡¶•‡¶æ‡¶ï‡ßá ‡¶®‡¶æ
*/

4.1 Rules config model  = CurrencySymbol,timezone, transfer limit
4.2 Result wrapper (success/fail)
4.3 Contracts
    > IAuthService:
        -RegisterAsync()
        -ValidateLoginAsync()
    
     > IBankingService
        -GetBalanceAsync()
        -WithdrawAsync()
        -TransferAsync()
        -GetProfileAsync()
        -GetLastTransactionsAsync()
    
     > IStatementPdfService
        -BuildMiniStatementPdf()
    
    > IAdminService
            -GetCustomersAsync()
            -GetCustomerByAccountAsync()
            -LockAsync()
            -UnlockAsync()
            -ResetPasswordAsync()
            -GetLatestAuditAsync()






// =====================================================
// 4.1 Rules config model
// =====================================================

/*
‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:
src/OnlineBanking.Application/Options/BankingRulesOptions.cs
*/

namespace OnlineBanking.Application.Options;

public sealed class BankingRulesOptions 
{
    // ‡¶ï‡ßã‡¶® currency symbol ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá
    // UI ‡¶è‡¶¨‡¶Ç PDF statement ‡¶è ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø (‡ß≥, $, ‚Ç¨)
    public string CurrencySymbol { get; set; } = "‡ß≥";

    // ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶ï‡ßã‡¶® timezone follow ‡¶ï‡¶∞‡¶¨‡ßá
    // transaction time ‡¶ì statement time ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶ï‡¶æ‡¶ú‡ßá ‡¶≤‡¶æ‡¶ó‡ßá
    public string TimeZoneId { get; set; } = "Asia/Dhaka";

    // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá
    // ‡¶è‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡¶æ‡¶Æ‡¶≤‡ßá withdraw / transfer ‡¶¨‡ßç‡¶≤‡¶ï ‡¶π‡¶¨‡ßá
    public decimal MinimumBalance { get; set; } = 0m;

    // ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö transfer limit
    // fraud ‡¶ì risk control ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
    public decimal DailyTransferLimit { get; set; } = 0m;
}


// =====================================================
// 4.2 Result wrapper (success/fail)
// =====================================================

/*
‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:
src/OnlineBanking.Application/Common/Result.cs
*/

namespace OnlineBanking.Application.Common;

// ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ success / failure result
public sealed record Result(bool Success, string Message)  // (Non-generic): ‡¶è‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶§‡¶ñ‡¶®‡¶á ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶π‡ßü ‡¶Ø‡¶ñ‡¶® ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶´‡ßá‡¶∞‡¶§ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶® ‡¶®‡ßá‡¶á (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶û‡ßç‡¶ú)‡•§
{
    // ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü
    public static Result Ok(string msg = "OK")
        => new(true, msg);

    // ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü
    public static Result Fail(string msg)
        => new(false, msg);
}

// data ‡¶∏‡¶π result (generic version)
public sealed record Result<T>(bool Success, string Message, T? Data)  // Result<T> (Generic): ‡¶è‡¶ü‡¶ø ‡¶§‡¶ñ‡¶®‡¶á ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü ‡¶Ø‡¶ñ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ (‡¶Ø‡ßá‡¶Æ‡¶®: User Object, List, ‡¶¨‡¶æ Amount) ‡¶´‡ßá‡¶∞‡¶§ ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡ßü‡•§
{ 
    // ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá data ‡¶∏‡¶π result ‡¶´‡ßá‡¶∞‡¶§ ‡¶¶‡ßá‡ßü
    public static Result<T> Ok(T data, string msg = "OK")
        => new(true, msg, data);

    // ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßá data = null ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
    public static Result<T> Fail(string msg)
        => new(false, msg, default);
}


// =====================================================
// 4.3 Contracts
// =====================================================

using OnlineBanking.Application.Common;
using OnlineBanking.Domain.Entities;

namespace OnlineBanking.Application.Contracts;


// -----------------------------------------------------
// IAuthService
// -----------------------------------------------------

/*
‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:
src/OnlineBanking.Application/Contracts/IAuthService.cs
*/

public interface IAuthService
{
    // ‡¶®‡¶§‡ßÅ‡¶® customer register ‡¶ï‡¶∞‡ßá
    // name, email, password, city ‡¶•‡ßá‡¶ï‡ßá account ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü
    // ip ‡¶ì userAgent audit log ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡ßü
    Task<Result<string>> RegisterAsync(
        string name,
        string email,
        string password,
        string city,
        string ip,
        string userAgent
    );

    // login validate ‡¶ï‡¶∞‡ßá
    // accountNumber ‡¶ì password ‡¶Æ‡¶ø‡¶≤‡¶≤‡ßá customerId ‡¶´‡ßá‡¶∞‡¶§ ‡¶¶‡ßá‡ßü
    // isAdmin ‡¶¶‡¶ø‡ßü‡ßá role ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü
    Task<Result<(Guid CustomerId, bool IsAdmin)>> ValidateLoginAsync(
        string accountNumber,
        string password,
        string ip,
        string userAgent
    );
}


// -----------------------------------------------------
// IBankingService
// -----------------------------------------------------

/*
‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:
src/OnlineBanking.Application/Contracts/IBankingService.cs
*/

public interface IBankingService
{
    // ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü customer ‡¶è‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® balance ‡¶¶‡ßá‡¶ñ‡¶æ‡ßü
    Task<decimal> GetBalanceAsync(Guid customerId);

    // ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ (Deposit)
    Task<Result> DepositAsync(
        Guid customerId,
        decimal amount,
        string ip,
        string userAgent
    );

    // ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ (Withdraw)
    // minimum balance rule ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ó ‡¶π‡¶¨‡ßá
    Task<Result> WithdrawAsync(
        Guid customerId,
        decimal amount,
        string ip,
        string userAgent
    );

    // ‡¶ü‡¶æ‡¶ï‡¶æ transfer ‡¶ï‡¶∞‡¶æ
    // daily transfer limit + balance check ‡¶π‡¶¨‡ßá
    Task<Result> TransferAsync(
        Guid customerId,
        string toAccountNumber,
        decimal amount,
        string ip,
        string userAgent
    );

    // Dashboard profile info
    Task<(string CustomerName, string AccountNumber, decimal Balance)>
        GetProfileAsync(Guid customerId);

    // ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶ï‡¶ø‡¶õ‡ßÅ transaction
    // default = last 10
    Task<IReadOnlyList<Transaction>>
        GetLastTransactionsAsync(Guid customerId, int take = 10);
}


// -----------------------------------------------------
// IStatementPdfService
// -----------------------------------------------------

/*
‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:
src/OnlineBanking.Application/Contracts/IStatementPdfService.cs
*/

public interface IStatementPdfService
{
    // Mini statement PDF ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá
    // byte[] ‡¶´‡ßá‡¶∞‡¶§ ‡¶¶‡ßá‡ßü ‡¶Ø‡¶æ‡¶§‡ßá API ‡¶•‡ßá‡¶ï‡ßá download ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü
    byte[] BuildMiniStatementPdf(
        string currency,
        string tzId,
        string accountNumber,
        string customerName,
        decimal currentBalance,
        IReadOnlyList<Transaction> last10
    );
}


// -----------------------------------------------------
// IAdminService
// -----------------------------------------------------

/*
‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:
src/OnlineBanking.Application/Contracts/IAdminService.cs
*/

public interface IAdminService
{
    // ‡¶∏‡¶¨ customer ‡¶è‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ
    Task<IReadOnlyList<Customer>> GetCustomersAsync();

    // account number ‡¶¶‡¶ø‡ßü‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü customer ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ
    Task<Customer?> GetCustomerByAccountAsync(string accountNumber);

    // ‡¶ï‡¶æ‡¶â‡¶ï‡ßá admin ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã ‡¶¨‡¶æ admin ‡¶∏‡¶∞‡¶æ‡¶®‡ßã
    Task<Result> SetAdminAsync(
        string accountNumber,
        bool isAdmin,
        string actorAcc,
        string ip,
        string ua
    );

    // ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø account lock ‡¶ï‡¶∞‡¶æ
    Task<Result> LockAsync(
        string accountNumber,
        int minutes,
        string actorAcc,
        string ip,
        string ua
    );

    // account unlock ‡¶ï‡¶∞‡¶æ
    Task<Result> UnlockAsync(
        string accountNumber,
        string actorAcc,
        string ip,
        string ua
    );

    // admin ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ password reset
    Task<Result> ResetPasswordAsync(
        string accountNumber,
        string newPassword,
        string actorAcc,
        string ip,
        string ua
    );

    // ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï audit log ‡¶¶‡ßá‡¶ñ‡¶æ
    Task<IReadOnlyList<AuditLog>> GetLatestAuditAsync(int take = 100);
}




-
