DATE: 15 Dec 2025


"‡¶è‡¶ï‡¶ü‡¶ø .NET Core MVC ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡¶æ 1M ‡¶∞‡ßã-‡¶è‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø CSV ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶¨‡ßá‡•§ ‡¶∞‡ßã-‡¶ó‡ßÅ‡¶≤‡¶ø‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡ßá‡¶∞ ‡ß¨‡ß¶‡ß¶-‡¶è‡¶∞‡¶ì ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶û‡ßç‡¶ö‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø `ABD` ‡¶¶‡¶ø‡ßü‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶ï‡ßã‡¶°‡¶∏‡¶π ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§ 
‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø `ABD` ‡¶ï‡ßã‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶∏‡¶´‡¶ü ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‡¶¶‡¶ø‡¶®‡•§"

"Design .net core mvc app which will upload csv file of 1M row. row contain multiple data with unique code start with ABD for more than 600 banchase of a Bank.
Add total¬† amount of each ABD code differently, show and download in microsoft excel formate. give explanation" convert the sentence in Bangla




##################################################################################################
                           WHAT I'V LEARNED SO FAR
##################################################################################################


### üîπ 1. Project Overview (Opening ‚Äì ‡ß©‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°)

> ‚Äú‡¶Ü‡¶Æ‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø WesterUnionPD ‡¶®‡¶æ‡¶Æ‡ßá ‡¶è‡¶ï‡¶ü‡¶ø financial data processing system ‡¶®‡¶ø‡ßü‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§
> ‡¶è‡¶á ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡¶ü‡¶ø‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø ‡¶õ‡¶ø‡¶≤
  - ‡¶ñ‡ßÅ‡¶¨ ‡¶¨‡ßú ‡¶Ü‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ CSV ‡¶´‡¶æ‡¶á‡¶≤ (‡ßß ‡¶Æ‡¶ø‡¶≤‡¶ø‡ßü‡¶®+ row) ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ, 
  - ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶ï‡¶ü‡¶ø‡¶ì ‡¶≠‡ßÅ‡¶≤ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ó‡ßç‡¶∞‡¶π‡¶£‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶®‡ßü‡•§‚Äù

---

### üîπ 2. Problem Statement (Why this system ‚Äì ‡ß™‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°)

> ‚ÄúFinancial ‡¶¨‡¶æ banking data‚Äì‡¶§‡ßá ‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶¨‡ßú ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá silent error‡•§
> ‡¶è‡¶ï‡¶ü‡¶æ ‡¶õ‡ßã‡¶ü ‡¶≠‡ßÅ‡¶≤ row ‡¶•‡¶æ‡¶ï‡¶≤‡ßá‡¶ì ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡ßá‡¶ü‡¶æ‡¶ï‡ßá ignore ‡¶ï‡¶∞‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶≠‡ßÅ‡¶≤ total ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá, ‡¶Ø‡¶æ production-‡¶è ‡¶Æ‡¶æ‡¶∞‡¶æ‡¶§‡ßç‡¶Æ‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡•§‚Äù

> ‚Äú‡¶è‡¶õ‡¶æ‡ßú‡¶æ ‡¶¨‡ßú CSV ‡¶´‡¶æ‡¶á‡¶≤ ‡¶π‡¶≤‡ßá:
  - memory overflow,
  - request timeout,
  - partial data save
  ‡¶è‡¶á ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ñ‡ßÅ‡¶¨ ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡•§‚Äù

---

### üîπ 3. Architecture Approach (High-level design ‚Äì ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)

> ‚Äú‡¶è‡¶á ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶Æ‡¶ø job-based architecture ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§‚Äù

> ‚ÄúUser ‡¶Ø‡¶ñ‡¶® CSV upload ‡¶ï‡¶∞‡ßá, ‡¶§‡¶ñ‡¶®:
  - upload ‡¶è‡¶¨‡¶Ç processing ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü,
  - ‡¶è‡¶ï‡¶ü‡¶ø JobId ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü,
  - ‡¶è‡¶¨‡¶Ç background worker ‡¶∏‡ßá‡¶á job ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡ßá‡•§‚Äù
> ‚Äú‡¶è‡¶§‡ßá ‡¶ï‡¶∞‡ßá HTTP request block ‡¶π‡ßü ‡¶®‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßú ‡¶´‡¶æ‡¶á‡¶≤ ‡¶π‡¶≤‡ßá‡¶ì ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ stable ‡¶•‡¶æ‡¶ï‡ßá‡•§‚Äù

---

### üîπ 4. Large File Handling (Scalability ‚Äì ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)

> ‚Äú‡¶Ü‡¶Æ‡¶ø CSV ‡¶´‡¶æ‡¶á‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã streaming mode-‡¶è ‡¶™‡ßú‡ßá‡¶õ‡¶ø, ‡¶Æ‡¶æ‡¶®‡ßá ‡¶™‡ßÅ‡¶∞‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ï‡¶ñ‡¶®‡ßã‡¶á memory-‡¶§‡ßá ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü ‡¶®‡¶æ‡•§‚Äù
> ‚Äú‡¶è‡¶§‡ßá ‡¶ï‡¶∞‡ßá:
  - ‡ßß ‡¶Æ‡¶ø‡¶≤‡¶ø‡ßü‡¶®+ row ‡¶π‡¶≤‡ßá‡¶ì RAM safe ‡¶•‡¶æ‡¶ï‡ßá,
  - ‡¶è‡¶¨‡¶Ç system predictably scale ‡¶ï‡¶∞‡ßá‡•§‚Äù

---

### üîπ 5. Data Integrity & No-Data-Loss (Most important ‚Äì ‡ßß.‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)

> ‚Äú‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶¨‡ßú ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶õ‡¶ø‡¶≤ data integrity‡•§‚Äù
> ‚Äú‡¶Ü‡¶Æ‡¶ø fail-fast validation ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø:
  - Account ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á `ABD + 6 digit` ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá,
  - amount field ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á valid numeric ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§‚Äù

> ‚Äú‡¶Ø‡¶¶‡¶ø ‡¶è‡¶ï‡¶ü‡¶æ‡¶ì row invalid ‡¶π‡ßü, ‡¶™‡ßÅ‡¶∞‡ßã job fail ‡¶ï‡¶∞‡ßá‚Äî
> ‡¶ï‡¶æ‡¶∞‡¶£ financial system-‡¶è ‡¶≠‡ßÅ‡¶≤ output, no output ‡¶•‡ßá‡¶ï‡ßá‡¶ì ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™‡•§‚Äù

> ‚ÄúDatabase-‡¶è ‡¶Ü‡¶Æ‡¶ø transaction ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá atomic save ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø,
> ‡¶Ø‡¶æ‡¶§‡ßá partial data ‡¶ï‡¶ñ‡¶®‡ßã persist ‡¶®‡¶æ ‡¶π‡ßü‡•§‚Äù

---

### üîπ 6. User Experience (Progress & Auto Update ‚Äì ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)

> ‚ÄúUser experience ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶ø ‡¶¶‡ßÅ‡¶á ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ progress ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§‚Äù

> ‚Äú‡¶è‡¶ï‡¶ü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá:
 - upload progress bar, ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá user ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡ßü file ‡¶ï‡¶§‡¶ü‡ßÅ‡¶ï‡ßÅ upload ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§‚Äù

> ‚Äú‡¶Ü‡¶∞‡ßá‡¶ï‡¶ü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá:
 - processing progress, ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡¶§ row ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡ßü‡•§‚Äù

> ‚ÄúProcessing ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá user-‡¶ï‡ßá refresh ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡ßü ‡¶®‡¶æ‚Äî
> page ‡¶®‡¶ø‡¶ú‡ßá‡¶á polling ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá auto-update ‡¶π‡ßü ‡¶è‡¶¨‡¶Ç result ‡¶¶‡ßá‡¶ñ‡¶æ‡ßü‡•§‚Äù

---

### üîπ 7. Security Measures (Enterprise mindset ‚Äì ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)

> ‚Äú‡¶ï‡¶æ‡¶∞‡¶£ ‡¶è‡¶ü‡¶æ sensitive data, ‡¶§‡¶æ‡¶á security ‡¶®‡¶ø‡ßü‡ßá ‡¶Ü‡¶Æ‡¶ø ‡¶ñ‡ßÅ‡¶¨ strict ‡¶õ‡¶ø‡¶≤‡¶æ‡¶Æ‡•§‚Äù
> ‚Äú‡¶™‡ßÅ‡¶∞‡ßã application-‡¶ü‡¶æ IP-whitelisted:
* ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü internal IP ‡¶•‡ßá‡¶ï‡ßá‡¶á access ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡•§‚Äù

> ‚ÄúRaw CSV ‡¶ï‡¶ñ‡¶®‡ßã database-‡¶è ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡ßü ‡¶®‡¶æ‚Äî
> ‡¶∂‡ßÅ‡¶ß‡ßÅ aggregated summary ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡•§‚Äù

> ‚ÄúDelete operation:
* POST-only,
* CSRF protected,
* ‡¶è‡¶¨‡¶Ç password-protected ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§‚Äù

---

### üîπ 8. Result Management (Real-world usability ‚Äì ‡ß™‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°)

> ‚ÄúUser ‡¶Ø‡ßá‡¶® ‡¶Ü‡¶ó‡ßá‡¶∞ processed file ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá ‡¶®‡¶æ ‡¶´‡ßá‡¶≤‡ßá, ‡¶∏‡ßá‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶ø:
* recent job history ‡¶¶‡ßá‡¶ñ‡¶ø‡ßü‡ßá‡¶õ‡¶ø,
* ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø completed job-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ download ‡¶ì delete button ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø‡•§‚Äù

> ‚Äú‡¶è‡¶§‡ßá ‡¶ï‡¶∞‡ßá system‡¶ü‡¶æ ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨ production usage-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶â‡¶™‡¶Ø‡ßã‡¶ó‡ßÄ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§‚Äù

---

### üîπ 9. Closing (Strong finish ‚Äì ‡ß®‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°)

> ‚Äú‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶Æ‡¶ø ‡¶∂‡¶ø‡¶ñ‡ßá‡¶õ‡¶ø -
‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá-
-Performance, 
-Security, 
-Data integrity ‡¶è‡¶¨‡¶Ç 
-User experience ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá balance ‡¶ï‡¶∞‡ßá 
‡¶è‡¶ï‡¶ü‡¶ø production-grade financial system ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡ßü‡•§‚Äù

> ‚Äú‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ü‡¶æ‡¶ï‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶æ application ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶®‡ßü,
> ‡¶¨‡¶∞‡¶Ç ‡¶è‡¶ï‡¶ü‡¶ø reliable system ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§‚Äù

---

## üî• Short Version (‡ß® ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá ‡¶¨‡¶≤‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)

> ‚Äú‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø .NET-based financial CSV processing system ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá-
01. ‡¶¨‡ßú ‡¶´‡¶æ‡¶á‡¶≤ streaming-‡¶è ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡ßü, 
02. strict validation ‡¶¶‡¶ø‡ßü‡ßá ‡¶≠‡ßÅ‡¶≤ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü, 
03. background worker ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá timeout ‡¶è‡ßú‡¶æ‡¶®‡ßã ‡¶π‡ßü, ‡¶è‡¶¨‡¶Ç 
04. IP-restricted secure environment-‡¶è Excel report generate ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡•§ 
05. ‡¶™‡ßÅ‡¶∞‡ßã ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡¶ü‡¶æ‡¶á production-grade mindset ‡¶¶‡¶ø‡ßü‡ßá ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ï‡¶∞‡¶æ‡•§‚Äù

---

## üéØ Interviewer ‡¶Ø‡¶¶‡¶ø follow-up ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶∞‡ßá

Q: ‡¶∏‡¶¨ row valid ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶ï‡ßá‡¶® ‡¶™‡ßÅ‡¶∞‡ßã job fail ‡¶ï‡¶∞‡¶≤‡ßá‡¶®?
A: ‚ÄúFinancial data-‡¶§‡ßá silent error ‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶¨‡¶ø‡¶™‡¶ú‡ßç‡¶ú‡¶®‡¶ï‡•§ ‡¶≠‡ßÅ‡¶≤ output ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶á safer choice‡•§‚Äù

Q: WebSocket ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø ‡¶ï‡ßá‡¶®?
A: ‚ÄúPolling ‡¶è‡¶ñ‡¶æ‡¶®‡ßá simpler, auditable ‡¶è‡¶¨‡¶Ç enterprise-friendly‚Äî‡¶ï‡¶Æ moving parts‡•§‚Äù

Q: ‡¶è‡¶á system scale ‡¶ï‡¶∞‡¶¨‡ßá ‡¶§‡ßã?
A: ‚ÄúStreaming + background processing ‡¶•‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá file size ‡¶è‡¶¨‡¶Ç row count ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ linear scale ‡¶ï‡¶∞‡¶¨‡ßá‡•§‚Äù

---

############################################################################################
                                      CODE with EXPLANATION
############################################################################################

‡¶®‡¶ø‡¶ö‡ßá ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ WesternUnionPD ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡¶ü‡¶æ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶®‡ßã‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶ï‡¶∞‡ßá Step-by-step ‡¶∏‡¶æ‡¶ú‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶≤‡¶æ‡¶Æ‚Äî‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶æ Step ‡¶è ‡¶•‡¶æ‡¶ï‡¶¨‡ßá:

‚úÖ Step # (Title)
‚úÖ ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
‚úÖ ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
‚úÖ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
‚úÖ ‡¶è‡¶ï‡¶á ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡ßá‡¶á Step-‡¶è‡¶∞ code (file path ‡¶∏‡¶π)

> ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø: ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡ßá‡¶® ‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶∂‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶è‡¶ï‡¶á ‡¶∏‡¶æ‡¶•‡ßá code ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§

---

# ‚úÖ Step 1 ‚Äî Project ‡¶§‡ßà‡¶∞‡¶ø (Project Skeleton)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
.NET 9 MVC ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§

### ‡¶ï‡ßá‡¶® MVC ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
MVC structure ‡¶•‡¶æ‡¶ï‡¶≤‡ßá UI/Logic/Data ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, maintain ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶π‡¶ú ‡¶π‡ßü‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
‡¶è‡¶ï‡¶ü‡¶æ ‡¶¨‡ßú system ‡¶è code ‡¶ú‡¶ü‡¶≤‡¶æ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü‡•§

### Code
dotnet new mvc -n WesternUnionPD
cd WesternUnionPD

---

# ‚úÖ Step 2 ‚Äî Packages ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ (CSV, Excel, MySQL, EF Core)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá

CSV read, Excel export, MySQL + EF Core support ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞

* 1M row CSV: efficient parser ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
* Excel report: business output
* MySQL: persistent storage
* EF Core: safe DB access

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ

CSV/Excel/MySQL ‡¶ï‡¶æ‡¶ú‡¶á ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ ‡¶¨‡¶æ custom code ‡¶¨‡¶æ‡ßú‡¶¨‡ßá‡•§

### Code

```bash
dotnet add package CsvHelper                             //‡¶è‡¶ü‡¶ø ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø EF-‡¶è‡¶∞ ‡¶Ö‡¶Ç‡¶∂ ‡¶®‡¶Ø‡¶º, ‡¶§‡¶¨‡ßá CSV ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¨‡¶æ ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
dotnet add package ClosedXML                             //‡¶è‡¶ü‡¶ø‡¶ì ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø EF-‡¶è‡¶∞ ‡¶Ö‡¶Ç‡¶∂ ‡¶®‡¶Ø‡¶º, ‡¶§‡¶¨‡ßá EF ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ‡¶ï‡ßá Excel (.xlsx) ‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú‡ßá ‡¶≤‡¶æ‡¶ó‡ßá‡•§
dotnet add package Pomelo.EntityFrameworkCore.MySql      //EF-‡¶ï‡ßá MySQL ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ì ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡ßç‡¶∑‡¶Æ‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßá‡•§
dotnet add package Microsoft.EntityFrameworkCore.Design  //‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Æ‡¶æ‡¶á‡¶ó‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶§‡ßà‡¶∞‡¶ø, ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶Æ‡¶°‡ßá‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶ø‡¶Ç‡ßü‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã EF ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ü‡¶ø ‡¶Ö‡¶™‡¶∞‡¶ø‡¶π‡¶æ‡¶∞‡ßç‡¶Ø‡•§
dotnet add package Microsoft.EntityFrameworkCore.Tools   //EF ‡¶Æ‡¶æ‡¶á‡¶ó‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶∞‡¶û‡ßç‡¶ú‡¶æ‡¶Æ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶≤‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶π‡ßü‡•§
```

---

# ‚úÖ Step 3 ‚Äî Configuration (appsettings.json)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá 
DB connection, 1GB limit, IP whitelist, admin delete password config ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Hardcode ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá config ‡¶∞‡¶æ‡¶ñ‡¶≤‡ßá security + environment change ‡¶∏‡¶π‡¶ú‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ 
Password/IP ‡¶ï‡ßã‡¶°‡ßá leak ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá, production-‡¶è change ‡¶ï‡¶∞‡¶æ ‡¶ï‡¶†‡¶ø‡¶®‡•§

### Code (üìÑ `appsettings.json`)

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Port=3306;Database=western_union_pd;User=root;Password=YOUR_PASSWORD;TreatTinyAsBoolean=false;"
  },
  "Upload": {
    "MaxUploadBytes": 1073741824,
    "AllowedIPs": [
      "172.25.5.60",
      "172.25.5.59"
    ]
  },
  "Admin": {
    "DeletePassword": "WUPD@SECURE#2026"
  }
}
```

---

# ‚úÖ Step 4 ‚Äî IP Whitelist Middleware (Global Security Gate)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
Allowed IP ‡¶õ‡¶æ‡ßú‡¶æ ‡¶∏‡¶¨ request ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø‡•§

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Bank data public access ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá‚Äîupload/download/delete ‡¶∏‡¶¨‡¶á locked‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
URL ‡¶ú‡¶æ‡¶®‡¶≤‡ßá‡¶á ‡¶Ø‡ßá ‡¶ï‡ßá‡¶â access ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‚Äîhigh risk‡•§

### Code (üìÑ `Middleware/IpWhitelistMiddleware.cs`)

```csharp
namespace WesternUnionPD.Middleware;

/// <summary>
/// Blocks all requests except allowed IPs (upload/download/delete all protected).
/// </summary>
public sealed class IpWhitelistMiddleware
{
    private readonly RequestDelegate _next;
    private readonly HashSet<string> _allowedIps;

    public IpWhitelistMiddleware(RequestDelegate next, IConfiguration cfg)
    {
        _next = next;
        _allowedIps = cfg.GetSection("Upload:AllowedIPs")
                         .Get<string[]>()!
                         .ToHashSet();
    }

    public async Task InvokeAsync(HttpContext ctx)
    {
        var ip = ctx.Connection.RemoteIpAddress?.MapToIPv4().ToString();

        if (ip == null || !_allowedIps.Contains(ip))
        {
            ctx.Response.StatusCode = StatusCodes.Status403Forbidden;
            await ctx.Response.WriteAsync("Access denied: IP not allowed.");
            return;
        }

        await _next(ctx);
    }
}
```

---

# ‚úÖ Step 5 ‚Äî Program.cs (Pipeline + DI + 1GB limit)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
* EF Core + MySQL register
* 1GB upload limit enforce
* Services (CSV/Excel/Queue/Worker) register
* Middleware pipeline set

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
ASP.NET Core ‡¶è order & DI ‡¶†‡¶ø‡¶ï ‡¶®‡¶æ ‡¶π‡¶≤‡ßá security/feature ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
Upload limit fail, background processing fail, middleware skip ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§

### Code (üìÑ `Program.cs`)
```csharp
using Microsoft.EntityFrameworkCore;
using WesternUnionPD.Data;
using WesternUnionPD.Services;
using WesternUnionPD.Middleware;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllersWithViews();

var conn = builder.Configuration.GetConnectionString("DefaultConnection");
builder.Services.AddDbContext<AppDbContext>(opt =>
{
    opt.UseMySql(conn, ServerVersion.AutoDetect(conn));
});

// 1GB hard limit
builder.Services.Configure<Microsoft.AspNetCore.Http.Features.FormOptions>(o =>
{
    o.MultipartBodyLengthLimit = builder.Configuration.GetValue<long>("Upload:MaxUploadBytes");
});

builder.Services.AddScoped<ICsvAggregationService, CsvAggregationService>();
builder.Services.AddSingleton<IUploadJobQueue, UploadJobQueue>();
builder.Services.AddHostedService<UploadJobWorker>();
builder.Services.AddSingleton<IExcelExportService, ExcelExportService>();

var app = builder.Build();

app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseRouting();

// üîê Global IP whitelist
app.UseMiddleware<IpWhitelistMiddleware>();

app.MapControllerRoute(
    name: "default",
    pattern: "{controller=BranchCharge}/{action=Upload}/{id?}");

app.Run();
```

---

# ‚úÖ Step 6 ‚Äî Database Context (EF Core)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
MySQL DB-‡¶§‡ßá ‡¶¶‡ßÅ‡¶á‡¶ü‡¶æ table ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßã: Job + Aggregated Summary

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Raw CSV ‡¶∞‡¶æ‡¶ñ‡¶æ risky; ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ aggregated totals ‡¶∞‡¶æ‡¶ñ‡¶õ‡¶ø‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
DB bloated + sensitive leak risk‡•§

### Code (üìÑ `Data/AppDbContext.cs`)

```csharp
using Microsoft.EntityFrameworkCore;
using WesternUnionPD.Models;

namespace WesternUnionPD.Data;

/// <summary>
/// Stores only job & aggregated summaries (NO raw CSV stored).
/// </summary>
public sealed class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> opt) : base(opt) { }

    public DbSet<UploadJob> UploadJobs => Set<UploadJob>();
    public DbSet<BranchSummary> BranchSummaries => Set<BranchSummary>();
}
```

---

# ‚úÖ Step 7 ‚Äî Models (Job + Summary)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
 UploadJob: status + processed row count
 BranchSummary: ABD code wise totals

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Job ‡¶ß‡¶æ‡¶∞‡¶£‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá download/history/delete reliable ‡¶π‡ßü‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
Go Back ‡¶ï‡¶∞‡¶≤‡ßá job link ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá ‡¶Ø‡ßá‡¶§‡•§

### Code (üìÑ `Models/UploadJob.cs`)

```csharp
namespace WesternUnionPD.Models;

/// <summary>
/// One upload+process job (tracked by JobId).
/// </summary>
public sealed class UploadJob
{
    public Guid Id { get; set; }
    public string Status { get; set; } = "Queued"; // Queued|Processing|Completed|Failed
    public string? Error { get; set; }
    public long ProcessedRows { get; set; }
    public DateTime CreatedUtc { get; set; } = DateTime.UtcNow;
}
```

### Code (üìÑ `Models/BranchSummary.cs`)

```csharp
namespace WesternUnionPD.Models;

/// <summary>
/// Aggregated totals per ABDxxxxxx.
/// </summary>
public sealed class BranchSummary
{
    public int Id { get; set; }
    public Guid UploadJobId { get; set; }

    public string AbdCode { get; set; } = ""; // ABD + 6 digits
    public decimal ChargesLOC { get; set; }
    public decimal FxLOC { get; set; }

    public decimal GrandTotal => ChargesLOC + FxLOC;
}
```

---

# ‚úÖ Step 8 ‚Äî CSV Aggregation (Streaming + Fail-Fast Validation)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
* CSV row-by-row read (streaming)
* Account must be `ABD + 6 digit` strict
* numeric parse strict
* progress update (ProcessedRows)

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Financial data-‡¶§‡ßá silent error ‡¶≠‡ßü‡¶Ç‡¶ï‡¶∞‡•§ Fail-fast = wrong output ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
Wrong totals ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá, audit fail ‡¶π‡¶¨‡ßá‡•§

### Code (üìÑ `Services/ICsvAggregationService.cs`)
```csharp
using WesternUnionPD.Data;
using WesternUnionPD.Models;

namespace WesternUnionPD.Services;

public interface ICsvAggregationService
{
    Task<List<BranchSummary>> AggregateAsync(Stream csvStream, UploadJob job, AppDbContext db, CancellationToken ct);
}
```

### Code (üìÑ `Services/CsvAggregationService.cs`)

```csharp
using CsvHelper;
using CsvHelper.Configuration;
using System.Globalization;
using System.Text.RegularExpressions;
using WesternUnionPD.Data;
using WesternUnionPD.Models;

namespace WesternUnionPD.Services;

/// <summary>
/// Streaming CSV aggregation with strict ABD validation (fail-fast).
/// </summary>
public sealed class CsvAggregationService : ICsvAggregationService
{
    private static readonly Regex AbdRegex = new(@"^ABD\d{6}$");

    public async Task<List<BranchSummary>> AggregateAsync(Stream csvStream, UploadJob job, AppDbContext db, CancellationToken ct)
    {
        var cfg = new CsvConfiguration(CultureInfo.InvariantCulture)
        {
            HasHeaderRecord = true,
            IgnoreBlankLines = true,
            TrimOptions = TrimOptions.Trim
        };

        using var reader = new StreamReader(csvStream);
        using var csv = new CsvReader(reader, cfg);

        // Require headers strictly
        if (!await csv.ReadAsync()) throw new InvalidDataException("CSV empty.");
        csv.ReadHeader();

        var dict = new Dictionary<string, (decimal c, decimal f)>(StringComparer.Ordinal);
        long processed = 0;

        while (await csv.ReadAsync())
        {
            ct.ThrowIfCancellationRequested();
            processed++;

            var account = (csv.GetField("Account") ?? "").Trim();
            if (!AbdRegex.IsMatch(account))
                throw new InvalidDataException("Invalid Account: must be ABD + 6 digits.");

            var charges = ParseMoney(csv.GetField("ShareOfChargesLOC"));
            var fx = ParseMoney(csv.GetField("ShareOfFXLOC"));

            if (dict.TryGetValue(account, out var agg))
                dict[account] = (agg.c + charges, agg.f + fx);
            else
                dict[account] = (charges, fx);

            // Update DB progress every 5000 rows
            if (processed % 5000 == 0)
            {
                job.ProcessedRows = processed;
                await db.SaveChangesAsync(ct);
            }
        }

        job.ProcessedRows = processed;
        await db.SaveChangesAsync(ct);

        return dict.Select(x => new BranchSummary
        {
            UploadJobId = job.Id,
            AbdCode = x.Key,
            ChargesLOC = x.Value.c,
            FxLOC = x.Value.f
        }).ToList();
    }

    private static decimal ParseMoney(string? raw)
    {
        raw = (raw ?? "").Trim();
        if (raw.Length == 0) return 0m;

        raw = raw.Replace(",", ""); // allow 1,234.50
        if (!decimal.TryParse(raw, out var v))
            throw new InvalidDataException("Invalid numeric amount in CSV.");

        return v;
    }
}
```

---

# ‚úÖ Step 9 ‚Äî Queue + Background Worker (No Timeout + Reliability)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
Upload request ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá‡¶ì processing background ‡¶è ‡¶ö‡¶≤‡¶¨‡ßá‡•§

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
1M rows processing HTTP request ‡¶è ‡¶ï‡¶∞‡¶≤‡ßá timeout ‡¶π‡ßü‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
User ‚Äúrequest timeout‚Äù ‡¶™‡¶æ‡¶¨‡ßá, data inconsistent ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§

### Code (üìÑ `Services/IUploadJobQueue.cs`)

```csharp
namespace WesternUnionPD.Services;

public interface IUploadJobQueue
{
    ValueTask EnqueueAsync(Guid jobId, string tempPath, CancellationToken ct);
    ValueTask<(Guid jobId, string tempPath)> DequeueAsync(CancellationToken ct);
}
```

### Code (üìÑ `Services/UploadJobQueue.cs`)

```csharp
using System.Threading.Channels;

namespace WesternUnionPD.Services;

public sealed class UploadJobQueue : IUploadJobQueue
{
    private readonly Channel<(Guid, string)> _ch = Channel.CreateUnbounded<(Guid, string)>();

    public ValueTask EnqueueAsync(Guid jobId, string tempPath, CancellationToken ct)
        => _ch.Writer.WriteAsync((jobId, tempPath), ct);

    public ValueTask<(Guid jobId, string tempPath)> DequeueAsync(CancellationToken ct)
        => _ch.Reader.ReadAsync(ct);
}
```

### Code (üìÑ `Services/UploadJobWorker.cs`)

```csharp
using WesternUnionPD.Data;
using Microsoft.EntityFrameworkCore;

namespace WesternUnionPD.Services;

/// <summary>
/// Background worker: reads temp CSV, aggregates, saves atomically with transaction.
/// </summary>
public sealed class UploadJobWorker : BackgroundService
{
    private readonly IServiceScopeFactory _scopeFactory;
    private readonly IUploadJobQueue _queue;

    public UploadJobWorker(IServiceScopeFactory scopeFactory, IUploadJobQueue queue)
    {
        _scopeFactory = scopeFactory;
        _queue = queue;
    }

    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        while (!stoppingToken.IsCancellationRequested)
        {
            var (jobId, tempPath) = await _queue.DequeueAsync(stoppingToken);

            using var scope = _scopeFactory.CreateScope();
            var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();
            var agg = scope.ServiceProvider.GetRequiredService<ICsvAggregationService>();

            var job = await db.UploadJobs.FirstAsync(x => x.Id == jobId, stoppingToken);

            try
            {
                job.Status = "Processing";
                job.Error = null;
                await db.SaveChangesAsync(stoppingToken);

                await using var fs = File.OpenRead(tempPath);
                var summaries = await agg.AggregateAsync(fs, job, db, stoppingToken);

                // Atomic write (all-or-nothing)
                using var tx = await db.Database.BeginTransactionAsync(stoppingToken);

                db.BranchSummaries.RemoveRange(db.BranchSummaries.Where(x => x.UploadJobId == jobId));
                await db.SaveChangesAsync(stoppingToken);

                db.BranchSummaries.AddRange(summaries);
                job.Status = "Completed";

                await db.SaveChangesAsync(stoppingToken);
                await tx.CommitAsync(stoppingToken);
            }
            catch (Exception)
            {
                job.Status = "Failed";
                job.Error = "CSV processing failed (format/value invalid).";
                await db.SaveChangesAsync(stoppingToken);
            }
            finally
            {
                try { if (File.Exists(tempPath)) File.Delete(tempPath); } catch { /* ignore */ }
            }
        }
    }
}
```

---

# ‚úÖ Step 10 ‚Äî Excel Export (Business Output)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
Aggregated result Excel (.xlsx) ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã‡•§

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Finance team Excel format ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
Manual copy/paste ‚Üí error prone‡•§

### Code (üìÑ `Services/IExcelExportService.cs`)

```csharp
using WesternUnionPD.Models;

namespace WesternUnionPD.Services;

public interface IExcelExportService
{
    byte[] CreateExcel(List<BranchSummary> summaries);
}
```

### Code (üìÑ `Services/ExcelExportService.cs`)

```csharp
using ClosedXML.Excel;
using WesternUnionPD.Models;

namespace WesternUnionPD.Services;

public sealed class ExcelExportService : IExcelExportService
{
    public byte[] CreateExcel(List<BranchSummary> summaries)
    {
        using var wb = new XLWorkbook();
        var ws = wb.Worksheets.Add("BranchTotals");

        ws.Cell(1, 1).Value = "ABD Code";
        ws.Cell(1, 2).Value = "Charges LOC";
        ws.Cell(1, 3).Value = "FX LOC";
        ws.Cell(1, 4).Value = "Grand Total";
        ws.Range(1, 1, 1, 4).Style.Font.Bold = true;

        int r = 2;
        foreach (var s in summaries.OrderBy(x => x.AbdCode))
        {
            ws.Cell(r, 1).Value = s.AbdCode;
            ws.Cell(r, 2).Value = s.ChargesLOC;
            ws.Cell(r, 3).Value = s.FxLOC;
            ws.Cell(r, 4).Value = s.GrandTotal;
            r++;
        }

        ws.Columns().AdjustToContents();

        using var ms = new MemoryStream();
        wb.SaveAs(ms);
        return ms.ToArray();
    }
}
```

---

# ‚úÖ Step 11 ‚Äî Controller (Upload Ajax + Result + Download + History)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
* Upload page: recent jobs ‡¶¶‡ßá‡¶ñ‡¶æ‡ßü
* UploadAjax: progress bar support
* Result: polling ‡¶¶‡¶ø‡ßü‡ßá auto-update
* Download: completed ‡¶π‡¶≤‡ßá excel

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Professional UX: refresh ‡¶õ‡¶æ‡ßú‡¶æ result show, job history ‡¶•‡ßá‡¶ï‡ßá re-download‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
User confuse ‡¶π‡¶¨‡ßá, back ‡¶ó‡ßá‡¶≤‡ßá job ‡¶π‡¶æ‡¶∞‡¶æ‡¶¨‡ßá‡•§

### Code (üìÑ `Controllers/BranchChargeController.cs`) ‚Äî **Complete**

```csharp
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using WesternUnionPD.Data;
using WesternUnionPD.Models;
using WesternUnionPD.Services;

namespace WesternUnionPD.Controllers;

public sealed class BranchChargeController : Controller
{
    private readonly AppDbContext _db;
    private readonly IUploadJobQueue _queue;
    private readonly IExcelExportService _excel;
    private readonly long _maxBytes;

    public BranchChargeController(AppDbContext db, IUploadJobQueue queue, IExcelExportService excel, IConfiguration cfg)
    {
        _db = db;
        _queue = queue;
        _excel = excel;
        _maxBytes = cfg.GetValue<long>("Upload:MaxUploadBytes");
    }

    // Upload page with recent jobs list
    [HttpGet]
    public async Task<IActionResult> Upload()
    {
        var recentJobs = await _db.UploadJobs
            .AsNoTracking()
            .OrderByDescending(x => x.CreatedUtc)
            .Take(10)
            .ToListAsync();

        return View(recentJobs);
    }

    // AJAX upload endpoint (supports client-side upload progress bar)
    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task<IActionResult> UploadAjax(IFormFile file, CancellationToken ct)
    {
        if (file == null || file.Length == 0) return BadRequest("File missing.");
        if (!Path.GetExtension(file.FileName).Equals(".csv", StringComparison.OrdinalIgnoreCase))
            return BadRequest("Only .csv allowed.");
        if (file.Length > _maxBytes) return BadRequest("File too large (max 1GB).");

        // Save file to temp (NOT wwwroot)
        var tempDir = Path.Combine(Path.GetTempPath(), "western_union_pd_uploads");
        Directory.CreateDirectory(tempDir);
        var tempPath = Path.Combine(tempDir, $"{Guid.NewGuid():N}.csv");

        await using (var fs = System.IO.File.Create(tempPath))
        {
            await file.CopyToAsync(fs, ct);
        }

        // Create job
        var job = new UploadJob
        {
            Id = Guid.NewGuid(),
            Status = "Queued",
            CreatedUtc = DateTime.UtcNow,
            ProcessedRows = 0
        };

        _db.UploadJobs.Add(job);
        await _db.SaveChangesAsync(ct);

        // Background processing
        await _queue.EnqueueAsync(job.Id, tempPath, ct);

        return Json(new
        {
            jobId = job.Id,
            redirectUrl = Url.Action(nameof(Result), new { id = job.Id })
        });
    }

    // Result view (UI polls this page to auto-update status without manual refresh)
    [HttpGet]
    public async Task<IActionResult> Result(Guid id)
    {
        var job = await _db.UploadJobs.AsNoTracking().FirstOrDefaultAsync(x => x.Id == id);
        if (job == null) return NotFound();

        var summaries = await _db.BranchSummaries
            .AsNoTracking()
            .Where(x => x.UploadJobId == id)
            .OrderBy(x => x.AbdCode)
            .ToListAsync();

        ViewBag.Job = job;
        return View(summaries);
    }

    // Download Excel only when completed
    [HttpGet]
    public async Task<IActionResult> Download(Guid id)
    {
        var job = await _db.UploadJobs.AsNoTracking().FirstOrDefaultAsync(x => x.Id == id);
        if (job == null) return NotFound();
        if (!string.Equals(job.Status, "Completed", StringComparison.OrdinalIgnoreCase))
            return BadRequest("Job not completed.");

        var summaries = await _db.BranchSummaries
            .AsNoTracking()
            .Where(x => x.UploadJobId == id)
            .OrderBy(x => x.AbdCode)
            .ToListAsync();

        var bytes = _excel.CreateExcel(summaries);
        return File(bytes, "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", $"BranchTotals_{id:N}.xlsx");
    }
}
```

---

# ‚úÖ Step 12 ‚Äî Admin Controller (Delete All + Delete Job)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
* Delete All: password protected
* Delete Job: per-job delete (safe cleanup)

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Selective delete + emergency cleanup‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
DB bloated ‡¶π‡¶¨‡ßá, accidental wipe risk‡•§

### Code (üìÑ `Controllers/AdminController.cs`)

```csharp
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using WesternUnionPD.Data;

namespace WesternUnionPD.Controllers;

public sealed class AdminController : Controller
{
    private readonly AppDbContext _db;
    private readonly IConfiguration _cfg;

    public AdminController(AppDbContext db, IConfiguration cfg)
    {
        _db = db;
        _cfg = cfg;
    }

    // Delete single job + its summaries
    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task<IActionResult> DeleteJob(Guid jobId)
    {
        var job = await _db.UploadJobs.FirstOrDefaultAsync(x => x.Id == jobId);
        if (job == null) return NotFound();

        _db.BranchSummaries.RemoveRange(_db.BranchSummaries.Where(x => x.UploadJobId == jobId));
        _db.UploadJobs.Remove(job);

        await _db.SaveChangesAsync();
        return RedirectToAction("Upload", "BranchCharge");
    }

    // Delete ALL data (Danger Zone) + password protected
    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task<IActionResult> DeleteAll(string password)
    {
        if (password != _cfg["Admin:DeletePassword"])
            return BadRequest("Invalid delete password.");

        _db.BranchSummaries.RemoveRange(_db.BranchSummaries);
        _db.UploadJobs.RemoveRange(_db.UploadJobs);

        await _db.SaveChangesAsync();
        return RedirectToAction("Upload", "BranchCharge");
    }
}
```

---

# ‚úÖ Step 13 ‚Äî Upload View (Upload Progress + Recent Jobs + Delete per job)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
* Upload progress bar (XHR)
* Recent job history
* Download + Delete button per completed job
* Danger zone (delete all)

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
User back ‡¶ó‡ßá‡¶≤‡ßá‡¶ì download ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá; clean UX‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
Job link ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá ‡¶Ø‡ßá‡¶§; refresh confusion‡•§

### Code (üìÑ `Views/BranchCharge/Upload.cshtml`)
```html
@model List<WesternUnionPD.Models.UploadJob>

<h2>Upload CSV</h2>

<form id="uploadForm" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()
    <input id="fileInput" type="file" name="file" accept=".csv" required />
    <button id="btnUpload" type="button">Upload & Process</button>
</form>

<div id="status" style="margin-top:10px;"></div>

<!-- Upload progress bar -->
<div id="progressWrap" style="margin-top:10px; width:420px; display:none;">
    <div style="border:1px solid #999;height:22px;border-radius:4px;overflow:hidden;">
        <div id="progressBar" style="height:22px;width:0%;background:#2e7d32;"></div>
    </div>
    <div id="progressText" style="margin-top:6px;font-family:monospace;">0%</div>
</div>

<hr />

<h3>Recent Jobs</h3>

@if (!Model.Any())
{
    <p>No previous jobs.</p>
}
else
{
    <table border="1" cellpadding="6" cellspacing="0">
        <thead>
        <tr>
            <th>JobId</th>
            <th>Status</th>
            <th>Rows</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var job in Model)
        {
            <tr>
                <td>@job.Id</td>
                <td>@job.Status</td>
                <td>@job.ProcessedRows</td>
                <td style="white-space:nowrap;">
                    <a asp-action="Result" asp-route-id="@job.Id" style="margin-right:10px;">View</a>

                    @if (job.Status == "Completed")
                    {
                        <a asp-action="Download" asp-route-id="@job.Id" style="margin-right:10px;">üì• Download</a>

                        <!-- Delete one job -->
                        <form asp-controller="Admin" asp-action="DeleteJob" method="post"
                              style="display:inline;"
                              onsubmit="return confirm('Delete this job data?');">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="jobId" value="@job.Id" />
                            <button type="submit" style="background:#c62828;color:white;border:none;padding:4px 8px;">
                                ‚ùå Delete
                            </button>
                        </form>
                    }
                    else
                    {
                        <span>Processing‚Ä¶</span>
                    }
                </td>
            </tr>
        }
        </tbody>
    </table>
}

<hr />

<h3 style="color:red;">Danger Zone</h3>
<form asp-controller="Admin" asp-action="DeleteAll" method="post"
      onsubmit="return confirm('FINAL WARNING: Delete ALL data?');">
    @Html.AntiForgeryToken()
    <input type="password" name="password" placeholder="Delete password" required />
    <button type="submit" style="background:red;color:white;border:none;padding:6px 10px;">
        DELETE ALL DATA
    </button>
</form>

<script>
(() => {
    const btn = document.getElementById("btnUpload");
    const fileInput = document.getElementById("fileInput");
    const status = document.getElementById("status");
    const wrap = document.getElementById("progressWrap");
    const bar = document.getElementById("progressBar");
    const txt = document.getElementById("progressText");
    const token = document.querySelector('input[name="__RequestVerificationToken"]').value;

    btn.onclick = () => {
        const file = fileInput.files && fileInput.files[0];
        if (!file) { status.innerText = "Please select a file."; return; }

        // client-side size check (1GB)
        if (file.size > 1073741824) { status.innerText = "File too large (max 1GB)."; return; }

        wrap.style.display = "block";
        bar.style.width = "0%";
        txt.innerText = "0%";
        status.innerText = "Uploading...";

        btn.disabled = true;

        const fd = new FormData();
        fd.append("file", file);

        const xhr = new XMLHttpRequest();
        xhr.open("POST", "@Url.Action("UploadAjax","BranchCharge")", true);
        xhr.setRequestHeader("RequestVerificationToken", token);

        xhr.upload.onprogress = (e) => {
            if (!e.lengthComputable) return;
            const pct = (e.loaded / e.total) * 100;
            bar.style.width = pct + "%";
            txt.innerText = Math.round(pct) + "%";
        };

        xhr.onload = () => {
            btn.disabled = false;
            if (xhr.status >= 200 && xhr.status < 300) {
                const res = JSON.parse(xhr.responseText);
                window.location.href = res.redirectUrl;
            } else {
                status.innerText = "Upload failed: " + xhr.responseText;
            }
        };

        xhr.onerror = () => {
            btn.disabled = false;
            status.innerText = "Network error during upload.";
        };

        xhr.send(fd);
    };
})();
</script>
```

---

# ‚úÖ Step 14 ‚Äî Result View (Auto-show result without refresh + Go back)

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
Polling ‡¶¶‡¶ø‡ßü‡ßá status auto-update; Completed ‡¶π‡¶≤‡ßá result show; Go back button‡•§

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
User refresh ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá‡¶á result ‡¶™‡¶æ‡ßü‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
Manual refresh ‡¶≤‡¶æ‡¶ó‡¶§, confusion ‡¶π‡¶§‡ßã‡•§

### Code (üìÑ `Views/BranchCharge/Result.cshtml`)

```html
@model List<WesternUnionPD.Models.BranchSummary>
@{
    var job = ViewBag.Job as WesternUnionPD.Models.UploadJob;
}

<h2>Job Result</h2>

<p><b>Status:</b> <span id="jobStatus">@job?.Status</span></p>
<p><b>Processed Rows:</b> <span id="rowCount">@job?.ProcessedRows</span></p>

<div id="resultSection" style="display:@(job?.Status=="Completed" ? "block":"none"); margin-top:15px;">
    <a asp-action="Download" asp-route-id="@job!.Id">üì• Download Excel</a>

    <table border="1" cellpadding="6" cellspacing="0" style="margin-top:10px;">
        <tr>
            <th>ABD</th><th>Charges</th><th>FX</th><th>Total</th>
        </tr>
        @foreach (var r in Model)
        {
            <tr>
                <td>@r.AbdCode</td>
                <td>@r.ChargesLOC</td>
                <td>@r.FxLOC</td>
                <td>@r.GrandTotal</td>
            </tr>
        }
    </table>
</div>

@if (job?.Status == "Failed")
{
    <p style="color:red;"><b>@(job.Error ?? "Processing failed.")</b></p>
}

<hr />
<a asp-action="Upload" style="padding:8px 12px;background:#2e7d32;color:white;text-decoration:none;border-radius:4px;">
    ‚¨Ö Go Back & Start Fresh
</a>

<script>
(() => {
    const statusEl = document.getElementById("jobStatus");
    const rowEl = document.getElementById("rowCount");
    const resultSection = document.getElementById("resultSection");

    if (statusEl.textContent === "Completed" || statusEl.textContent === "Failed") return;

    const timer = setInterval(async () => {
        try {
            const res = await fetch(window.location.href, { headers: { "X-Requested-With": "XMLHttpRequest" } });
            if (!res.ok) return;

            const html = await res.text();
            const doc = new DOMParser().parseFromString(html, "text/html");

            const newStatus = doc.querySelector("#jobStatus")?.textContent;
            const newRows = doc.querySelector("#rowCount")?.textContent;

            if (newStatus) statusEl.textContent = newStatus;
            if (newRows) rowEl.textContent = newRows;

            if (newStatus === "Completed") {
                clearInterval(timer);
                resultSection.style.display = "block";
            }
            if (newStatus === "Failed") clearInterval(timer);
        } catch {}
    }, 3000);
})();
</script>
```

---

# ‚úÖ Step 15 ‚Äî Migration & Run

### ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
Database table create ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§

### ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞
Without migrations DB schema ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§

### ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
Run ‡¶ï‡¶∞‡¶≤‡ßá table not found error‡•§

### Code

```bash
dotnet ef migrations add Init
dotnet ef database update
dotnet run
```

---

## ‚úÖ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‚ÄúTeaching Pack‚Äù ‡¶™‡ßá‡¶≤‡ßá‡¶®

‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶∂‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‚Äî‡¶ï‡¶æ‡¶∞‡¶£ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø step ‡¶è ‡¶Ü‡¶õ‡ßá:

* ‡¶ï‡ßÄ
* ‡¶ï‡ßá‡¶®
* ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ
* code (file path ‡¶∏‡¶π







.


